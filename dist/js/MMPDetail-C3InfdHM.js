import{r as p,j as e,a2 as De,t as b,p as ae,ae as Ee,am as xe,a9 as $e,aK as We,I as Le,_ as Ge,a3 as Ve,l as he,aL as Ue,ah as He,aM as qe,o as Pe,aN as Ye,q as ze,Y as Oe,h as _e}from"./react-core-B8kFjp2k.js";import{u as Te,U as Ie,a2 as ke,C as D,f as P,g as k,a as c,b as V,B as l,a3 as y,r as _,D as Ke,l as Je,m as Xe,n as Qe,T as Be,i as Re,j as u,S as Ze,k as v,p as Fe,h as O}from"./index-PwDgWEVM.js";import{P as es}from"./progress-vMwTbqUI.js";import{A as re,h as ie,a as te,b as ne,c as le,d as ce,e as de,f as oe,g as me}from"./alert-dialog-D6avgrWz.js";import{M as ss}from"./MMPComprehensiveVerification-E3LCHbkI.js";import{o as ye}from"./date-utils-YarVESQS.js";import{A as as}from"./AuditLogViewer-BpgeBMsl.js";import{M as rs}from"./MMPVersionHistory-CbgVhy2G.js";import{M as is}from"./MMPOverallInformation-CT39nI2-.js";import{M as ts}from"./MMPSiteInformation-Bke1UQxS.js";import{bI as ns,bo as ls}from"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";import"./MMPPermitVerification-CyCVrban.js";import"./textarea-BpQMf5eL.js";import"./calendar-DEyRSxJX.js";import"./popover-BSK_FA51.js";import"./label-C4lDws8j.js";import"./select-CXX5Q_V1.js";import"./sudanStates-CkkbYUnU.js";import"./radio-group-CC4lGE1V.js";import"./PermitPreviewDialog-B2XKKnFF.js";import"./checkbox-9q2dlFjr.js";import"./table-CZ8ZB6wW.js";import"./hover-card-BltHYp3k.js";function cs({mmpFile:a,onApprove:w,onReject:d,onVerify:we}){var R,E,$,W,L,G,U,H,q;const{toast:x}=Te(),[pe,T]=p.useState("pending"),[je,K]=p.useState(""),[s,M]=p.useState(!1),[fe,J]=p.useState(!1),{resetMMP:ue,updateMMP:ve}=Ie(),[m,ge]=p.useState(null),[A,I]=p.useState(!1);p.useEffect(()=>{a.mmpId&&typeof ke=="function"&&ge(ke(a.mmpId))},[a.mmpId]),a.status==="pending"||a.approvalWorkflow;const X=((R=a.approvalWorkflow)==null?void 0:R.firstApproval)&&!a.approvalWorkflow.finalApproval,o=a.status==="approved",j=a.status==="rejected",h=((E=a.comprehensiveVerification)==null?void 0:E.canProceedToApproval)||!1,g=r=>r?ye(new Date(r),"MMM d, yyyy h:mm a"):"N/A",Q=()=>{J(!1),M(!0),x({title:"File review completed",description:"You can now proceed with the verification process."})},Z=()=>Array(a.entries||5).fill(null).map((r,n)=>({id:`site-${n+1}`,siteCode:`SC${1e4+n}`,siteName:`Site ${n+1}`,inMoDa:Math.random()>.3,visitedBy:Math.random()>.5?"PACT":"Joint Visit",mainActivity:["DM","AIM","PDM","OTHER"][Math.floor(Math.random()*4)],visitDate:ye(new Date(Date.now()+Math.random()*30*24*60*60*1e3),"yyyy-MM-dd"),status:["planned","completed","cancelled","postponed"][Math.floor(Math.random()*4)]})),C=()=>{var r,n;if(!a.version)return{major:"1",minor:"0"};if(typeof a.version=="string"){const f=a.version.split(".");return{major:f&&f.length>0&&f[0]||"1",minor:f&&f.length>1&&f[1]||"0"}}return typeof a.version=="object"&&a.version!==null?{major:((r=a.version.major)==null?void 0:r.toString())||"1",minor:((n=a.version.minor)==null?void 0:n.toString())||"0"}:{major:"1",minor:"0"}},S=(()=>{if(!a.modificationHistory||a.modificationHistory.length===0){const r=C(),n=m?`V${m.version.major}.${m.version.minor}`:`V${r.major}.${r.minor}`;return[{timestamp:a.uploadedAt,modifiedBy:a.uploadedBy,changes:"Initial upload",previousVersion:"N/A",newVersion:a.mmpId||`M-${new Date(a.uploadedAt).getMonth()+1}${new Date(a.uploadedAt).getFullYear()}-${n}-${a.region||"UNK"}`}]}return a.modificationHistory})(),B=Z(),F=r=>{ve(a.id,{comprehensiveVerification:r})},ee=()=>{T("verified"),we(),x({title:"All Verifications Complete",description:"The MMP is now ready for the approval process."})},se=async()=>{if(!a||!a.id){x({title:"Error",description:"MMP file ID is missing",variant:"destructive"});return}try{await ue(a.id)&&(T("pending"),K(""),M(!1),I(!1),x({title:"Reset Successful",description:"The MMP approval status has been reset successfully."}))}catch{x({title:"Reset Failed",description:"Failed to reset MMP approval status.",variant:"destructive"})}};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{className:"mt-6",children:[e.jsx(P,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"MMP Verification & Approval Process"]}),(o||j)&&e.jsxs(re,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(c,{variant:"outline",size:"sm",children:"Reset Approval"})}),e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:"Reset Approval Status"}),e.jsx(ce,{children:"This will reset the approval status of the MMP and all its sites. This action cannot be undone."})]}),e.jsxs(de,{children:[e.jsx(oe,{children:"Cancel"}),e.jsx(me,{onClick:se,children:"Reset"})]})]})]})]})}),e.jsxs(V,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-slate-50 rounded-md border border-slate-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:"File Information"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"File Name:"}),e.jsx("span",{className:"font-medium",children:a.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Upload Date:"}),e.jsx("span",{className:"font-medium",children:g(a.uploadedAt)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Uploaded By:"}),e.jsx("span",{className:"font-medium",children:a.uploadedBy})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Status:"}),e.jsxs("span",{children:[o&&e.jsx(l,{className:"bg-green-100 text-green-800",children:"Approved"}),j&&e.jsx(l,{className:"bg-red-100 text-red-800",children:"Rejected"}),!o&&!j&&e.jsx(l,{className:"bg-amber-100 text-amber-800",children:"Pending Approval"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:"System Verification"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"File integrity verified"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"No duplicates detected"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Compliant with system requirements"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.entries&&a.processedEntries?e.jsx(b,{className:"h-4 w-4 text-green-600"}):e.jsx(ae,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm",children:a.entries&&a.processedEntries?`${a.processedEntries} of ${a.entries} entries processed`:"Entry processing incomplete"})]})]})]})]}),e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-4",children:"Verification & Approval Process"}),e.jsxs("div",{className:`p-4 border rounded-md ${h?"border-green-300 bg-green-50":"border-amber-300 bg-amber-50"}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(Ee,{className:`h-5 w-5 ${h?"text-green-600":"text-amber-600"}`}),e.jsx("span",{className:"font-medium",children:"Comprehensive Verification"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>I(!A),className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),A?"Hide Details":"View Details"]}),h&&e.jsx(l,{className:"bg-green-100 text-green-800",children:"Complete"})]})]}),e.jsx("p",{className:"text-sm mt-2",children:h?"All verification steps are complete. Ready for approval process.":"Complete all verification steps before proceeding to approval."})]}),A&&e.jsx("div",{className:"mt-4",children:e.jsx(ss,{mmpFile:a,onVerificationUpdate:F,onVerificationComplete:ee})}),e.jsxs("div",{className:`p-4 border rounded-md ${o?"border-green-300 bg-green-50":"border-gray-300 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(xe,{className:`h-5 w-5 ${o?"text-green-600":"text-gray-600"}`}),e.jsx("span",{className:"font-medium",children:"Approval Process"})]}),o&&e.jsx(l,{className:"bg-green-100 text-green-800",children:"Completed"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:`p-3 rounded-md ${($=a.approvalWorkflow)!=null&&$.firstApproval?"bg-green-100 border border-green-200":"bg-gray-100 border border-gray-200"}`,children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"First Approval"}),(W=a.approvalWorkflow)!=null&&W.firstApproval?e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Approver:"}),e.jsx("span",{className:"font-medium",children:a.approvalWorkflow.firstApproval.approvedBy})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Date:"}),e.jsx("span",{className:"font-medium",children:g(a.approvalWorkflow.firstApproval.approvedAt)})]})]}):e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:h?"Ready for first approval":"Complete verification required"}),h&&e.jsxs(re,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(c,{size:"sm",children:"Approve"})}),e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:"Confirm First Approval"}),e.jsx(ce,{children:"Are you sure you want to approve this MMP file? This action cannot be undone."})]}),e.jsxs(de,{children:[e.jsx(oe,{children:"Cancel"}),e.jsx(me,{onClick:()=>w("First approval granted"),children:"Approve"})]})]})]})]})]}),e.jsxs("div",{className:`p-3 rounded-md ${(L=a.approvalWorkflow)!=null&&L.finalApproval?"bg-green-100 border border-green-200":"bg-gray-100 border border-gray-200"}`,children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Final Approval"}),(G=a.approvalWorkflow)!=null&&G.finalApproval?e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Approver:"}),e.jsx("span",{className:"font-medium",children:a.approvalWorkflow.finalApproval.approvedBy})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Date:"}),e.jsx("span",{className:"font-medium",children:g(a.approvalWorkflow.finalApproval.approvedAt)})]})]}):e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:(U=a.approvalWorkflow)!=null&&U.firstApproval?"Ready for final approval":"First approval required"}),X&&e.jsxs(re,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(c,{size:"sm",children:"Approve"})}),e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:"Confirm Final Approval"}),e.jsx(ce,{children:"This is the final approval. The MMP file will be locked for editing after this action. Do you want to proceed?"})]}),e.jsxs(de,{children:[e.jsx(oe,{children:"Cancel"}),e.jsx(me,{onClick:()=>w("Final approval granted"),children:"Approve"})]})]})]})]})]})]})]})]}),(o||j)&&e.jsxs("div",{className:`p-4 border rounded-md ${o?"border-green-300 bg-green-50":"border-red-300 bg-red-50"}`,children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium",children:"MMP File Approved and Locked"})]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"font-medium",children:"MMP File Rejected"})]})}),e.jsx("p",{className:"text-sm",children:o?"This MMP file has received all required approvals and is now locked for editing.":`Rejection reason: ${a.rejectionReason||"No reason provided"}`})]})]}),e.jsxs(_,{className:"flex justify-between",children:[!o&&!j&&e.jsxs(e.Fragment,{children:[e.jsxs(re,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(c,{variant:"destructive",children:"Reject MMP"})}),e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:"Reject MMP File"}),e.jsx(ce,{children:"Please provide a reason for rejecting this MMP file."})]}),e.jsx("textarea",{className:"w-full border rounded-md p-2 mt-2",placeholder:"Enter rejection reason",rows:3,onChange:r=>K(r.target.value)}),e.jsxs(de,{children:[e.jsx(oe,{children:"Cancel"}),e.jsx(me,{onClick:()=>d(je),className:"bg-destructive text-destructive-foreground",children:"Confirm Rejection"})]})]})]}),e.jsx(c,{disabled:!h,onClick:()=>x({description:"Notifications sent to required approvers"}),children:"Notify Approvers"})]}),(o||j)&&e.jsx(c,{variant:"outline",onClick:()=>x({description:"Generating detailed report..."}),children:"Generate Approval Report"})]})]}),e.jsx(Ke,{open:fe,onOpenChange:J,children:e.jsxs(Je,{className:"max-w-4xl max-h-[90vh]",children:[e.jsx(Xe,{children:e.jsxs(Qe,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5"}),"MMP File Comprehensive Review"]})}),e.jsxs(Be,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Re,{className:"grid grid-cols-4 mb-4",children:[e.jsx(u,{value:"overview",children:"Overview"}),e.jsx(u,{value:"sites",children:"Site Entries"}),e.jsx(u,{value:"versions",children:"Version History"}),e.jsx(u,{value:"compliance",children:"Compliance"})]}),e.jsxs(Ze,{className:"h-[60vh] mt-4",children:[e.jsxs(v,{value:"overview",className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"File Name"}),e.jsx("p",{className:"font-medium",children:a.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload Date"}),e.jsx("p",{className:"font-medium",children:g(a.uploadedAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(l,{variant:"outline",children:a.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Region"}),e.jsx("p",{className:"font-medium",children:a.region})]})]})]}),a.mmpId&&m&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-2 flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"})," MMP ID Breakdown"]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md border border-blue-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium",children:"MMP ID:"}),e.jsx(l,{variant:"outline",className:"px-3 py-1 text-base font-mono",children:a.mmpId})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-2 gap-x-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"Format:"}),e.jsx("span",{className:"font-medium",children:"M-MMYYYY-VX.Y-REG"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"Month:"}),e.jsx("span",{className:"font-medium",children:m.month})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"Year:"}),e.jsx("span",{className:"font-medium",children:m.year})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"Version:"}),e.jsxs("span",{className:"font-medium",children:["v",m.version.major,".",m.version.minor]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"Region Code:"}),e.jsx("span",{className:"font-medium",children:m.region})]})]})]})]}),e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Processing Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Entries"}),e.jsx("p",{className:"font-medium",children:a.entries||"0"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processed Entries"}),e.jsx("p",{className:"font-medium",children:a.processedEntries||"0"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processing Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-primary h-2.5 rounded-full",style:{width:`${a.entries&&a.processedEntries?Math.min(100,Math.round(a.processedEntries/a.entries*100)):0}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:[a.entries&&a.processedEntries?Math.min(100,Math.round(a.processedEntries/a.entries*100)):0,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Location"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{children:((H=a.location)==null?void 0:H.address)||((q=a.location)==null?void 0:q.region)||a.region||"Not specified"})]})]})]})]}),e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Team Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Uploaded By"}),e.jsx("p",{className:"font-medium",children:a.uploadedBy})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last Modified By"}),e.jsx("p",{className:"font-medium",children:S.length>0?S[0].modifiedBy:a.uploadedBy})]})]}),a.approvalWorkflow&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Approval Status"}),e.jsxs("div",{className:"flex flex-col gap-2 mt-1",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded border",children:[e.jsx("span",{className:"text-sm",children:"First Approval:"}),a.approvalWorkflow.firstApproval?e.jsx(l,{className:"bg-green-100 text-green-800",children:"Approved"}):e.jsx(l,{className:"bg-amber-100 text-amber-800",children:"Pending"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded border",children:[e.jsx("span",{className:"text-sm",children:"Final Approval:"}),a.approvalWorkflow.finalApproval?e.jsx(l,{className:"bg-green-100 text-green-800",children:"Approved"}):e.jsx(l,{className:"bg-amber-100 text-amber-800",children:"Pending"})]})]})]})]})]})]}),e.jsxs(v,{value:"sites",className:"space-y-4 p-4",children:[e.jsxs("h4",{className:"text-sm font-medium mb-2",children:["Site Entries (",B.length,")"]}),e.jsx("div",{className:"space-y-4",children:B.map((r,n)=>e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h5",{className:"font-medium",children:r.siteName}),e.jsx(l,{variant:r.status==="completed"?"default":"outline",children:r.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Site Code:"})," ",e.jsx("span",{className:"font-medium",children:r.siteCode})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"In MoDa:"})," ",e.jsx("span",{className:"font-medium",children:r.inMoDa?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Visited By:"})," ",e.jsx("span",{className:"font-medium",children:r.visitedBy})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Main Activity:"})," ",e.jsx("span",{className:"font-medium",children:r.mainActivity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Visit Date:"})," ",e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),r.visitDate]})]})]})]},r.id))})]}),e.jsxs(v,{value:"versions",className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Version History"}),e.jsxs(l,{variant:"outline",className:"px-2 py-1",children:["Current Version: ",m?`v${m.version.major}.${m.version.minor}`:`v${C().major}.${C().minor}`]})]}),e.jsx("div",{className:"relative pl-6 border-l border-gray-200 space-y-6",children:S.map((r,n)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-[13px] mt-1.5",children:e.jsx("div",{className:`h-6 w-6 rounded-full flex items-center justify-center ${n===0?"bg-primary text-white":"border-2 border-primary bg-white"}`,children:n===0?e.jsx(Ue,{className:"h-3 w-3"}):e.jsx("span",{className:"text-xs font-medium text-primary",children:n+1})})}),e.jsx("div",{className:`bg-white p-4 rounded-md border ${n===0?"border-primary/30":"border-gray-200"}`,children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-medium text-base",children:r.changes}),e.jsx(l,{variant:n===0?"default":"secondary",children:r.newVersion})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(he,{className:"h-3.5 w-3.5 mr-1.5"}),g(r.timestamp)]}),e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(xe,{className:"h-3.5 w-3.5 mr-1.5"}),r.modifiedBy]})]}),n>0&&e.jsxs("div",{className:"mt-2 bg-slate-50 p-2 rounded flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Previous version:"}),e.jsx(l,{variant:"outline",children:r.previousVersion})]})]})})]},n))})]}),e.jsxs(v,{value:"compliance",className:"space-y-4 p-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-4",children:"Compliance Status"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-100 rounded-md p-4",children:[e.jsxs("h5",{className:"font-medium text-green-800 flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"h-4 w-4"}),"Passed Validations"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-green-700",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-3.5 w-3.5"}),"File format validation"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-3.5 w-3.5"}),"MMP ID structure compliance"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-3.5 w-3.5"}),"Required field completeness"]})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-100 rounded-md p-4",children:[e.jsxs("h5",{className:"font-medium text-amber-800 flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Warnings"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-amber-700",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-3.5 w-3.5"}),"Some site entries have missing GPS coordinates"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-3.5 w-3.5"}),"3 sites have conflicting visit dates"]})]})]})]})]})]})]}),e.jsx(Fe,{children:e.jsx(c,{onClick:Q,children:"Mark as Reviewed"})})]})})]})}const qs=()=>{var A,I,X,o,j,h,g,Q,Z,C,Ne,S,B,F,ee,se,R,E,$,W,L,G,U,H,q,r,n,be,f,Me,Ae,Ce;const{id:a}=ns(),w=ls(),{toast:d}=Te(),{mmpFiles:we,loading:x,getMmpById:pe,updateMMP:T}=Ie(),[je,K]=p.useState("core"),[s,M]=p.useState(null);p.useEffect(()=>{if(a&&!x){const i=pe(a);i?M(i):(d({variant:"destructive",title:"MMP Not Found",description:"The requested MMP file could not be found."}),w("/mmp"))}},[a,x,pe,d,w]);const fe=()=>{w("/mmp")},J=i=>{switch(i){case"Basic":return"bg-green-100 text-green-800";case"Intermediate":return"bg-amber-100 text-amber-800";case"Advanced":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ue=i=>{switch(i){case"Completed":return"bg-green-100 text-green-800";case"In Progress":return"bg-blue-100 text-blue-800";case"Pending":return"bg-amber-100 text-amber-800";case"Flagged for Review":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ve=i=>{var z;if(!s)return;const t=!((z=s.approvalWorkflow)!=null&&z.firstApproval),N={...s.approvalWorkflow||{}};t?(N.firstApproval={approvedBy:"Current User",approvedAt:new Date().toISOString(),comments:i},d({title:"First Approval Completed",description:"MMP file has received first approval. Final approval still required."})):(N.finalApproval={approvedBy:"Current User",approvedAt:new Date().toISOString(),comments:i},d({title:"Final Approval Completed",description:"MMP file has been fully approved and is now locked for editing."}));const Y={...s,status:t?"pending":"approved",approvedBy:t?void 0:"Current User",approvedAt:t?void 0:new Date().toISOString(),approvalWorkflow:N};M({...s,...Y}),T(s.id,Y)},m=i=>{if(!s)return;const t={...s,status:"rejected",rejectionReason:i};M({...s,...t}),T(s.id,t),d({variant:"destructive",title:"MMP File Rejected",description:"The file has been rejected and returned for corrections."})},ge=()=>{d({title:"Verification Complete",description:"MMP file has been verified and is ready for approval."})};return x||!s?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{children:"Loading MMP item details..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"outline",size:"icon",onClick:fe,children:e.jsx(He,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"MMP Details"}),e.jsxs("p",{className:"text-muted-foreground",children:[s.mmpId||`MMP-${s.id}`," â€¢ Created on ",s.uploadedAt?new Date(s.uploadedAt).toLocaleDateString():"Unknown"]})]})]}),e.jsxs(Be,{value:je,onValueChange:K,className:"w-full",children:[e.jsxs(Re,{className:"grid grid-cols-2 md:grid-cols-5 mb-4",children:[e.jsxs(u,{value:"core",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Core Information"]}),e.jsxs(u,{value:"siteVisit",children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Site Visit Data"]}),e.jsxs(u,{value:"financial",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Financial"]}),e.jsxs(u,{value:"performance",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Performance"]}),e.jsxs(u,{value:"approvals",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Verification & Approvals"]})]}),e.jsx(v,{value:"core",children:e.jsxs(D,{children:[e.jsxs(P,{children:[e.jsx(k,{children:"Core Information"}),e.jsx(O,{children:"Essential details about this monitoring plan"})]}),e.jsxs(V,{className:"space-y-6",children:[e.jsx(is,{mmpFile:s}),e.jsx(y,{}),e.jsx(ts,{mmpFile:s,showVerificationButton:!1})]}),e.jsx(_,{children:e.jsx(c,{variant:"outline",onClick:()=>d({title:"Action triggered",description:"This would update the MMP item in a real app"}),children:"Update Information"})})]})}),e.jsx(v,{value:"siteVisit",children:e.jsxs(D,{children:[e.jsxs(P,{children:[e.jsx(k,{children:"Site Visit Data"}),e.jsx(O,{children:"Expanded details about the site visit requirements"})]}),e.jsx(V,{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Task Complexity"}),e.jsx(l,{className:J(((A=s.siteVisit)==null?void 0:A.complexity)||"Basic"),children:((I=s.siteVisit)==null?void 0:I.complexity)||"Basic"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Estimated Duration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{children:((X=s.siteVisit)==null?void 0:X.estimatedDuration)||"Not specified"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Resource Requirements"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1",children:[(((o=s.siteVisit)==null?void 0:o.resources)||[]).map((i,t)=>e.jsx(l,{variant:"outline",children:i},t)),(!((j=s.siteVisit)!=null&&j.resources)||s.siteVisit.resources.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No resources specified"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Risk & Escalation Notes"}),e.jsxs("div",{className:"rounded-md bg-amber-50 border border-amber-200 p-3 mt-1",children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-amber-800",children:((h=s.siteVisit)==null?void 0:h.risks)||"No risks identified"})]}),e.jsx(y,{className:"my-2 bg-amber-200"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Escalation Protocol:"}),e.jsx("p",{className:"text-sm text-amber-800",children:((g=s.siteVisit)==null?void 0:g.escalation)||"No escalation protocol defined"})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Schedule Indicators"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[e.jsxs("div",{className:"flex flex-col border rounded-md p-3 items-center justify-center",children:[e.jsx(he,{className:"h-5 w-5 text-muted-foreground mb-1"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start Date"}),e.jsx("p",{className:"font-medium",children:((Q=s.performance)==null?void 0:Q.startDate)||"Not set"})]}),e.jsxs("div",{className:"flex flex-col border rounded-md p-3 items-center justify-center",children:[e.jsx(he,{className:"h-5 w-5 text-muted-foreground mb-1"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Est. End Date"}),e.jsx("p",{className:"font-medium",children:((Z=s.performance)==null?void 0:Z.estimatedEndDate)||"Not set"})]})]})]})]})]})}),e.jsx(_,{children:e.jsx(c,{variant:"outline",onClick:()=>d({title:"Action triggered",description:"This would update the site visit data in a real app"}),children:"Update Site Visit Data"})})]})}),e.jsx(v,{value:"financial",children:e.jsxs(D,{children:[e.jsxs(P,{children:[e.jsx(k,{children:"Financial Tracking"}),e.jsx(O,{children:"Budget allocation and fee breakdown details"})]}),e.jsxs(V,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-center",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center border rounded-xl p-6 w-full md:w-1/3",children:[e.jsx(Pe,{className:"h-8 w-8 text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Budget Allocation"}),e.jsxs("p",{className:"text-3xl font-bold",children:[((C=s.financial)==null?void 0:C.budgetAllocation)||0," ",((Ne=s.financial)==null?void 0:Ne.currency)||"SDG"]}),e.jsx(l,{className:((S=s.financial)==null?void 0:S.approvalStatus)==="Approved"?"bg-green-100 text-green-800 mt-2":"bg-amber-100 text-amber-800 mt-2",children:((B=s.financial)==null?void 0:B.approvalStatus)||"Pending"})]}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Fee Breakdown"}),e.jsx("div",{className:"space-y-2",children:(F=s.financial)!=null&&F.feeBreakdown?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Base Fee"}),e.jsxs("span",{className:"font-medium",children:[s.financial.feeBreakdown.baseFee||0," ",s.financial.currency||"SDG"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Distance Surcharge"}),e.jsxs("span",{className:"font-medium",children:[s.financial.feeBreakdown.distanceSurcharge||0," ",s.financial.currency||"SDG"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Complexity Surcharge"}),e.jsxs("span",{className:"font-medium",children:[s.financial.feeBreakdown.complexitySurcharge||0," ",s.financial.currency||"SDG"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Urgency Surcharge"}),e.jsxs("span",{className:"font-medium",children:[s.financial.feeBreakdown.urgencySurcharge||0," ",s.financial.currency||"SDG"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Transportation Allowance"}),e.jsxs("span",{className:"font-medium",children:[s.financial.feeBreakdown.transportationAllowance||0," ",s.financial.currency||"SDG"]})]}),e.jsx(y,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[s.financial.budgetAllocation||0," ",s.financial.currency||"SDG"]})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No fee breakdown available"})})]})]}),e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Per-Site Budget Allocation"}),(ee=s.financial)!=null&&ee.perSiteAllocation&&s.financial.perSiteAllocation.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2 px-4",children:"Site ID"}),e.jsx("th",{className:"text-left py-2 px-4",children:"Allocation"}),e.jsx("th",{className:"text-left py-2 px-4",children:"Transportation Fee"}),e.jsx("th",{className:"text-right py-2 px-4",children:"% of Total"})]})}),e.jsx("tbody",{children:s.financial.perSiteAllocation.map((i,t)=>{var Y,z,Se;const N=Math.round(i.allocation/(((Y=s.financial)==null?void 0:Y.budgetAllocation)||1)*100);return e.jsxs("tr",{className:t%2===0?"bg-muted/50":"",children:[e.jsx("td",{className:"py-2 px-4",children:i.siteId}),e.jsxs("td",{className:"py-2 px-4",children:[i.allocation," ",((z=s.financial)==null?void 0:z.currency)||"SDG"]}),e.jsxs("td",{className:"py-2 px-4",children:[i.transportationFee," ",((Se=s.financial)==null?void 0:Se.currency)||"SDG"]}),e.jsxs("td",{className:"text-right py-2 px-4",children:[N,"%"]})]},t)})}),e.jsx("tfoot",{className:"border-t font-medium",children:e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-4",children:"Total"}),e.jsxs("td",{className:"py-2 px-4",children:[((se=s.financial)==null?void 0:se.budgetAllocation)||0," ",((R=s.financial)==null?void 0:R.currency)||"SDG"]}),e.jsxs("td",{className:"py-2 px-4",children:[s.financial.perSiteAllocation.reduce((i,t)=>i+t.transportationFee,0)," ",((E=s.financial)==null?void 0:E.currency)||"SDG"]}),e.jsx("td",{className:"text-right py-2 px-4",children:"100%"})]})})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No per-site allocation data available"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Approval Information"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Status:"}),e.jsx("span",{className:"font-medium",children:(($=s.financial)==null?void 0:$.approvalStatus)||"Pending"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Approved By:"}),e.jsx("span",{className:"font-medium",children:((W=s.financial)==null?void 0:W.approvedBy)||s.approvedBy||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Approval Date:"}),e.jsx("span",{className:"font-medium",children:((L=s.financial)==null?void 0:L.approvedDate)||s.approvedAt||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Payment Processing"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Payment Method:"}),e.jsx("span",{className:"font-medium",children:((G=s.financial)==null?void 0:G.paymentMethod)||"Not specified"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Processing Timeline:"}),e.jsx("span",{className:"font-medium",children:((U=s.financial)==null?void 0:U.processingTime)||"Not specified"})]})]})]})]})]}),e.jsxs(_,{className:"flex justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>d({title:"Download",description:"Downloading financial report..."}),children:"Export Financial Report"}),e.jsx(c,{onClick:()=>d({title:"Action triggered",description:"This would update the payment status in a real app"}),children:"Process Payment"})]})]})}),e.jsx(v,{value:"performance",children:e.jsxs(D,{children:[e.jsxs(P,{children:[e.jsx(k,{children:"Performance Metrics & Reporting"}),e.jsx(O,{children:"Tracking, metrics, and incident reports"})]}),e.jsxs(V,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Completion Status"}),e.jsx(l,{className:ue(((H=s.performance)==null?void 0:H.completionStatus)||"Pending"),children:((q=s.performance)==null?void 0:q.completionStatus)||"Pending"})]}),e.jsx(es,{value:((r=s.performance)==null?void 0:r.progress)||0,className:"h-2"}),e.jsxs("p",{className:"text-xs text-right text-muted-foreground",children:[((n=s.performance)==null?void 0:n.progress)||0,"% complete"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Supervisor Rating & Feedback"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((i,t)=>{var N;return e.jsx("svg",{className:`w-4 h-4 ${t<Math.floor(((N=s.performance)==null?void 0:N.supervisorRating)||0)?"text-yellow-400":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},t)}),e.jsx("span",{className:"ml-2 text-sm font-medium",children:(((be=s.performance)==null?void 0:be.supervisorRating)||0).toFixed(1)})]})}),e.jsx("p",{className:"text-sm mt-2",children:((f=s.performance)==null?void 0:f.supervisorFeedback)||"No feedback available"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Incidents & Compliance Issues"}),(Me=s.performance)!=null&&Me.incidents&&s.performance.incidents.length>0?e.jsx("div",{className:"space-y-2",children:s.performance.incidents.map((i,t)=>e.jsxs("div",{className:"rounded-md bg-amber-50 border border-amber-200 p-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:i.type}),e.jsx(l,{variant:"outline",className:i.resolved?"text-green-600":"text-amber-600",children:i.resolved?"Resolved":"Pending"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i.description})]},t))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No incidents reported"}),(!((Ae=s.performance)!=null&&Ae.complianceIssues)||s.performance.complianceIssues.length===0)&&e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx(xe,{className:"h-4 w-4 text-green-600"}),e.jsx("p",{className:"text-sm text-green-600",children:"All compliance requirements met"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Real-Time Tracking Logs"}),e.jsxs("div",{className:"border rounded-md overflow-hidden",children:[e.jsxs("div",{className:"bg-muted py-2 px-3 text-xs font-medium grid grid-cols-3",children:[e.jsx("div",{children:"Timestamp"}),e.jsx("div",{children:"Action"}),e.jsx("div",{children:"Location"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:(Ce=s.performance)!=null&&Ce.trackingLogs&&s.performance.trackingLogs.length>0?s.performance.trackingLogs.map((i,t)=>e.jsxs("div",{className:`py-2 px-3 text-sm grid grid-cols-3 ${t%2===0?"bg-muted/50":""}`,children:[e.jsx("div",{className:"text-xs",children:ye(new Date(i.timestamp),"MMM d, h:mm a")}),e.jsx("div",{children:i.action}),e.jsx("div",{children:i.location})]},t)):e.jsx("div",{className:"py-4 px-3 text-sm text-muted-foreground text-center",children:"No tracking logs available"})})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>d({description:"Downloading tracking logs..."}),children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Export Log Data"]})})]})]})]}),e.jsxs(_,{className:"flex justify-between",children:[e.jsx(c,{variant:"outline",onClick:()=>d({title:"Action triggered",description:"This would generate a full report in a real app"}),children:"Generate Full Report"}),e.jsx(c,{onClick:()=>d({title:"Action triggered",description:"This would mark the MMP as completed in a real app"}),children:"Update Status"})]})]})}),e.jsxs(v,{value:"approvals",children:[e.jsx(cs,{mmpFile:s,onApprove:ve,onReject:m,onVerify:ge}),e.jsx(y,{className:"my-6"}),e.jsxs(D,{className:"mt-6",children:[e.jsxs(P,{children:[e.jsx(k,{children:"Version History & Modifications"}),e.jsx(O,{children:"Track changes made to this MMP file"})]}),e.jsx(V,{children:e.jsx(rs,{mmpFile:s})})]}),e.jsx(as,{mmpId:s.mmpId,standalone:!1,actionFilter:"all",timeFilter:"all"})]})]})]})};export{qs as default};
