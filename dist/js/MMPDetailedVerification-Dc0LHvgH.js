import{r as l,j as e,ah as B}from"./react-core-B8kFjp2k.js";import{U as E,u as S,C as d,a as v,T as F,i as D,j as M,k as g,b as P}from"./index-PwDgWEVM.js";import{F as L}from"./FieldTeamMapPermissions-Rk88jEyR.js";import{M as I,a as A}from"./MMPPermitVerification-CyCVrban.js";import{M as O}from"./MMPVerificationHeader-BpTrG5gu.js";import{bI as $,bo as z}from"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./date-utils-YarVESQS.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";import"./progress-vMwTbqUI.js";import"./textarea-BpQMf5eL.js";import"./calendar-DEyRSxJX.js";import"./popover-BSK_FA51.js";import"./label-C4lDws8j.js";import"./select-CXX5Q_V1.js";import"./sudanStates-CkkbYUnU.js";import"./radio-group-CC4lGE1V.js";import"./PermitPreviewDialog-B2XKKnFF.js";import"./checkbox-9q2dlFjr.js";import"./MMPStatusBadge-CjxSGCNB.js";const je=()=>{const{id:n}=$(),m=z(),{getMmpById:u,updateMMP:N,mmpFiles:G}=E(),{toast:f}=S(),[V,b]=l.useState(!0),[r,x]=l.useState(null),[C,w]=l.useState(0);l.useEffect(()=>{if(n){const s=u(n);s?x(s):(f({title:"MMP Not Found",description:`The MMP file with ID ${n} could not be found.`,variant:"destructive"}),m("/mmp")),b(!1)}},[n,u,m,f]),l.useEffect(()=>{if(!r)return;const s=r.processedEntries||0,i=r.entries||0;let t=i>0?Math.round(s/i*100):0;const o=r.permits;if(o&&Array.isArray(o.documents)&&o.documents.length>0){const p=o.documents.filter(c=>(c==null?void 0:c.status)==="verified").length,a=Math.round(p/o.documents.length*100);t=Math.round((t+a)/2)}w(t)},[r]);const h=()=>{m("/mmp")},j=(s,i)=>{var o,p;if(!r||!n)return;const t={...r};if(s==="permits")t.permits=i;else{t.cpVerification={...t.cpVerification,...i,verifiedAt:new Date().toISOString(),verificationStatus:(i==null?void 0:i.verificationStatus)||((o=t.cpVerification)==null?void 0:o.verificationStatus)||"in-progress"};const a=i!=null&&i.siteVerification?Object.values(i.siteVerification)[0]:void 0,c=(i==null?void 0:i.verifiedBy)||(a==null?void 0:a.verifiedBy)||void 0;c&&(t.verifiedBy=c),t.verifiedAt=new Date().toISOString();const y=((p=t.siteEntries)==null?void 0:p.length)||t.entries||0,k=i!=null&&i.siteVerification?Object.keys(i.siteVerification).length:0,T=Math.min(y,k);t.processedEntries=Math.max(t.processedEntries||0,T)}N(n,t),x(t),f({title:`${s==="permits"?"Permit":"Cooperating Partner"} Verification Complete`,description:`The ${s==="permits"?"permit":"cooperating partner"} verification has been successfully completed.`})};return V?e.jsx("div",{className:"container mx-auto p-4",children:e.jsx(d,{children:e.jsxs("div",{className:"p-8 flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"}),e.jsx("p",{className:"ml-3",children:"Loading detailed verification information..."})]})})}):r?e.jsx(L,{resource:"mmp",action:"approve",children:e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:h,className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Back to Basic Verification"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Detailed MMP Verification"}),e.jsx("p",{className:"text-muted-foreground",children:"Verify permits and cooperating partner information"})]})]}),e.jsx(O,{mmpFile:r,verificationProgress:C,onGoBack:h}),e.jsxs(F,{defaultValue:"permits",className:"space-y-6",children:[e.jsxs(D,{className:"grid w-full grid-cols-2",children:[e.jsx(M,{value:"permits",children:"Permits"}),e.jsx(M,{value:"cp",children:"Cooperating Partner"})]}),e.jsx(g,{value:"permits",children:e.jsx(d,{children:e.jsx(P,{className:"p-6",children:e.jsx(I,{mmpFile:r,onVerificationComplete:s=>j("permits",s)})})})}),e.jsx(g,{value:"cp",children:e.jsx(d,{children:e.jsx(P,{className:"p-6",children:e.jsx(A,{mmpFile:r,onVerificationComplete:s=>j("cp",s)})})})})]})]})}):e.jsx("div",{className:"container mx-auto p-4",children:e.jsx(d,{children:e.jsxs("div",{className:"p-8 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"text-red-500 bg-red-100 p-3 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-xl font-bold",children:"MMP File Not Found"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["The requested MMP file (ID: ",n,") could not be found or accessed."]}),e.jsx(v,{variant:"default",onClick:()=>m("/mmp"),children:"Return to MMP List"})]})})})};export{je as default};
