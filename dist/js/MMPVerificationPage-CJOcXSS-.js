import{j as e,ah as m,t as M}from"./react-core-B8kFjp2k.js";import{U as B,u as k,Z as T,C as F,f as D,g as S,h as I,b as E,a as n}from"./index-PwDgWEVM.js";import{M as O}from"./MMPComprehensiveVerification-E3LCHbkI.js";import{bI as U,bo as R}from"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./date-utils-YarVESQS.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";import"./progress-vMwTbqUI.js";import"./MMPPermitVerification-CyCVrban.js";import"./textarea-BpQMf5eL.js";import"./calendar-DEyRSxJX.js";import"./popover-BSK_FA51.js";import"./label-C4lDws8j.js";import"./select-CXX5Q_V1.js";import"./sudanStates-CkkbYUnU.js";import"./radio-group-CC4lGE1V.js";import"./PermitPreviewDialog-B2XKKnFF.js";import"./checkbox-9q2dlFjr.js";const xe=()=>{var h,f;const{id:l}=U(),o=R(),{getMmpById:N,updateMMP:y}=B(),{toast:v}=k(),{checkPermission:d,hasAnyRole:c}=T(),t=l?N(l):null,p=c(["admin"]),V=c(["fom","fieldOpManager"]),C=c(["coordinator"]),P=p||V||C||d("mmp","approve");if(d("mmp","approve"),!P)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(F,{className:"max-w-md mx-auto",children:[e.jsxs(D,{children:[e.jsx(S,{className:"text-destructive",children:"Access Denied"}),e.jsx(I,{children:"You don't have permission to access verification for this MMP."})]}),e.jsx(E,{children:e.jsx(n,{variant:"outline",onClick:()=>o("/mmp"),className:"w-full",children:"Back to MMP"})})]})});if(!t)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"MMP File Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"The requested MMP file could not be found."}),e.jsxs(n,{onClick:()=>o("/mmp"),children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Back to MMP Files"]})]})});const b=i=>{var j,u;if(!t.id)return;const a={comprehensiveVerification:i};if(i!=null&&i.cpVerification){a.cpVerification=i.cpVerification;const s=i.cpVerification;s!=null&&s.verifiedBy&&(a.verifiedBy=s.verifiedBy),s!=null&&s.verifiedAt&&(a.verifiedAt=s.verifiedAt);const r=((j=t.siteEntries)==null?void 0:j.length)||t.entries||0,w=s!=null&&s.siteVerification?Object.keys(s.siteVerification).length:0,g=Math.min(r,w);g>(t.processedEntries||0)&&(a.processedEntries=g)}if((u=i==null?void 0:i.permitVerification)!=null&&u.permits){const s=i.permitVerification.permits;a.permits={documents:s,verifiedBy:i.permitVerification.verifiedBy,lastVerified:i.permitVerification.verifiedAt,federal:s.some(r=>(r==null?void 0:r.permitType)==="federal"),state:s.some(r=>(r==null?void 0:r.permitType)==="state"),local:s.some(r=>(r==null?void 0:r.permitType)==="local")}}(i==null?void 0:i.overallStatus)==="complete"&&(a.verifiedAt=a.verifiedAt||new Date().toISOString(),a.verifiedBy=a.verifiedBy||"System"),y(t.id,a)},A=()=>{v({title:"Verification Complete!",description:"All verification steps have been completed. You can now proceed with approval."}),o(`/mmp/${t.id}`)},x=()=>{o(`/mmp/${t.id}`)};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs(n,{variant:"outline",onClick:x,className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),"Back to MMP File"]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"MMP Verification & Approval Process"}),e.jsxs("p",{className:"text-gray-600",children:["Complete verification and approval steps for ",e.jsx("strong",{children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{children:["MMP ID: ",t.mmpId]}),e.jsxs("span",{children:["Region: ",t.region]}),e.jsxs("span",{children:["Uploaded: ",new Date(t.uploadedAt).toLocaleDateString()]})]})]}),((h=t.comprehensiveVerification)==null?void 0:h.canProceedToApproval)&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600 bg-green-50 px-4 py-2 rounded-lg border border-green-200",children:[e.jsx(M,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Verification Complete"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsx(O,{mmpFile:t,onVerificationUpdate:b,onVerificationComplete:A})}),e.jsxs("div",{className:"mt-8 flex justify-between items-center",children:[e.jsxs(n,{variant:"outline",onClick:x,className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),"Back to MMP File"]}),((f=t.comprehensiveVerification)==null?void 0:f.canProceedToApproval)&&e.jsxs(n,{onClick:()=>o(`/mmp/${t.id}`),className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Proceed to Approval"]})]})]})};export{xe as default};
