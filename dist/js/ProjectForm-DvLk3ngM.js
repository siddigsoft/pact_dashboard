import{r as x,j as e,br as ae,a3 as me,l as L}from"./react-core-B8kFjp2k.js";import{u as he,t as je,o as xe,s as g,c as pe,d as W,e as _}from"./forms-CESK2FDA.js";import{u as ge,C as Se,f as ye,g as Ce,b as fe,I as J,a as P,H as K}from"./index-PwDgWEVM.js";import{T as ve}from"./textarea-BpQMf5eL.js";import{F as be,a as l,b as u,e as a,c as m,d as h}from"./form-BT_tmI7p.js";import{S,a as y,b as C,c as f,d as n}from"./select-CXX5Q_V1.js";import{P as z,a as X,b as Z}from"./popover-BSK_FA51.js";import{C as i}from"./calendar-DEyRSxJX.js";import{A as we}from"./ActivityManager-lZ-YmBoR.js";import{T as Pe}from"./TeamCompositionManager-DL5fiHxh.js";import{s as Ne}from"./sudanStates-CkkbYUnU.js";import{o as D}from"./date-utils-YarVESQS.js";const N=[{code:"SD",name:"Sudan",currency:{code:"SDG",symbol:"SDG",name:"Sudanese Pound"},regions:[{id:"darfur",name:"Darfur",states:[{id:"north-darfur",name:"North Darfur",localities:[{id:"el-fasher",name:"El Fasher"},{id:"mellit",name:"Mellit"}]},{id:"south-darfur",name:"South Darfur",localities:[{id:"nyala",name:"Nyala"},{id:"buram",name:"Buram"}]}]}]},{code:"SS",name:"South Sudan",currency:{code:"SSP",symbol:"SSP",name:"South Sudanese Pound"},regions:[{id:"equatoria",name:"Equatoria",states:[{id:"central-equatoria",name:"Central Equatoria",localities:[{id:"juba",name:"Juba"},{id:"yei",name:"Yei"}]}]}]},{code:"UG",name:"Uganda",currency:{code:"UGX",symbol:"USh",name:"Ugandan Shilling"},regions:[{id:"central",name:"Central Region",states:[{id:"kampala",name:"Kampala",localities:[{id:"central-division",name:"Central Division"},{id:"nakawa",name:"Nakawa"}]}]}]},{code:"RW",name:"Rwanda",currency:{code:"RWF",symbol:"RF",name:"Rwandan Franc"},regions:[{id:"kigali",name:"Kigali Province",states:[{id:"nyarugenge",name:"Nyarugenge",localities:[{id:"gitega",name:"Gitega"},{id:"nyamirambo",name:"Nyamirambo"}]}]}]},{code:"QA",name:"Qatar",currency:{code:"QAR",symbol:"ر.ق",name:"Qatari Riyal"},regions:[{id:"doha",name:"Doha",states:[{id:"doha-municipality",name:"Doha Municipality",localities:[{id:"west-bay",name:"West Bay"},{id:"pearl",name:"The Pearl"}]}]}]},{code:"US",name:"United States",currency:{code:"USD",symbol:"$",name:"US Dollar"},regions:[{id:"northeast",name:"Northeast",states:[{id:"ny",name:"New York",localities:[{id:"nyc",name:"New York City"},{id:"buffalo",name:"Buffalo"}]}]}]}],ee=j=>N.find(r=>r.code===j),Te=j=>{const r=ee(j);return(r==null?void 0:r.regions)||[]},re=(j,r)=>{const d=ee(j),v=d==null?void 0:d.regions.find(p=>p.id===r);return(v==null?void 0:v.states)||[]},Ve=(j,r,d)=>{const p=re(j,r).find(T=>T.id===d);return(p==null?void 0:p.localities)||[]},Fe=xe({name:g().min(3,{message:"Project name must be at least 3 characters."}),description:g().optional(),projectType:_(["infrastructure","survey","compliance","monitoring","training","other"]),status:_(["draft","active","onHold","completed","cancelled"]),startDate:W({required_error:"Start date is required."}),endDate:W({required_error:"End date is required."}).refine(j=>j>new Date,{message:"End date must be in the future"}),budgetTotal:pe.number().min(0).optional(),budgetCurrency:g(),country:g({required_error:"Country is required"}),region:g().optional(),selectedState:g().optional(),state:g().optional(),locality:g().optional()}),Ye=({onSubmit:j,initialData:r,isEditing:d=!1})=>{var M,q,A,I,O,B,k,$,G,H,Q,Y;const{toast:v}=ge(),[p,T]=x.useState(((M=r==null?void 0:r.location)==null?void 0:M.country)||""),[F,se]=x.useState(((q=r==null?void 0:r.location)==null?void 0:q.region)||""),[R,oe]=x.useState(((A=r==null?void 0:r.location)==null?void 0:A.state)||""),[U,E]=x.useState((I=r==null?void 0:r.location)!=null&&I.selectedStates&&r.location.selectedStates.length>0?r.location.selectedStates[0]:""),[Re,Ue]=x.useState(!1),[ce,ne]=x.useState(((O=r==null?void 0:r.team)==null?void 0:O.teamComposition)||[]),c=he({resolver:je(Fe),defaultValues:{name:(r==null?void 0:r.name)||"",description:(r==null?void 0:r.description)||"",projectType:(r==null?void 0:r.projectType)||"survey",status:(r==null?void 0:r.status)||"draft",startDate:r!=null&&r.startDate?new Date(r.startDate):new Date,endDate:r!=null&&r.endDate?new Date(r.endDate):new Date(Date.now()+30*24*60*60*1e3),budgetTotal:((B=r==null?void 0:r.budget)==null?void 0:B.total)||0,budgetCurrency:((k=r==null?void 0:r.budget)==null?void 0:k.currency)||"USD",country:(($=r==null?void 0:r.location)==null?void 0:$.country)||"",region:((G=r==null?void 0:r.location)==null?void 0:G.region)||"",selectedState:(H=r==null?void 0:r.location)!=null&&H.selectedStates&&r.location.selectedStates.length>0?r.location.selectedStates[0]:"",state:((Q=r==null?void 0:r.location)==null?void 0:Q.state)||"",locality:((Y=r==null?void 0:r.location)==null?void 0:Y.locality)||""}}),te=async s=>{try{const o=d&&(r!=null&&r.projectCode)?r.projectCode:`PROJ-${new Date().getFullYear()}-${Math.floor(Math.random()*1e3).toString().padStart(3,"0")}`,le=s.selectedState?[s.selectedState]:[],ue={id:(r==null?void 0:r.id)||`proj-${Date.now()}`,name:s.name,projectCode:o,description:s.description,projectType:s.projectType,status:s.status,startDate:s.startDate.toISOString(),endDate:s.endDate.toISOString(),budget:s.budgetTotal?{total:s.budgetTotal,currency:s.budgetCurrency,allocated:0,remaining:s.budgetTotal}:void 0,location:{country:s.country,region:s.region||"",selectedStates:le,state:s.state||"",locality:s.locality},team:{...(r==null?void 0:r.team)||{},teamComposition:ce},activities:(r==null?void 0:r.activities)||[],createdAt:(r==null?void 0:r.createdAt)||new Date().toISOString(),updatedAt:new Date().toISOString()};await j(ue),v({title:d?"Project Updated":"Project Created",description:`${s.name} has been ${d?"updated":"created"} successfully.`})}catch{v({title:"Error",description:"Failed to save project. Please try again.",variant:"destructive"})}},t=c.watch("country"),b=c.watch("region"),w=c.watch("state"),V=c.watch("selectedState");x.useEffect(()=>{if(t!==p){T(t),c.setValue("region",""),c.setValue("state",""),c.setValue("locality",""),c.setValue("selectedState",""),E("");const s=N.find(o=>o.code===t);s&&c.setValue("budgetCurrency",s.currency.code)}},[t,p,c]),x.useEffect(()=>{b!==F&&(se(b),c.setValue("state",""),c.setValue("locality",""))},[b,F,c]),x.useEffect(()=>{w!==R&&(oe(w),c.setValue("locality",""))},[w,R,c]),x.useEffect(()=>{V!==U&&E(V)},[V,U]);const de=s=>{ne(s)};return e.jsxs(Se,{className:"w-full",children:[e.jsx(ye,{children:e.jsx(Ce,{children:d?"Edit Project":"Create New Project"})}),e.jsx(fe,{children:e.jsx(be,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(te),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:c.control,name:"name",render:({field:s})=>e.jsxs(u,{children:[e.jsx(a,{children:"Project Name*"}),e.jsx(m,{children:e.jsx(J,{placeholder:"Enter project name",...s})}),e.jsx(h,{})]})}),e.jsx(l,{control:c.control,name:"projectType",render:({field:s})=>e.jsxs(u,{children:[e.jsx(a,{children:"Project Type*"}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Select project type"})})}),e.jsxs(f,{children:[e.jsx(n,{value:"infrastructure",children:"Infrastructure"}),e.jsx(n,{value:"survey",children:"Survey"}),e.jsx(n,{value:"compliance",children:"Compliance"}),e.jsx(n,{value:"monitoring",children:"Monitoring"}),e.jsx(n,{value:"training",children:"Training"}),e.jsx(n,{value:"other",children:"Other"})]})]}),e.jsx(h,{})]})}),e.jsx(l,{control:c.control,name:"status",render:({field:s})=>e.jsxs(u,{children:[e.jsx(a,{children:"Status*"}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Select status"})})}),e.jsxs(f,{children:[e.jsx(n,{value:"draft",children:"Draft"}),e.jsx(n,{value:"active",children:"Active"}),e.jsx(n,{value:"onHold",children:"On Hold"}),e.jsx(n,{value:"completed",children:"Completed"}),e.jsx(n,{value:"cancelled",children:"Cancelled"})]})]}),e.jsx(h,{})]})}),e.jsx(l,{control:c.control,name:"country",render:({field:s})=>e.jsxs(u,{children:[e.jsx(a,{children:"Country*"}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Select country"})})}),e.jsx(f,{children:N.map(o=>e.jsx(n,{value:o.code,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),o.name]})},o.code))})]}),e.jsx(h,{})]})}),t==="SD"&&e.jsx(l,{control:c.control,name:"selectedState",render:({field:s})=>e.jsxs(u,{children:[e.jsxs(a,{className:"flex items-center text-sm",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Sudan State (Optional)"]}),e.jsxs(S,{onValueChange:s.onChange,value:s.value||void 0,children:[e.jsx(m,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Select a state (optional)"})})}),e.jsxs(f,{children:[e.jsx(n,{value:"none",children:"None"}),Ne.map(o=>e.jsx(n,{value:o.id,children:o.name},o.id))]})]}),e.jsx(h,{})]})}),t&&t!=="SD"&&e.jsx(l,{control:c.control,name:"region",render:({field:s})=>e.jsxs(u,{children:[e.jsx(a,{children:"Region"}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Select region"})})}),e.jsx(f,{children:Te(t).map(o=>e.jsx(n,{value:o.id,children:o.name},o.id))})]}),e.jsx(h,{})]})}),t&&t!=="SD"&&b&&e.jsx(l,{control:c.control,name:"state",render:({field:s})=>e.jsxs(u,{children:[e.jsx(a,{children:"State"}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Select state"})})}),e.jsx(f,{children:re(t,b).map(o=>e.jsx(n,{value:o.id,children:o.name},o.id))})]}),e.jsx(h,{})]})}),t&&t!=="SD"&&b&&w&&e.jsx(l,{control:c.control,name:"locality",render:({field:s})=>e.jsxs(u,{children:[e.jsx(a,{children:"Locality"}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Select locality"})})}),e.jsx(f,{children:Ve(t,b,w).map(o=>e.jsx(n,{value:o.id,children:o.name},o.id))})]}),e.jsx(h,{})]})}),e.jsx(l,{control:c.control,name:"budgetTotal",render:({field:s})=>e.jsxs(u,{children:[e.jsx(a,{children:"Budget Total"}),e.jsx(m,{children:e.jsx(J,{type:"number",placeholder:"Enter budget amount",...s,onChange:o=>s.onChange(o.target.valueAsNumber)})}),e.jsx(h,{})]})}),e.jsx(l,{control:c.control,name:"budgetCurrency",render:({field:s})=>e.jsxs(u,{children:[e.jsx(a,{children:"Currency"}),e.jsxs(S,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Select currency"})})}),e.jsx(f,{children:N.map(o=>e.jsxs(n,{value:o.currency.code,children:[o.currency.code," - ",o.currency.name]},o.currency.code))})]}),e.jsx(h,{})]})}),e.jsx(l,{control:c.control,name:"startDate",render:({field:s})=>e.jsxs(u,{className:"flex flex-col",children:[e.jsx(a,{children:"Start Date*"}),e.jsxs(z,{children:[e.jsx(X,{asChild:!0,children:e.jsx(m,{children:e.jsxs(P,{variant:"outline",className:K("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?D(s.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(L,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(Z,{className:"w-auto p-0",align:"start",children:e.jsx(i,{mode:"single",selected:s.value,onSelect:s.onChange,initialFocus:!0,className:"pointer-events-auto"})})]}),e.jsx(h,{})]})}),e.jsx(l,{control:c.control,name:"endDate",render:({field:s})=>e.jsxs(u,{className:"flex flex-col",children:[e.jsx(a,{children:"End Date*"}),e.jsxs(z,{children:[e.jsx(X,{asChild:!0,children:e.jsx(m,{children:e.jsxs(P,{variant:"outline",className:K("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?D(s.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(L,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(Z,{className:"w-auto p-0",align:"start",children:e.jsx(i,{mode:"single",selected:s.value,onSelect:s.onChange,initialFocus:!0,className:"pointer-events-auto"})})]}),e.jsx(h,{})]})})]}),e.jsx(l,{control:c.control,name:"description",render:({field:s})=>e.jsxs(u,{children:[e.jsx(a,{children:"Description"}),e.jsx(m,{children:e.jsx(ve,{placeholder:"Enter project description",className:"resize-none",...s})}),e.jsx(h,{})]})}),d&&(r==null?void 0:r.id)&&e.jsx(Pe,{project:r,onTeamChange:de}),e.jsx("div",{className:"border-t pt-6",children:d&&(r==null?void 0:r.id)&&e.jsx(we,{activities:(r==null?void 0:r.activities)||[],onActivitiesChange:s=>{if(r){const o={...r,activities:s};j(o)}},projectType:c.watch("projectType")})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(P,{type:"button",variant:"outline",children:"Cancel"}),e.jsx(P,{type:"submit",className:"bg-primary",children:d?"Update Project":"Create Project"})]})]})})})]})};export{Ye as P};
