import{r as h,j as e,ae as Be,bI as is,by as ns,am as cs,aw as os,h as ds,bD as ms,a3 as xs,bJ as hs,m as ne,y as ce,b as X,X as B,q as Z,a8 as ps,u as us,U as Oe,al as We,bs as js,K as re,ag as fs,n as gs,v as vs,af as qe,a0 as bs}from"./react-core-B8kFjp2k.js";import{af as Ie,C as S,a as j,e as ge,B as U,b as O,f as H,g as K,A as ve,c as be,d as Ne,h as Ns,r as ws,E as ys,Z as Cs,u as As,T as Us,i as Rs,j as pe,k as ue,I as Ss,D as Fe,l as Je,m as Ve,n as ks,o as Is,p as Qe,ab as _s,s as M}from"./index-PwDgWEVM.js";import{s as Q,h as je}from"./sudanStates-CkkbYUnU.js";import{S as we,a as ye,b as Ce,c as Ae,d as $}from"./select-CXX5Q_V1.js";import{T as Ue,a as Re,b as T,c as f,d as Se,e as p}from"./table-CZ8ZB6wW.js";import{U as ke,R as fe}from"./UserClassificationBadge-nu7nDiDQ.js";import{L as ie}from"./router-CKy9yO3R.js";import"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./date-utils-YarVESQS.js";import"./jspdf-rld7HkB6.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";import"./ClassificationBadge-CQcKQdLP.js";const Ts=({users:c,onRoleClick:u,onStateChange:w,selectedState:b,onHubChange:g,selectedHub:n})=>{const[I,o]=h.useState(Q),{roles:k,getUserRolesByUserId:A}=Ie(),W=a=>c.reduce((d,x)=>{const R=x.role===a||Array.isArray(x.roles)&&x.roles.includes(a)||A(x.id).some(_=>_.role===a);return d+(R?1:0)},0),G=a=>c.reduce((d,x)=>{const R=A(x.id).some(_=>_.role_id===a);return d+(R?1:0)},0),D=c.reduce((a,d)=>(d.stateId&&(a[d.stateId]=(a[d.stateId]||0)+1),a),{}),m=c.reduce((a,d)=>{if(d.stateId){const x=je.find(R=>R.states.includes(d.stateId||""));x&&(a[x.id]=(a[x.id]||0)+1)}return a},{});h.useEffect(()=>{if(n&&n!=="all"){const a=je.find(d=>d.id===n);if(a){const d=Q.filter(x=>a.states.includes(x.id));o(d),b&&!a.states.includes(b)&&w&&w(null)}else o(Q)}else o(Q)},[n,b,w]);const y=[{role:"admin",displayName:"Admin",icon:Be,color:"text-blue-600",bgColor:"bg-blue-100"},{role:"ict",displayName:"ICT",icon:is,color:"text-purple-600",bgColor:"bg-purple-100"},{role:"fom",displayName:"FOM",icon:ns,color:"text-green-600",bgColor:"bg-green-100"},{role:"supervisor",displayName:"Supervisor",icon:cs,color:"text-amber-600",bgColor:"bg-amber-100"},{role:"coordinator",displayName:"Coordinator",icon:os,color:"text-red-600",bgColor:"bg-red-100"},{role:"dataCollector",displayName:"Data Collector",icon:ds,color:"text-cyan-600",bgColor:"bg-cyan-100"}],z=a=>{u&&u(a)},oe=a=>{w&&w(a==="all"?null:a)},L=a=>{g&&g(a==="all"?null:a)},de=()=>{g&&g(null),w&&w(null),o(Q)};return e.jsxs("div",{className:"space-y-6 mb-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-6",children:[y.map(a=>{const d=W(a.role),x=a.icon;return e.jsxs(S,{className:"hover:shadow-lg transition-all duration-300 ease-in-out transform hover:-translate-y-1 flex flex-col items-center justify-center p-4 cursor-pointer",onClick:()=>z(`sys:${a.role}`),children:[e.jsx("div",{className:`${a.bgColor} p-4 rounded-full shadow-md flex items-center justify-center mb-3`,"aria-label":`${a.role} (${d} users)`,title:`${a.role} (${d} users)`,children:e.jsx(x,{className:`${a.color}`,size:32,strokeWidth:1.5})}),e.jsxs("p",{className:"font-bold text-center font-sans text-sm tracking-wide",children:[a.displayName,e.jsxs("span",{className:"block text-xs text-gray-500 font-normal mt-1",children:[d," ",d===1?"user":"users"]})]})]},a.role)}),k.filter(a=>!a.is_system_role).map(a=>{const d=G(a.id),x=Be,R=`custom:${a.id}`;return e.jsxs(S,{className:"hover:shadow-lg transition-all duration-300 ease-in-out transform hover:-translate-y-1 flex flex-col items-center justify-center p-4 cursor-pointer",onClick:()=>z(R),children:[e.jsx("div",{className:"bg-slate-100 p-4 rounded-full shadow-md flex items-center justify-center mb-3","aria-label":`${a.display_name||a.name} (${d} users)`,title:`${a.display_name||a.name} (${d} users)`,children:e.jsx(x,{className:"text-slate-600",size:32,strokeWidth:1.5})}),e.jsxs("p",{className:"font-bold text-center font-sans text-sm tracking-wide",children:[a.display_name||a.name,e.jsxs("span",{className:"block text-xs text-gray-500 font-normal mt-1",children:[d," ",d===1?"user":"users"]})]})]},R)})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 border rounded-lg p-3 bg-gray-50 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-sm",children:"Hub Office:"})]}),e.jsxs(we,{value:n||"all",onValueChange:L,children:[e.jsx(ye,{className:"w-[180px]",children:e.jsx(Ce,{placeholder:"Select hub office"})}),e.jsxs(Ae,{children:[e.jsx($,{value:"all",children:"All Hub Offices"}),je.map(a=>e.jsxs($,{value:a.id,children:[a.name," ",m[a.id]?`(${m[a.id]})`:""]},a.id))]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 border rounded-lg p-3 bg-gray-50 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-sm",children:"State:"})]}),e.jsxs(we,{value:b||"all",onValueChange:oe,disabled:!n||n==="all",children:[e.jsx(ye,{className:"w-[180px]",children:e.jsx(Ce,{placeholder:"Select state"})}),e.jsxs(Ae,{children:[e.jsx($,{value:"all",children:"All States"}),I.map(a=>e.jsxs($,{value:a.id,children:[a.name," ",D[a.id]?`(${D[a.id]})`:""]},a.id))]})]})]}),(n||b)&&e.jsxs(j,{variant:"outline",size:"sm",onClick:de,className:"flex items-center gap-1",children:[e.jsx(hs,{className:"h-4 w-4"}),"Reset Filters"]})]})]})},$s=({users:c})=>{const{hasRole:u}=ge(),{users:w}=ge(),b=c||w,{getUserRolesByUserId:g,roles:n}=Ie(),I=b.filter(o=>o.role==="admin"?!0:o.roles&&Array.isArray(o.roles)?o.roles.includes("admin"):!1);return I.length===0?e.jsx(S,{className:"p-6 bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-700/30 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 dark:text-amber-400",children:[e.jsx(ne,{size:20}),e.jsx("p",{children:"No admin users found in the system."})]})}):e.jsxs(S,{className:"overflow-hidden border mb-6",children:[e.jsxs("div",{className:"bg-muted/50 p-4 flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 text-primary"}),e.jsxs("h3",{className:"font-medium",children:["System Administrators (",I.length,")"]})]}),e.jsxs(Ue,{children:[e.jsx(Re,{children:e.jsxs(T,{children:[e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Email"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Classification"}),e.jsx(f,{children:"Roles"})]})}),e.jsx(Se,{children:I.map(o=>e.jsxs(T,{children:[e.jsxs(p,{className:"font-medium flex items-center gap-2",children:[o.avatar?e.jsx("img",{src:o.avatar,alt:o.name,className:"h-8 w-8 rounded-full object-cover"}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ce,{size:16,className:"text-primary"})}),o.name||o.fullName||o.username||"Unknown User"]}),e.jsx(p,{children:o.email}),e.jsx(p,{children:o.isApproved?e.jsx("div",{className:"flex items-center",children:e.jsxs(U,{variant:"success",className:"bg-green-100 text-green-800 hover:bg-green-200",children:[e.jsx(X,{size:12,className:"mr-1"})," Active"]})}):e.jsx("div",{className:"flex items-center",children:e.jsxs(U,{variant:"destructive",className:"bg-red-100 text-red-800 hover:bg-red-200",children:[e.jsx(B,{size:12,className:"mr-1"})," Pending"]})})}),e.jsx(p,{children:e.jsx(ke,{userId:o.id})}),e.jsx(p,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(()=>{const k=g(o.id),A=new Set;o.role&&A.add(o.role),Array.isArray(o.roles)&&o.roles.forEach(m=>A.add(m)),k.forEach(m=>{m.role&&A.add(m.role)});const W=Array.from(A),G=k.filter(m=>m.role_id).map(m=>{const y=n.find(z=>z.id===m.role_id);return(y==null?void 0:y.display_name)||(y==null?void 0:y.name)||"custom"}),D=[...W,...G];return D.length>0?D.map((m,y)=>e.jsx(U,{variant:m==="admin"?"default":"outline",children:m},y)):e.jsx(U,{variant:o.role==="admin"?"default":"outline",children:o.role})})()})})]},o.id))})]})]})},Ds=({pendingUsers:c,onApprove:u,onReject:w,isLoadingApproval:b})=>{const g=n=>n.split(" ").map(I=>I[0]).join("").toUpperCase();return c.length===0?e.jsx(S,{className:"bg-gray-50 dark:bg-gray-950",children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center",children:[e.jsx(Z,{className:"h-12 w-12 text-muted-foreground mb-3"}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"No Pending Approvals"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"All users have been approved. New users will appear here when they register."})]})})}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Pending Approvals (",c.length,")"]}),e.jsx("p",{className:"text-muted-foreground",children:"Users waiting for account approval"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(n=>e.jsxs(S,{className:"overflow-hidden border-amber-200 dark:border-amber-800",children:[e.jsxs(H,{className:"bg-amber-50 dark:bg-amber-900/20 pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs(U,{variant:"outline",className:"bg-amber-100 text-amber-800 mb-2",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"})," Pending Approval"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(n.createdAt||Date.now()).toLocaleDateString()})]}),e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsxs(ve,{className:"h-8 w-8",children:[e.jsx(be,{src:n.avatar}),e.jsx(Ne,{className:"bg-primary/10 text-primary",children:n.name?g(n.name):e.jsx(ce,{className:"h-4 w-4"})})]}),n.name||"Unnamed User"]}),e.jsx(Ns,{children:n.role||"No role assigned"})]}),e.jsx(O,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ps,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm truncate",children:n.email})]}),n.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:n.phone})]}),n.employeeId&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Employee ID:"}),e.jsx("span",{className:"text-sm",children:n.employeeId})]})]})}),e.jsxs(ws,{className:"flex justify-between pt-2 gap-2",children:[e.jsxs(j,{variant:"default",className:"w-full",size:"sm",onClick:()=>u(n.id),disabled:b===n.id,children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),b===n.id?"Processing...":"Approve"]}),e.jsxs(j,{variant:"outline",className:"w-full",size:"sm",onClick:()=>w(n.id),disabled:b===n.id,children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),b===n.id?"Processing...":"Reject"]})]})]},n.id))})]})},zs=["admin","ict","fom","financialAdmin","supervisor","coordinator","dataCollector","reviewer"],ta=()=>{const{currentUser:c,users:u,approveUser:w,rejectUser:b,refreshUsers:g,hasRole:n,addRole:I,removeRole:o}=ys(),{roles:k,getUserRolesByUserId:A,assignRoleToUser:W,removeRoleFromUser:G}=Ie(),{canManageRoles:D}=Cs(),{toast:m}=As(),{roles:y}=ge(),[z,oe]=h.useState(u),[L,de]=h.useState(""),[a,d]=h.useState(null),[x,R]=h.useState(null),[_,_e]=h.useState(null),[q,Y]=h.useState(null),[P,Te]=h.useState(!1),[ee,se]=h.useState("all-users"),[He,Es]=h.useState(!0),[v,me]=h.useState(null),[E,ae]=h.useState(""),[$e,De]=h.useState(!1),[C,F]=h.useState({open:!1}),[xe,ze]=h.useState(null),J=h.useMemo(()=>u.filter(s=>!s.isApproved),[u]),te=h.useMemo(()=>u.filter(s=>s.isApproved),[u]),Ke=(y||[]).includes("admin")||(y||[]).includes("ict"),Xe=s=>{const r=A(s).map(l=>{if(l.role)return l.role;if(l.role_id){const i=k.find(N=>N.id===l.role_id);return(i==null?void 0:i.display_name)||(i==null?void 0:i.name)||"custom"}return"custom"});return Array.from(new Set(r))},Ee=s=>{const t=A(s.id),r=t.find(i=>!!i.role);if(r!=null&&r.role)return r.role;const l=t.find(i=>!!i.role_id);if(l!=null&&l.role_id){const i=k.find(N=>N.id===l.role_id);return(i==null?void 0:i.display_name)||(i==null?void 0:i.name)||"custom"}return s.role},he=async()=>{Te(!0);try{await g(),m({title:"Users refreshed",description:"Successfully synchronized with Supabase database"})}catch{m({title:"Refresh failed",description:"Could not fetch users from database",variant:"destructive"})}finally{setTimeout(()=>{Te(!1)},1e3)}};h.useEffect(()=>{he();const s=setInterval(()=>{g().catch(t=>{})},6e4);return()=>clearInterval(s)},[]),h.useEffect(()=>{let s=u;ee==="pending-approvals"?s=J:ee==="approved-users"&&(s=te);let t=s;if(L){const r=L.toLowerCase();t=t.filter(l=>{var i,N,le;return((i=l.name)==null?void 0:i.toLowerCase().includes(r))||((N=l.email)==null?void 0:N.toLowerCase().includes(r))||((le=l.phone)==null?void 0:le.toLowerCase().includes(r))})}if(a)if(a.startsWith("sys:")){const r=a.slice(4);t=t.filter(l=>l.role===r||l.roles&&l.roles.includes(r)||A(l.id).some(i=>i.role===r))}else if(a.startsWith("custom:")){const r=a.slice(7);t=t.filter(l=>A(l.id).some(i=>i.role_id===r))}else t=t.filter(r=>r.role===a||r.roles&&r.roles.includes(a));x&&(t=t.filter(r=>r.stateId===x)),_&&(t=t.filter(r=>r.hubId===_)),oe(t)},[u,ee,L,a,x,_]);const Ze=s=>{d(a===s?null:s)},Le=s=>s.split(" ").map(t=>t[0]).join("").toUpperCase(),Ge=s=>{me(s),ae("")},Ye=()=>{me(null),ae("")},es=async()=>{if(!(!v||!E)){De(!0);try{let s=!1;if(E.startsWith("sys:")){const t=E.slice(4),{error:r}=await M.from("user_roles").delete().eq("user_id",v.id);if(r)throw r;s=await I(v.id,t);const{error:l}=await M.from("profiles").update({role:t}).eq("id",v.id);if(l)throw l;const i=localStorage.getItem(`user-${v.id}`);if(i)try{const N=JSON.parse(i);localStorage.setItem(`user-${v.id}`,JSON.stringify({...N,role:t,roles:[t]}))}catch{}await g()}else if(E.startsWith("custom:")){const t=E.slice(7),{error:r}=await M.from("user_roles").delete().eq("user_id",v.id);if(r)throw r;s=await W({user_id:v.id,role_id:t});const{error:l}=await M.from("profiles").update({role:"custom"}).eq("id",v.id);if(l)throw l;const i=localStorage.getItem(`user-${v.id}`);if(i)try{const N=JSON.parse(i);localStorage.setItem(`user-${v.id}`,JSON.stringify({...N,role:"custom",roles:[]}))}catch{}await g()}s||m({title:"Role update failed",description:"The role could not be updated. Check permissions or try again.",variant:"destructive"})}catch{m({title:"Role update failed",description:"There was an error updating the user's role.",variant:"destructive"})}finally{De(!1),me(null),ae("")}}},Pe=async s=>{Y(s);try{await w(s)&&(m({title:"User approved",description:"The user has been successfully approved and can now log in."}),await g())}catch{m({title:"Approval failed",description:"There was an error approving the user.",variant:"destructive"})}finally{Y(null)}},Me=async s=>{Y(s);try{await b(s)&&(m({title:"User rejected",description:"The user has been removed from the system."}),await g())}catch{m({title:"Rejection failed",description:"There was an error rejecting the user.",variant:"destructive"})}finally{Y(null)}},ss=s=>{F({open:!0,userId:s,action:"delete"})},as=s=>{F({open:!0,userId:s,action:"deactivate"})},ts=async s=>{await M.from("profiles").delete().eq("id",s)},ls=async s=>{await M.from("profiles").update({is_active:!1}).eq("id",s)},rs=async()=>{if(C.action==="delete"&&C.userId){ze(C.userId);const s=u.find(t=>t.id===C.userId);await ts(C.userId),await g(),ze(null),m({title:"User deleted",description:`${(s==null?void 0:s.name)||"User"} has been successfully deleted from the system.`,variant:"success"})}else C.action==="deactivate"&&C.userId&&(await ls(C.userId),await g());F({open:!1})},V={totalUsers:u.length,pendingApprovals:J.length,approvedUsers:te.length,totalRoles:Array.from(new Set(u.map(s=>Ee(s)))).length};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"h-8 w-8 text-blue-600"}),"Users Management"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"View and manage user accounts and permissions"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:he,disabled:P,"data-testid":"button-refresh-users",children:[e.jsx(We,{className:`mr-2 h-4 w-4 ${P?"animate-spin":""}`}),P?"Refreshing...":"Refresh"]}),e.jsx(j,{size:"sm",asChild:!0,"data-testid":"button-add-user",children:e.jsxs(ie,{to:"/register",children:[e.jsx(js,{className:"mr-2 h-4 w-4"}),"Add User"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(S,{className:"hover-elevate active-elevate-2 cursor-pointer overflow-hidden relative bg-gradient-to-br from-blue-500 to-blue-700 text-white border-0",onClick:()=>se("all-users"),"data-testid":"card-total-users",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(K,{className:"text-sm font-medium text-white/90",children:"Total Users"}),e.jsx(Oe,{className:"h-5 w-5 text-white/80"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:V.totalUsers}),e.jsx("p",{className:"text-xs text-white/80 mt-1",children:"Click to view all users"})]}),e.jsx(re,{className:"absolute -right-4 -bottom-4 h-24 w-24 text-white/10"})]}),e.jsxs(S,{className:"hover-elevate active-elevate-2 cursor-pointer overflow-hidden relative bg-gradient-to-br from-green-500 to-emerald-700 text-white border-0",onClick:()=>se("approved-users"),"data-testid":"card-approved-users",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(K,{className:"text-sm font-medium text-white/90",children:"Approved Users"}),e.jsx(fs,{className:"h-5 w-5 text-white/80"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:V.approvedUsers}),e.jsx("p",{className:"text-xs text-white/80 mt-1",children:"Active in the system"})]}),e.jsx(re,{className:"absolute -right-4 -bottom-4 h-24 w-24 text-white/10"})]}),e.jsxs(S,{className:"hover-elevate active-elevate-2 cursor-pointer overflow-hidden relative bg-gradient-to-br from-purple-500 to-purple-700 text-white border-0",onClick:()=>se("pending-approvals"),"data-testid":"card-pending-approvals",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(K,{className:"text-sm font-medium text-white/90",children:"Pending Approvals"}),e.jsx(Z,{className:"h-5 w-5 text-white/80"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:V.pendingApprovals}),e.jsx("p",{className:"text-xs text-white/80 mt-1",children:V.pendingApprovals>0?"Click to review":"No pending approvals"})]}),e.jsx(re,{className:"absolute -right-4 -bottom-4 h-24 w-24 text-white/10"})]}),e.jsxs(S,{className:"hover-elevate active-elevate-2 cursor-pointer overflow-hidden relative bg-gradient-to-br from-orange-500 to-red-600 text-white border-0","data-testid":"card-unique-roles",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(K,{className:"text-sm font-medium text-white/90",children:"Unique Roles"}),e.jsx(gs,{className:"h-5 w-5 text-white/80"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:V.totalRoles}),e.jsx("p",{className:"text-xs text-white/80 mt-1",children:"Active role types"})]}),e.jsx(re,{className:"absolute -right-4 -bottom-4 h-24 w-24 text-white/10"})]})]}),u.length===0&&e.jsx(S,{className:"p-6 bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-700/30 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 dark:text-amber-400",children:[e.jsx(Z,{size:20}),e.jsx("p",{children:"No users found. If you've added users in Supabase, click Refresh Users to sync them."})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:he,disabled:P,children:[e.jsx(We,{className:`mr-2 h-4 w-4 ${P?"animate-spin":""}`}),P?"Refreshing...":"Refresh Users"]})]})}),e.jsxs(Us,{value:ee,onValueChange:se,className:"mb-6",children:[e.jsxs(Rs,{children:[e.jsx(pe,{value:"all-users",children:"All Users"}),e.jsxs(pe,{value:"pending-approvals",className:"flex items-center gap-1",children:["Pending Approvals",J.length>0&&e.jsx(U,{variant:"secondary",className:"ml-1 bg-amber-100 text-amber-800",children:J.length})]}),e.jsx(pe,{value:"approved-users",children:"Approved Users"})]}),e.jsxs(ue,{value:"all-users",className:"mt-0",children:[He&&e.jsx($s,{}),e.jsx("div",{className:"my-6",children:e.jsx(Ts,{users:u,onRoleClick:Ze,onStateChange:R,selectedState:x,onHubChange:_e,selectedHub:_})}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"w-full md:w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(vs,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Ss,{type:"search",placeholder:"Search users...",className:"pl-8",value:L,onChange:s=>de(s.target.value)})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[a&&e.jsxs(U,{variant:"outline",className:"flex items-center gap-1",children:["Role: ",(()=>{if(a.startsWith("sys:"))return a.slice(4);if(a.startsWith("custom:")){const s=a.slice(7),t=k.find(r=>r.id===s);return(t==null?void 0:t.display_name)||(t==null?void 0:t.name)||"custom"}return a})(),e.jsx("button",{onClick:()=>d(null),className:"ml-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 p-0.5",children:e.jsx(B,{className:"h-3 w-3"})})]}),x&&e.jsxs(U,{variant:"outline",className:"flex items-center gap-1",children:["State filter active",e.jsx("button",{onClick:()=>R(null),className:"ml-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 p-0.5",children:e.jsx(B,{className:"h-3 w-3"})})]}),_&&e.jsxs(U,{variant:"outline",className:"flex items-center gap-1",children:["Hub filter active",e.jsx("button",{onClick:()=>_e(null),className:"ml-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 p-0.5",children:e.jsx(B,{className:"h-3 w-3"})})]})]})]}),e.jsx("div",{className:"relative overflow-hidden border rounded-lg",children:e.jsxs(Ue,{children:[e.jsx(Re,{children:e.jsxs(T,{children:[e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Email"}),e.jsx(f,{children:"Role"}),e.jsx(f,{children:"Classification"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Last Active"}),e.jsx(f,{className:"text-right",children:"Actions"})]})}),e.jsx(Se,{children:z.length>0?z.map(s=>{if(c&&s.id===c.id)return null;const t=s.lastActive?new Date(s.lastActive):null,l=t?Math.round((new Date().getTime()-t.getTime())/(1e3*60)):null,i=l===null?"Unknown":l<5?"Just now":l<60?`${l}m ago`:l<24*60?`${Math.round(l/60)}h ago`:`${Math.round(l/(60*24))}d ago`;Ee(s);const N=c&&(c.role==="admin"||c.role==="Admin"||c.roles&&Array.isArray(c.roles)&&(c.roles.includes("admin")||c.roles.includes("Admin"))),le=D();return e.jsxs(T,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ve,{children:[e.jsx(be,{src:s.avatar}),e.jsx(Ne,{className:"bg-primary/10 text-primary",children:s.name?Le(s.name):e.jsx(ce,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.phone||"-"})]})]})}),e.jsx(p,{children:s.email}),e.jsx(p,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:e.jsx(fe,{role:s.role,size:"sm"})})}),e.jsx(p,{children:e.jsx(ke,{userId:s.id})}),e.jsx(p,{children:s.isApproved?e.jsx("div",{className:"flex items-center",children:e.jsxs(U,{variant:"success",className:"bg-green-100 text-green-800 hover:bg-green-200",children:[e.jsx(X,{size:12,className:"mr-1"})," Approved"]})}):e.jsx("div",{className:"flex items-center",children:e.jsxs(U,{variant:"destructive",className:"bg-amber-100 text-amber-800 hover:bg-amber-200",children:[e.jsx(Z,{size:12,className:"mr-1"})," Pending"]})})}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`h-2 w-2 rounded-full 
                              ${s.availability==="online"?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:i})]})}),e.jsxs(p,{className:"text-right",children:[!s.isApproved&&N&&e.jsxs("div",{className:"flex justify-end gap-2 mb-2",children:[e.jsxs(j,{variant:"default",size:"sm",onClick:()=>Pe(s.id),disabled:q===s.id,children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),q===s.id?"Processing...":"Approve"]}),e.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>Me(s.id),disabled:q===s.id,children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),q===s.id?"Processing...":"Reject"]})]}),e.jsx(j,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(ie,{to:`/users/${s.id}`,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Manage"]})}),le&&e.jsx(j,{variant:"outline",size:"sm",className:"ml-2",asChild:!0,children:e.jsxs(ie,{to:"/role-management",className:"flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Manage Roles"]})}),Ke&&e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>ss(s.id),disabled:xe===s.id,children:[xe===s.id?e.jsx(bs,{className:"h-4 w-4 animate-spin mr-2"}):null,"Delete"]}),e.jsx(j,{variant:"outline",size:"sm",className:"ml-2",onClick:()=>as(s.id),disabled:xe===s.id,children:"Deactivate"})]})]})]},s.id)}):e.jsx(T,{children:e.jsx(p,{colSpan:6,className:"text-center py-6 text-muted-foreground",children:"No users found matching your criteria"})})})]})})]}),e.jsx(ue,{value:"pending-approvals",className:"mt-0",children:e.jsx(Ds,{pendingUsers:J,onApprove:Pe,onReject:Me,isLoadingApproval:q})}),e.jsx(ue,{value:"approved-users",className:"mt-0",children:e.jsx("div",{className:"relative overflow-hidden border rounded-lg",children:e.jsxs(Ue,{children:[e.jsx(Re,{children:e.jsxs(T,{children:[e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Email"}),e.jsx(f,{children:"Role"}),e.jsx(f,{children:"Classification"}),e.jsx(f,{children:"Status"}),e.jsx(f,{className:"text-right",children:"Actions"})]})}),e.jsx(Se,{children:te.length>0?te.map(s=>{if(c&&s.id===c.id)return null;const t=Xe(s.id),r=c&&(c.role==="admin"||c.role==="Admin"||c.roles&&Array.isArray(c.roles)&&(c.roles.includes("admin")||c.roles.includes("Admin")));return e.jsxs(T,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ve,{children:[e.jsx(be,{src:s.avatar}),e.jsx(Ne,{className:"bg-primary/10 text-primary",children:s.name?Le(s.name):e.jsx(ce,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.phone||"-"})]})]})}),e.jsx(p,{children:s.email}),e.jsx(p,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:t.length>0?t.map((l,i)=>e.jsx(fe,{role:l,size:"sm"},i)):e.jsx(fe,{role:s.role,size:"sm"})})}),e.jsx(p,{children:e.jsx(ke,{userId:s.id})}),e.jsx(p,{children:e.jsxs(U,{variant:"success",className:"bg-green-100 text-green-800 hover:bg-green-200",children:[e.jsx(X,{size:12,className:"mr-1"})," Active"]})}),e.jsxs(p,{className:"text-right",children:[e.jsx(j,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(ie,{to:`/users/${s.id}`,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Manage"]})}),r&&e.jsxs(j,{variant:"outline",size:"sm",className:"ml-2",onClick:()=>Ge(s),children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Edit Roles"]})]})]},s.id)}):e.jsx(T,{children:e.jsx(p,{colSpan:6,className:"text-center py-6 text-muted-foreground",children:"No approved users found"})})})]})})})]}),e.jsx(Fe,{open:!!v,onOpenChange:Ye,children:e.jsxs(Je,{children:[e.jsxs(Ve,{children:[e.jsx(ks,{children:"Edit Role"}),e.jsxs(Is,{children:["Select a new role for"," ",e.jsx("span",{className:"font-bold",children:(v==null?void 0:v.name)??""})]})]}),e.jsx("div",{className:"mb-3",children:e.jsxs(we,{value:E,onValueChange:s=>ae(s),children:[e.jsx(ye,{className:"w-full",children:e.jsx(Ce,{placeholder:"Select role"})}),e.jsxs(Ae,{children:[e.jsx($,{disabled:!0,value:"__sys_label",children:"System Roles"}),zs.map(s=>e.jsx($,{value:`sys:${s}`,children:s},`sys:${s}`)),k.filter(s=>!s.is_system_role).length>0&&e.jsx($,{disabled:!0,value:"__custom_label",children:"Custom Roles"}),k.filter(s=>!s.is_system_role).map(s=>e.jsx($,{value:`custom:${s.id}`,children:s.display_name||s.name},`custom:${s.id}`))]})]})}),e.jsxs(Qe,{children:[e.jsx(j,{type:"button",onClick:es,disabled:!E||$e,children:$e?"Updating...":"Update Role"}),e.jsx(_s,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",children:"Cancel"})})]})]})}),e.jsx(Fe,{open:C.open,onOpenChange:s=>F(t=>({...t,open:s})),children:e.jsxs(Je,{children:[e.jsxs(Ve,{children:["Confirm ",C.action==="delete"?"Delete":"Deactivate"," Account"]}),e.jsxs("div",{children:["Are you sure you want to ",C.action," this user account? This action cannot be undone."]}),e.jsxs(Qe,{children:[e.jsx(j,{variant:"outline",onClick:()=>F({open:!1}),children:"Cancel"}),e.jsx(j,{variant:C.action==="delete"?"destructive":"default",onClick:rs,children:C.action==="delete"?"Delete":"Deactivate"})]})]})})]})};export{ta as default};
