import{r as t,j as e,y as re,a7 as je,a8 as J,a9 as V,aa as Q,$ as X,u as be,ab as Ne,U as ye,i as we,m as B,ac as Se,a5 as Ce}from"./react-core-B8kFjp2k.js";import{u as ne,A as Ae,c as ke,d as Ee,a as v,e as ce,I as g,s as H,C as Pe,P as ee,B as ae,f as Ue,g as Fe,h as Ie,T as Le,i as De,j as se,k as te,D as Te,l as Be,m as He,n as Ve,o as Me,p as Oe}from"./index-PwDgWEVM.js";import{S as U,a as F,b as I,c as L,d}from"./select-CXX5Q_V1.js";import{h as le,g as ze,s as qe}from"./sudanStates-CkkbYUnU.js";import{bo as oe}from"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./date-utils-YarVESQS.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";const Ge=({onImageChange:i,previewUrl:o})=>{const[u,r]=t.useState(o||null),[h,m]=t.useState(!1),{toast:p}=ne(),x=async C=>{var n;const c=((n=C.target.files)==null?void 0:n[0])||null;if(!c){r(null),i(null,null);return}if(!c.type.startsWith("image/")){p({title:"Invalid File",description:"Please upload an image file",variant:"destructive"}),r(null),i(null,null);return}if(c.size>5*1024*1024){p({title:"File Too Large",description:"Image must be less than 5MB",variant:"destructive"}),r(null),i(null,null);return}const s=URL.createObjectURL(c);r(s),i(c,s)};return e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(Ae,{className:"h-24 w-24",children:u?e.jsx(ke,{src:u,alt:"Profile"}):e.jsx(Ee,{children:e.jsx(re,{className:"h-12 w-12"})})}),e.jsx("div",{children:e.jsxs(v,{variant:"outline",className:"relative",disabled:h,children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Upload Picture",e.jsx("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:"image/*",onChange:x,disabled:h})]})})]})},ie=({mode:i})=>{const[o,u]=t.useState(""),[r,h]=t.useState(""),[m,p]=t.useState(""),[x,C]=t.useState(""),[c,s]=t.useState(""),[n,f]=t.useState(!1),[j,A]=t.useState(!1),[k,de]=t.useState("dataCollector"),[b,ue]=t.useState(!1),[D,he]=t.useState(null),[me,xe]=t.useState(null),[Re,$e]=t.useState(""),[N,M]=t.useState(""),[y,E]=t.useState(""),[T,w]=t.useState(""),[pe,O]=t.useState([]),[z,P]=t.useState([]),{toast:S}=ne(),q=oe();let G=async()=>!1,R=async()=>!1;try{const a=ce();G=a.login,R=a.registerUser}catch{}t.useEffect(()=>{const a=["dataCollector","coordinator","supervisor"].includes(k);ue(a),a||(M(""),E(""),w(""))},[k]),t.useEffect(()=>{if(!N){O([]),E(""),P([]),w("");return}const a=le.find(l=>l.id===N);O(a?a.states:[]),E(""),P([]),w("")},[N]),t.useEffect(()=>{if(!y){P([]),w("");return}const a=ze(y);P(a),w("")},[y]);const ge=(a,l)=>{he(a),xe(l)},$=async()=>{A(!0);try{const{data:a,error:l}=await H.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/dashboard`,queryParams:{access_type:"offline",prompt:"consent"}}});l&&S({title:"Authentication Error",description:l.message,variant:"destructive"})}catch(a){S({title:"Error",description:a.message||"Failed to sign in with Google",variant:"destructive"})}finally{A(!1)}},W=async a=>{a.preventDefault(),A(!0);try{if(i==="signup"){let l="";if(D)try{const K=D.name.split(".").pop(),Z=`avatar-${Date.now()}.${K}`,{data:ve,error:_}=await H.storage.from("avatars").upload(Z,D,{cacheControl:"3600",upsert:!1});if(!_&&ve){const{data:fe}=H.storage.from("avatars").getPublicUrl(Z);l=fe.publicUrl}else _&&S({title:"Avatar upload failed",description:"Continuing with registration without avatar.",variant:"default"})}catch{}await R({email:o,password:r,name:m,phone:x,employeeId:c,role:k,hubId:b?N:void 0,stateId:b?y:void 0,localityId:b&&T?T:void 0,avatar:l||void 0})&&(S({title:"Registration successful",description:"Your account is pending approval by an administrator.",variant:"default"}),q("/registration-success"))}else await G(o,r)&&(S({title:"Welcome back!",description:"You have successfully logged in.",variant:"default"}),q("/dashboard"))}catch(l){S({title:"Error",description:l.message||"An unexpected error occurred",variant:"destructive"})}finally{A(!1)}};return i==="login"?e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx(g,{type:"email",placeholder:"Email",value:o,onChange:a=>u(a.target.value),required:!0,className:"pl-10 bg-white/50 focus:bg-white transition-colors"})]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx(g,{type:n?"text":"password",placeholder:"Password",value:r,onChange:a=>h(a.target.value),required:!0,className:"pl-10 pr-10 bg-white/50 focus:bg-white transition-colors"}),e.jsx("button",{type:"button",onClick:()=>f(!n),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:n?e.jsx(Q,{className:"h-5 w-5"}):e.jsx(X,{className:"h-5 w-5"})})]})}),e.jsx(v,{type:"submit",className:`w-full bg-[#9b87f5] hover:bg-[#8b77e5] transition-colors 
                   transform hover:scale-105 active:scale-95 
                   duration-300 ease-in-out relative
                   animate-fade-in hover:animate-pulse-slow
                   disabled:opacity-70 disabled:cursor-not-allowed
                   disabled:hover:scale-100 disabled:hover:bg-[#9b87f5]`,disabled:j,children:j?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"h-5 w-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}),e.jsx("span",{children:"Signing In..."})]}):"Sign In"}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-gray-500",children:"Or continue with"})})]}),e.jsxs(v,{type:"button",variant:"outline",className:"w-full",onClick:$,disabled:j,children:[e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Sign in with Google"]})]}):e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[e.jsx(Ge,{onImageChange:ge,previewUrl:me}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx(g,{type:"email",placeholder:"Email",value:o,onChange:a=>u(a.target.value),required:!0,className:"pl-10 bg-white/50 focus:bg-white transition-colors"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx(g,{type:n?"text":"password",placeholder:"Password",value:r,onChange:a=>h(a.target.value),required:!0,className:"pl-10 pr-10 bg-white/50 focus:bg-white transition-colors"}),e.jsx("button",{type:"button",onClick:()=>f(!n),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:n?e.jsx(Q,{className:"h-5 w-5"}):e.jsx(X,{className:"h-5 w-5"})})]}),e.jsx("div",{children:e.jsxs(U,{value:k,onValueChange:de,children:[e.jsx(F,{className:"w-full",children:e.jsx(I,{placeholder:"Select your role"})}),e.jsxs(L,{children:[e.jsx(d,{value:"dataCollector",children:"Data Collector"}),e.jsx(d,{value:"coordinator",children:"Coordinator"}),e.jsx(d,{value:"supervisor",children:"Supervisor"}),e.jsx(d,{value:"admin",children:"Admin"}),e.jsx(d,{value:"ict",children:"ICT"}),e.jsx(d,{value:"fom",children:"FOM"})]})]})}),b&&e.jsx("div",{children:e.jsxs(U,{value:N,onValueChange:M,children:[e.jsx(F,{className:"w-full",children:e.jsx(I,{placeholder:"Select your hub"})}),e.jsx(L,{children:le.map(a=>e.jsx(d,{value:a.id,children:a.name},a.id))})]})}),b&&N&&e.jsx("div",{children:e.jsxs(U,{value:y,onValueChange:E,children:[e.jsx(F,{className:"w-full",children:e.jsx(I,{placeholder:"Select state"})}),e.jsx(L,{children:pe.map(a=>{const l=qe.find(Y=>Y.id===a);return l?e.jsx(d,{value:l.id,children:l.name},l.id):null})})]})}),b&&y&&z.length>0&&e.jsx("div",{children:e.jsxs(U,{value:T,onValueChange:w,children:[e.jsx(F,{className:"w-full",children:e.jsx(I,{placeholder:"Select locality (optional)"})}),e.jsx(L,{children:z.map(a=>e.jsx(d,{value:a.id,children:a.name},a.id))})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx(g,{placeholder:"Full Name",value:m,onChange:a=>p(a.target.value),required:!0,className:"pl-10 bg-white/50 focus:bg-white transition-colors"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx(g,{type:"tel",placeholder:"Phone Number",value:x,onChange:a=>C(a.target.value),className:"pl-10 bg-white/50 focus:bg-white transition-colors"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx(g,{placeholder:"Employee ID (Optional)",value:c,onChange:a=>s(a.target.value),className:"pl-10 bg-white/50 focus:bg-white transition-colors"})]})]})]}),e.jsx(v,{type:"submit",className:`w-full bg-[#9b87f5] hover:bg-[#8b77e5] transition-colors 
                 transform hover:scale-105 active:scale-95 
                 duration-300 ease-in-out relative
                 animate-fade-in hover:animate-pulse-slow
                 disabled:opacity-70 disabled:cursor-not-allowed
                 disabled:hover:scale-100 disabled:hover:bg-[#9b87f5]`,disabled:j,children:j?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"h-5 w-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}),e.jsx("span",{children:i==="signup"?"Creating Account...":"Signing In..."})]}):i==="signup"?"Create Account":"Sign In"}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-gray-500",children:"Or continue with"})})]}),e.jsxs(v,{type:"button",variant:"outline",className:"w-full",onClick:$,disabled:j,children:[e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),i==="signup"?"Sign up with Google":"Sign in with Google"]})]})},ua=()=>{const i=oe(),[o,u]=t.useState(!1);let r=null,h=!1,m,p=async()=>!1,x=()=>{};try{const s=ce();r=s.currentUser,h=s.emailVerificationPending,m=s.verificationEmail,p=s.resendVerificationEmail,x=s.clearEmailVerificationNotice}catch{}t.useEffect(()=>{r&&i("/dashboard")},[r,i]);const C=[{icon:B,label:"Enterprise Security",description:"Enterprise-Grade Protection",color:"text-blue-500 dark:text-blue-400"},{icon:V,label:"Encrypted Data",description:"Advanced Encryption",color:"text-orange-500 dark:text-orange-400"},{icon:Se,label:"99.9% Uptime",description:"Guaranteed Availability",color:"text-purple-500 dark:text-purple-400"},{icon:Ce,label:"Real-time Sync",description:"Instant Data Updates",color:"text-green-500 dark:text-green-400"}],c=[{label:"Active Users",value:"10K+",icon:ye},{label:"Uptime",value:"99.9%",icon:we},{label:"Protected",value:"Secure",icon:B}];return e.jsxs("div",{className:"min-h-screen bg-background relative overflow-hidden flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-orange-500/5 to-purple-500/5 dark:from-blue-600/10 dark:via-orange-600/10 dark:to-purple-600/10"}),e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-blue-500/20 dark:bg-blue-600/20 rounded-full blur-3xl animate-blob"}),e.jsx("div",{className:"absolute top-1/3 right-1/4 w-96 h-96 bg-orange-500/20 dark:bg-orange-600/20 rounded-full blur-3xl animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute bottom-0 left-1/2 w-96 h-96 bg-purple-500/20 dark:bg-purple-600/20 rounded-full blur-3xl animate-blob animation-delay-4000"})]}),e.jsxs("div",{className:"relative z-10 w-full max-w-6xl",children:[e.jsx(Pe,{className:"overflow-hidden border-2 shadow-2xl","data-testid":"card-auth-container",children:e.jsxs("div",{className:"grid lg:grid-cols-2",children:[e.jsx("div",{className:"hidden lg:flex flex-col justify-between p-12 bg-gradient-to-br from-muted/50 to-muted/30 border-r",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:ee,alt:"PACT Logo",className:"h-16 w-16","data-testid":"img-auth-logo"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"PACT Platform"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Field Operations Command Center"})]})]}),e.jsxs(ae,{variant:"secondary",className:"gap-2","data-testid":"badge-system-status",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"All Systems Operational"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4 py-6 border-y",children:c.map((s,n)=>{const f=s.icon;return e.jsxs("div",{className:"text-center space-y-1","data-testid":`stat-${s.label.toLowerCase().replace(/\s+/g,"-")}`,children:[e.jsx(f,{className:"w-4 h-4 mx-auto text-muted-foreground"}),e.jsx("p",{className:"text-xl font-bold",children:s.value}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.label})]},n)})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-primary"}),"Enterprise-Grade Security"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:C.map((s,n)=>{const f=s.icon;return e.jsx("div",{className:"p-4 rounded-md border bg-card hover-elevate","data-testid":`feature-${s.label.toLowerCase().replace(/\s+/g,"-")}`,children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-2",children:[e.jsx("div",{className:`p-2 rounded-md bg-muted ${s.color}`,children:e.jsx(f,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]})]})},n)})})]})]})}),e.jsxs("div",{className:"p-8 md:p-12 flex flex-col justify-center",children:[e.jsxs("div",{className:"lg:hidden flex flex-col items-center mb-8",children:[e.jsx("img",{src:ee,alt:"PACT Logo",className:"h-16 w-16 mb-4","data-testid":"img-auth-logo-mobile"}),e.jsxs(ae,{variant:"secondary",className:"gap-2","data-testid":"badge-system-status-mobile",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"System Operational"]})]}),e.jsxs(Ue,{className:"space-y-2 text-center px-0 pb-6",children:[e.jsx(Fe,{className:"text-3xl font-bold","data-testid":"heading-auth-title",children:"Welcome Back"}),e.jsx(Ie,{className:"text-base","data-testid":"text-auth-description",children:"Sign in to access your field operations dashboard"})]}),e.jsx("div",{className:"w-full",children:e.jsxs(Le,{defaultValue:"login",className:"space-y-6 w-full",children:[e.jsxs(De,{className:"grid w-full grid-cols-2","data-testid":"tabs-auth",children:[e.jsx(se,{value:"login","data-testid":"tab-login",children:"Login"}),e.jsx(se,{value:"signup","data-testid":"tab-signup",children:"Sign Up"})]}),e.jsx(te,{value:"login","data-testid":"content-login",children:e.jsx(ie,{mode:"login"})}),e.jsx(te,{value:"signup","data-testid":"content-signup",children:e.jsx(ie,{mode:"signup"})})]})}),e.jsx("div",{className:"mt-8 text-center text-sm text-muted-foreground",children:e.jsxs("p",{children:["Protected by enterprise-grade security.",e.jsx("br",{}),e.jsx("a",{href:"#",className:"text-primary hover:underline","data-testid":"link-auth-help",children:"Need help?"})]})})]})]})}),e.jsx("div",{className:"mt-6 text-center text-sm text-muted-foreground",children:e.jsxs("p",{"data-testid":"text-auth-footer",children:["Â© ",new Date().getFullYear()," PACT Consultancy. All rights reserved."]})})]}),e.jsx(Te,{open:h,onOpenChange:s=>{s||x()},children:e.jsxs(Be,{"data-testid":"dialog-verification",children:[e.jsxs(He,{children:[e.jsx(Ve,{"data-testid":"heading-verification-title",children:"Email verification required"}),e.jsx(Me,{"data-testid":"text-verification-description",children:m?e.jsxs(e.Fragment,{children:["We found an account for ",e.jsx("strong",{children:m}),", but the email is not verified yet. Check your inbox and spam folder for a verification email."]}):e.jsx(e.Fragment,{children:"Your email is not verified yet. Check your inbox and spam folder for a verification email."})})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"You can request another verification link if needed."}),e.jsxs(Oe,{children:[e.jsx(v,{variant:"secondary",onClick:()=>x(),"data-testid":"button-verification-close",children:"Close"}),e.jsx(v,{onClick:async()=>{try{u(!0),await p(m)}finally{u(!1)}},disabled:o,"data-testid":"button-verification-resend",children:o?"Sending...":"Resend verification link"})]})]})})]})};export{ua as default};
