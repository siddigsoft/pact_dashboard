import{r as g,j as e,ae as te,t as p,p as H,I as ie,q as ae}from"./react-core-B8kFjp2k.js";import{u as ne,e as re,C as ce,f as le,g as oe,b as de,B as j,a3 as me,a as V,T as fe,i as pe,j as L,k as G}from"./index-PwDgWEVM.js";import{P as xe}from"./progress-vMwTbqUI.js";import{a as ue,M as he}from"./MMPPermitVerification-CyCVrban.js";import{o as ge}from"./date-utils-YarVESQS.js";const Ce=({mmpFile:i,onVerificationUpdate:J,onVerificationComplete:K})=>{var w,P,S,M,T,A,E,I,k,B,O,U,R,$,D,q,z,W,Y;const{toast:v}=ne(),{roles:o}=re(),r=((o==null?void 0:o.includes("fom"))||(o==null?void 0:o.includes("fieldOpManager")))??!1,[s,y]=g.useState(i.comprehensiveVerification||{overallStatus:"pending",canProceedToApproval:!1,systemValidation:{status:"pending",fileIntegrity:!0,noDuplicates:!0,compliantWithRequirements:!0,entryProcessingComplete:!1},contentVerification:{status:"pending",fileReviewed:!1,contentValidated:!1}}),[x,Q]=g.useState(!1),[X,b]=g.useState(!1);g.useEffect(()=>{const t={status:"complete",fileIntegrity:!0,noDuplicates:!0,compliantWithRequirements:!0,entryProcessingComplete:!!(i.entries&&i.processedEntries&&i.processedEntries>=i.entries)};y(a=>({...a,systemValidation:t}))},[i]);const N=t=>{var c,l,d,m;const a={...s,...t,lastUpdated:new Date().toISOString(),updatedBy:"Current User"},n=((c=a.systemValidation)==null?void 0:c.status)==="complete"&&((l=a.contentVerification)==null?void 0:l.status)==="complete"&&((d=a.cpVerification)==null?void 0:d.verificationStatus)==="complete"&&((m=a.permitVerification)==null?void 0:m.status)==="complete";a.overallStatus=n?"complete":"in-progress",a.canProceedToApproval=n,y(a),J(a),n&&(K(),v({title:"All Verifications Complete",description:"The MMP is ready for approval process."}))},Z=t=>{N({cpVerification:{...s.cpVerification,...t,verificationStatus:t.verificationStatus||"complete"}})},_=t=>{const a=Array.isArray(t==null?void 0:t.documents)?t.documents:[],n=a.length,c=a.filter(f=>(f==null?void 0:f.status)==="verified"||(f==null?void 0:f.status)==="rejected").length,l=n>0?Math.round(c/n*100):0,m={status:n>0&&c===n?"complete":c>0?"in-progress":"pending",verifiedBy:"Current User",verifiedAt:new Date().toISOString(),completionPercentage:l,permits:a};N({permitVerification:m})},F=()=>{if(!x){v({title:"Error",description:"Please review the file before verification.",variant:"destructive"});return}const t={status:"complete",verifiedBy:"Current User",verifiedAt:new Date().toISOString(),fileReviewed:!0,contentValidated:!0,notes:"Content verified successfully"};N({contentVerification:t})},ee=()=>{b(!0)},se=()=>{b(!1),Q(!0),v({title:"File review completed",description:"You can now proceed with content verification."})},u=t=>{switch(t){case"complete":return e.jsx(p,{className:"h-4 w-4 text-green-600"});case"in-progress":return e.jsx(ae,{className:"h-4 w-4 text-amber-600"});default:return e.jsx(H,{className:"h-4 w-4 text-gray-600"})}},h=t=>{switch(t){case"complete":return"bg-green-100 text-green-800";case"in-progress":return"bg-amber-100 text-amber-800";default:return"bg-gray-100 text-gray-800"}},C=(()=>{var n,c,l,d;const t=[(n=s.systemValidation)==null?void 0:n.status,(c=s.contentVerification)==null?void 0:c.status,(l=s.cpVerification)==null?void 0:l.verificationStatus,(d=s.permitVerification)==null?void 0:d.status],a=t.filter(m=>m==="complete").length;return Math.round(a/t.length*100)})();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ce,{children:[e.jsx(le,{children:e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Comprehensive Verification Process"]})}),e.jsxs(de,{className:"space-y-6",children:[!r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Overall Verification Progress"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:[C,"%"]}),e.jsx(j,{className:h(s.overallStatus),children:s.overallStatus})]})]}),e.jsx(xe,{value:C,className:"h-2"})]}),e.jsx(me,{}),e.jsxs("div",{className:"space-y-4",children:[!r&&e.jsxs("div",{className:`p-4 border rounded-md ${((w=s.systemValidation)==null?void 0:w.status)==="complete"?"border-green-300 bg-green-50":"border-gray-300 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[u(((P=s.systemValidation)==null?void 0:P.status)||"pending"),e.jsx("span",{className:"font-medium",children:"Step 1: System Validation"})]}),e.jsx(j,{className:h(((S=s.systemValidation)==null?void 0:S.status)||"pending"),children:((M=s.systemValidation)==null?void 0:M.status)||"pending"})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(p,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{children:"File integrity verified"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(p,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{children:"No duplicates detected"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(p,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{children:"Compliant with system requirements"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[(T=s.systemValidation)!=null&&T.entryProcessingComplete?e.jsx(p,{className:"h-3 w-3 text-green-600"}):e.jsx(H,{className:"h-3 w-3 text-amber-600"}),e.jsx("span",{children:(A=s.systemValidation)!=null&&A.entryProcessingComplete?`${i.processedEntries} of ${i.entries} entries processed`:"Entry processing incomplete"})]})]})]}),!r&&e.jsxs("div",{className:`p-4 border rounded-md ${((E=s.contentVerification)==null?void 0:E.status)==="complete"?"border-green-300 bg-green-50":"border-gray-300 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[u(((I=s.contentVerification)==null?void 0:I.status)||"pending"),e.jsx("span",{className:"font-medium",children:"Step 2: Content Verification"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{variant:"outline",size:"sm",onClick:ee,className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),x?"View Again":"View Details"]}),e.jsx(V,{variant:"outline",size:"sm",onClick:F,disabled:!x||((k=s.contentVerification)==null?void 0:k.status)==="complete",children:((B=s.contentVerification)==null?void 0:B.status)==="complete"?"Verified":"Verify Content"})]})]}),e.jsx("p",{className:"text-sm mt-2",children:x?((O=s.contentVerification)==null?void 0:O.status)==="complete"?"Content has been verified successfully.":"Verify that all information in the MMP file is correct.":"You must review the MMP file details before proceeding."})]}),!r&&e.jsxs("div",{className:`p-4 border rounded-md ${((U=s.cpVerification)==null?void 0:U.verificationStatus)==="complete"?"border-green-300 bg-green-50":"border-gray-300 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[u(((R=s.cpVerification)==null?void 0:R.verificationStatus)||"pending"),e.jsx("span",{className:"font-medium",children:"Step 3: Cooperating Partner Verification"})]}),e.jsx(j,{className:h((($=s.cpVerification)==null?void 0:$.verificationStatus)||"pending"),children:((D=s.cpVerification)==null?void 0:D.verificationStatus)||"pending"})]}),e.jsx("p",{className:"text-sm mt-2",children:"Verify site entries and cooperating partner information."})]}),e.jsxs("div",{className:`p-4 border rounded-md ${((q=s.permitVerification)==null?void 0:q.status)==="complete"?"border-green-300 bg-green-50":"border-gray-300 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[u(((z=s.permitVerification)==null?void 0:z.status)||"pending"),e.jsx("span",{className:"font-medium",children:"Step 4: Permit Verification"})]}),e.jsx(j,{className:h(((W=s.permitVerification)==null?void 0:W.status)||"pending"),children:((Y=s.permitVerification)==null?void 0:Y.status)||"pending"})]}),e.jsx("p",{className:"text-sm mt-2",children:"Verify all required permits and documentation."})]})]}),!r&&s.canProceedToApproval&&e.jsxs("div",{className:"p-4 border border-green-300 bg-green-50 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(p,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium",children:"All Verifications Complete"})]}),e.jsx("p",{className:"text-sm text-green-700",children:"The MMP has passed all verification steps and is ready for the approval process."})]})]})]}),e.jsxs(fe,{defaultValue:r?"permit-verification":"cp-verification",className:"w-full",children:[e.jsxs(pe,{className:`grid ${r?"grid-cols-1":"grid-cols-2"}`,children:[!r&&e.jsx(L,{value:"cp-verification",children:"CP Verification"}),e.jsx(L,{value:"permit-verification",children:"Permit Verification"})]}),!r&&e.jsx(G,{value:"cp-verification",className:"mt-6",children:e.jsx(ue,{mmpFile:i,onVerificationComplete:Z})}),e.jsx(G,{value:"permit-verification",className:"mt-6",children:e.jsx(he,{mmpFile:i,onVerificationComplete:_})})]}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"MMP File Review"}),e.jsx(V,{variant:"outline",onClick:se,children:"Close"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"File Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"File Name:"}),e.jsx("p",{className:"font-medium",children:i.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Upload Date:"}),e.jsx("p",{className:"font-medium",children:ge(new Date(i.uploadedAt),"MMM d, yyyy h:mm a")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Uploaded By:"}),e.jsx("p",{className:"font-medium",children:i.uploadedBy})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Region:"}),e.jsx("p",{className:"font-medium",children:i.region})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Processing Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Entries:"}),e.jsx("p",{className:"font-medium",children:i.entries||"0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Processed Entries:"}),e.jsx("p",{className:"font-medium",children:i.processedEntries||"0"})]})]})]})]})]})})]})};export{Ce as M};
