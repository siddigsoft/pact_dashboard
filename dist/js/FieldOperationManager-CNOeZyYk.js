import{E as _e,a as z,_ as xe}from"./jspdf-rld7HkB6.js";import{r as p,j as t,R as he}from"./react-core-B8kFjp2k.js";import{e as $e,E as Pe,s as H,C as Q,B as W}from"./index-PwDgWEVM.js";import{bo as De}from"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./date-utils-YarVESQS.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";const Ie="Field Operation Manager (FOM)",Le=[{key:"all",label:"All"},{key:"approved",label:"Approved"},{key:"pending",label:"Pending"},{key:"archived",label:"Archived"}],We=()=>{const{roles:m}=$e(),{currentUser:_}=Pe(),ee=De(),[b,te]=p.useState([]),[Ee,U]=p.useState(!1),[be,se]=p.useState(!1),[G,T]=p.useState([]),[C,fe]=p.useState("all"),[F,pe]=p.useState(""),[P,ge]=p.useState([]),[re,we]=p.useState(!1),[je,le]=p.useState(!1),[A,ve]=p.useState([]),[k,Ne]=p.useState([]),[x,ye]=p.useState([]),[B,me]=p.useState("pdf"),Y=p.useMemo(()=>{const e=new Set;return(b||[]).forEach(s=>{let l=s.month,r=s.year;if(!l||!r){const a=s.uploadedAt||s.uploaded_at;if(a){const d=new Date(a);l=d.getMonth()+1,r=d.getFullYear()}}if(l&&r){const a=l.toString().padStart(2,"0");e.add(`${r}-${a}`)}}),Array.from(e).sort((s,l)=>l.localeCompare(s))},[b]),ae=e=>{if(!P.length)return!0;let s=e.month,l=e.year;if(!s||!l){const r=e.uploadedAt||e.uploaded_at;if(r){const a=new Date(r);s=a.getMonth()+1,l=a.getFullYear()}}if(s&&l){const r=s.toString().padStart(2,"0");return P.includes(`${l}-${r}`)}return!1};if(!((m==null?void 0:m.includes("Admin"))||(m==null?void 0:m.includes(Ie))||(m==null?void 0:m.includes("Field Operation Manager (FOM)"))))return t.jsxs("div",{className:"max-w-xl mx-auto mt-20 p-8 bg-white rounded-xl shadow text-center",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),t.jsx("p",{className:"text-gray-600",children:"You do not have permission to view this page."})]});const oe=p.useMemo(()=>{const e={};return(b||[]).forEach(s=>{const l=s.hub||s.projectHub||"Unknown",r=Array.isArray(s.sites)?s.sites.length:typeof s.siteCount=="number"?s.siteCount:0;e[l]=(e[l]||0)+r}),e},[b]),ne=p.useMemo(()=>{if(C==="all")return[];const e=[];return(b||[]).forEach(s=>{let l="pending";const r=(s.status||"").toLowerCase();if(r==="approved"?l="approved":(r==="archived"||r==="deleted")&&(l="archived"),l!==C)return;const a=s.projectName||s.name||"Unnamed MMP",d=s.mmpId||"N/A",o=Array.isArray(s.sites)?s.sites:Array.isArray(s.siteEntries)?s.siteEntries:[];let i=0,h=0;o.forEach(j=>{typeof j.status=="string"&&j.status.toLowerCase()==="covered"||j.covered===!0?i+=1:h+=1}),e.push({mmpName:a,mmpId:d,covered:i,notCovered:h,total:o.length})}),e},[b,C]),de=p.useMemo(()=>{const e=[];return(b||[]).forEach(s=>{let l="pending";const r=(s.status||"").toLowerCase();r==="approved"?l="approved":(r==="archived"||r==="deleted")&&(l="archived");const a=s.projectName||s.name||"Unnamed MMP",d=s.mmpId||"N/A",o=Array.isArray(s.sites)?s.sites:Array.isArray(s.siteEntries)?s.siteEntries:[];let i=0,h=0;o.forEach(j=>{typeof j.status=="string"&&j.status.toLowerCase()==="covered"||j.covered===!0?i+=1:h+=1}),e.push({mmpName:a,mmpId:d,status:l,covered:i,notCovered:h,total:o.length})}),e},[b]),V=e=>e==null?void 0:e.replace(/_/g,"").toLowerCase(),ie=p.useMemo(()=>C==="all"?[]:ne.filter(e=>{var r,a,d;const s=(b||[]).find(o=>(o.projectName||o.name||"Unnamed MMP")===e.mmpName&&(o.mmpId||"N/A")===e.mmpId);if(!s||!ae(s))return!1;const l=F.trim().toLowerCase();return l?e.mmpName&&e.mmpName.toLowerCase().includes(l)||e.mmpId&&e.mmpId.toLowerCase().includes(l)||((r=e.covered)==null?void 0:r.toString().includes(l))||((a=e.notCovered)==null?void 0:a.toString().includes(l))||((d=e.total)==null?void 0:d.toString().includes(l)):!0}),[ne,F,C,P,b]),ce=p.useMemo(()=>C!=="all"?[]:de.filter(e=>{var r,a,d;const s=(b||[]).find(o=>(o.projectName||o.name||"Unnamed MMP")===e.mmpName&&(o.mmpId||"N/A")===e.mmpId);if(!s||!ae(s))return!1;const l=F.trim().toLowerCase();return l?e.mmpName&&e.mmpName.toLowerCase().includes(l)||e.mmpId&&e.mmpId.toLowerCase().includes(l)||e.status&&e.status.toLowerCase().includes(l)||((r=e.covered)==null?void 0:r.toString().includes(l))||((a=e.notCovered)==null?void 0:a.toString().includes(l))||((d=e.total)==null?void 0:d.toString().includes(l)):!0}),[de,F,C,P,b]),Me=p.useMemo(()=>{const e=new Set;return(b||[]).forEach(s=>{var r;const l=s.hub||s.projectHub||((r=s.location)==null?void 0:r.hub);l&&e.add(l)}),Array.from(e)},[b]),Se=p.useMemo(()=>{const e=new Set;return(b||[]).forEach(s=>{const l=s.projectName||s.name||s.mmpId||s.id;l&&e.add(l)}),Array.from(e)},[b]);p.useMemo(()=>Object.entries(oe).filter(([e])=>A.length===0||A.includes(e)).map(([e,s])=>{const l=(b||[]).filter(r=>{var j;const a=r.hub||r.projectHub||((j=r.location)==null?void 0:j.hub),d=r.projectName||r.name||r.mmpId||r.id;let o=r.month,i=r.year;if(!o||!i){const n=r.uploadedAt;if(n){const c=new Date(n);o=c.getMonth()+1,i=c.getFullYear()}}const h=o&&i?`${i}-${o.toString().padStart(2,"0")}`:"";return a===e&&(k.length===0||k.includes(d))&&(x.length===0||x.includes(h))});return{hub:e,totalSites:s,mmpList:l}}),[oe,b,A,k,x]);const q=()=>{let e="Unknown User",s="Unknown Role";const l=(b||[]).find(r=>r.uploadedBy&&(typeof r.uploadedBy=="object"||typeof r.uploadedBy=="string"));return l?typeof l.uploadedBy=="object"&&l.uploadedBy!==null?(e=l.uploadedBy.name||l.uploadedBy.fullName||l.uploadedBy.email||e,s=l.uploadedBy.role||s):typeof l.uploadedBy=="string"&&(e=l.uploadedBy):m&&m.length>0&&(s=m.join(", "),e=m.includes("Admin")?"Admin":m[0]),{userName:e,userRole:s}},Ae=()=>{const e=new _e,s=new Date,{userName:l,userRole:r}=q(),a=x.length===0?"All Periods":x.length===1?x[0]:`${x[0]} to ${x[x.length-1]}`;e.setFontSize(16),e.text("MMP Sites Report",14,16),e.setFontSize(10),e.text(`Generated by: ${l}`,14,24),e.text(`Account type: ${r}`,14,30),e.text(`Period: ${a}`,14,36),e.text(`Generated on: ${s.toLocaleString()}`,14,42);let d=50,o=0,i=0,h=0;(b||[]).filter(n=>{var w;const c=n.projectName||n.name||n.mmpId||n.id;let N=n.month,g=n.year;if(!N||!g){const M=n.uploadedAt;if(M){const v=new Date(M);N=v.getMonth()+1,g=v.getFullYear()}}const f=N&&g?`${g}-${N.toString().padStart(2,"0")}`:"";return(k.length===0||k.includes(c))&&(x.length===0||x.includes(f))&&(A.length===0||A.includes(n.hub||n.projectHub||((w=n.location)==null?void 0:w.hub)))}).forEach((n,c)=>{var $;const N=n.projectName||n.name||n.mmpId||n.id,g=n.mmpId||n.id||"",f=n.uploadedAt?new Date(n.uploadedAt).toLocaleDateString():"-";let w=(n.status||"").toLowerCase();w==="archived"||w==="deleted"?w="archived":w==="approved"?w="approved":w==="pending"||w==="pendingreview"?w="pending":w=w||"pending";const M=Array.isArray(n.sites)?n.sites:Array.isArray(n.siteEntries)?n.siteEntries:[];let v=0,S=0;M.forEach(u=>{typeof u.status=="string"&&u.status.toLowerCase()==="covered"||u.covered===!0?v+=1:S+=1});const D=M.length;o+=D,i+=v,h+=S,e.setFontSize(13),e.text(`${c+1}. MMP: ${N} (${g})`,14,d),d+=6,e.setFontSize(10),e.text(`Status: ${w.charAt(0).toUpperCase()+w.slice(1)}`,14,d),d+=6,e.text(`Upload Date: ${f}`,14,d),d+=6,z(e,{head:[["Covered","Not Covered","Total"]],body:[[v,S,D]],startY:d,theme:"grid",styles:{fontSize:10},didDrawPage:u=>{}}),d=(($=e.lastAutoTable)==null?void 0:$.finalY)??(z.previous&&z.previous.finalY)??d+20,d+=8}),e.setFontSize(12),e.text("Grand Total (All MMPs):",14,d),d+=4,z(e,{head:[["Covered","Not Covered","Total"]],body:[[i,h,o]],startY:d,theme:"grid",styles:{fontSize:11,fontStyle:"bold"}}),e.save("mmp-sites-report.pdf")},ke=async()=>{try{const e=await xe(()=>import("./docs-D2Yi4cpO.js").then(u=>u.i),[]),s=await xe(()=>import("./docs-D2Yi4cpO.js").then(u=>u.F),[]),{Document:l,Packer:r,Paragraph:a,Table:d,TableRow:o,TableCell:i,TextRun:h}=e,{saveAs:j}=s,n=new Date,{userName:c,userRole:N}=q(),g=x.length===0?"All Periods":x.length===1?x[0]:`${x[0]} to ${x[x.length-1]}`,f=(b||[]).filter(u=>{var y;const O=u.projectName||u.name||u.mmpId||u.id;let I=u.month,L=u.year;if(!I||!L){const R=u.uploadedAt;if(R){const E=new Date(R);I=E.getMonth()+1,L=E.getFullYear()}}const Z=I&&L?`${L}-${I.toString().padStart(2,"0")}`:"";return(k.length===0||k.includes(O))&&(x.length===0||x.includes(Z))&&(A.length===0||A.includes(u.hub||u.projectHub||((y=u.location)==null?void 0:y.hub)))});let w=0,M=0,v=0;const S=[new a({children:[new h({text:"MMP Sites Report",bold:!0,size:32})],spacing:{after:200}}),new a({children:[new h({text:`Generated by: ${c}`,size:20})]}),new a({children:[new h({text:`Account type: ${N}`,size:20})]}),new a({children:[new h({text:`Period: ${g}`,size:20})]}),new a({children:[new h({text:`Generated on: ${n.toLocaleString()}`,size:20})],spacing:{after:200}})];f.forEach((u,O)=>{const I=u.projectName||u.name||u.mmpId||u.id,L=u.mmpId||u.id||"",Z=u.uploadedAt?new Date(u.uploadedAt).toLocaleDateString():"-";let y=(u.status||"").toLowerCase();y==="archived"||y==="deleted"?y="archived":y==="approved"?y="approved":y==="pending"||y==="pendingreview"?y="pending":y=y||"pending";const R=Array.isArray(u.sites)?u.sites:Array.isArray(u.siteEntries)?u.siteEntries:[];let E=0,J=0;R.forEach(K=>{typeof K.status=="string"&&K.status.toLowerCase()==="covered"||K.covered===!0?E+=1:J+=1});const ue=R.length;w+=ue,M+=E,v+=J,S.push(new a({children:[new h({text:`${O+1}. MMP: ${I} (${L})`,bold:!0,size:26})],spacing:{after:80}}),new a({children:[new h({text:`Status: ${y.charAt(0).toUpperCase()+y.slice(1)}`,size:20})]}),new a({children:[new h({text:`Upload Date: ${Z}`,size:20})],spacing:{after:40}}),new d({rows:[new o({children:[new i({children:[new a("Covered")]}),new i({children:[new a("Not Covered")]}),new i({children:[new a("Total")]})]}),new o({children:[new i({children:[new a(E.toString())]}),new i({children:[new a(J.toString())]}),new i({children:[new a(ue.toString())]})]})]}),new a({children:[],spacing:{after:120}}))}),S.push(new a({children:[new h({text:"Grand Total (All MMPs):",bold:!0,size:24})],spacing:{after:40}}),new d({rows:[new o({children:[new i({children:[new a("Covered")]}),new i({children:[new a("Not Covered")]}),new i({children:[new a("Total")]})]}),new o({children:[new i({children:[new a(M.toString())]}),new i({children:[new a(v.toString())]}),new i({children:[new a(w.toString())]})]})]}));const D=new l({sections:[{children:S}]}),$=await r.toBlob(D);j($,"mmp-sites-report.docx")}catch{alert('DOCX export requires the "docx" and "file-saver" packages. Please install them with:\\nnpm install docx file-saver')}},Ce=()=>{const e=(b||[]).filter(c=>{var M;const N=c.projectName||c.name||c.mmpId||c.id;let g=c.month,f=c.year;if(!g||!f){const v=c.uploadedAt;if(v){const S=new Date(v);g=S.getMonth()+1,f=S.getFullYear()}}const w=g&&f?`${f}-${g.toString().padStart(2,"0")}`:"";return(k.length===0||k.includes(N))&&(x.length===0||x.includes(w))&&(A.length===0||A.includes(c.hub||c.projectHub||((M=c.location)==null?void 0:M.hub)))}),{userName:s,userRole:l}=q(),r=x.length===0?"All Periods":x.length===1?x[0]:`${x[0]} to ${x[x.length-1]}`;let a=`MMP Sites Report
Generated by:,${s}
Account type:,${l}
Period:,${r}
Generated on:,${new Date().toLocaleString()}

MMP Name,MMP ID,Status,Upload Date,Covered,Not Covered,Total
`,d=0,o=0,i=0;e.forEach(c=>{const N=c.projectName||c.name||c.mmpId||c.id,g=c.mmpId||c.id||"";let f=(c.status||"").toLowerCase();f==="archived"||f==="deleted"?f="archived":f==="approved"?f="approved":f==="pending"||f==="pendingreview"?f="pending":f=f||"pending";const w=c.uploadedAt?new Date(c.uploadedAt).toLocaleDateString():"-",M=Array.isArray(c.sites)?c.sites:Array.isArray(c.siteEntries)?c.siteEntries:[];let v=0,S=0;M.forEach($=>{typeof $.status=="string"&&$.status.toLowerCase()==="covered"||$.covered===!0?v+=1:S+=1});const D=M.length;d+=D,o+=v,i+=S,a+=`"${N}","${g}","${f}","${w}",${v},${S},${D}
`}),a+=`"Grand Total","","",${o},${i},${d}
`;const h=new Blob([a],{type:"text/csv"}),j=URL.createObjectURL(h),n=document.createElement("a");n.href=j,n.download="mmp-sites-report.csv",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(j)},X=({label:e,options:s,selected:l,setSelected:r,allLabel:a="All"})=>{const[d,o]=p.useState(!1),i=s.length>0&&l.length===s.length,h=()=>{r(i?[]:s)},j=n=>{r(l.includes(n)?l.filter(c=>c!==n):[...l,n])};return t.jsxs("div",{className:"relative w-full",children:[t.jsxs("button",{type:"button",className:"w-full px-3 py-2 rounded border border-blue-200 dark:border-blue-800 bg-white dark:bg-blue-950 text-blue-900 dark:text-blue-100 flex items-center justify-between",onClick:()=>o(n=>!n),children:[t.jsx("span",{children:l.length===0?`Select ${e}`:i?`${a} (${s.length})`:l.join(", ")}),t.jsx("span",{className:"ml-2",children:d?"▲":"▼"})]}),d&&t.jsxs("div",{className:"absolute z-10 mt-1 w-full max-h-60 overflow-auto bg-white dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg shadow-lg",children:[t.jsxs("label",{className:"flex items-center px-4 py-2 hover:bg-blue-50 dark:hover:bg-blue-900 cursor-pointer font-semibold",children:[t.jsx("input",{type:"checkbox",checked:i,onChange:h,className:"mr-2"}),t.jsx("span",{children:a})]}),s.map(n=>t.jsxs("label",{className:"flex items-center px-4 py-2 hover:bg-blue-50 dark:hover:bg-blue-900 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:l.includes(n),onChange:()=>j(n),className:"mr-2"}),t.jsx("span",{children:n})]},n))]})]})};return he.useEffect(()=>{U(!0),H.from("mmp_files").select(`
        *,
        project:projects(
          id,
          name,
          project_code
        )
      `).order("created_at",{ascending:!1}).then(({data:e,error:s})=>{if(s){H.from("mmp_files").select("*").order("created_at",{ascending:!1}).then(({data:r,error:a})=>{if(a){U(!1);return}const d=(r||[]).map(o=>{var i;return{...o,sites:Array.isArray(o.site_entries)?o.site_entries:[],uploadedAt:o.uploaded_at,uploadedBy:o.uploaded_by||"Unknown",hub:o.hub,month:o.month,projectId:o.project_id,projectName:o.project_name||void 0,mmpId:o.mmp_id||o.id,status:o.status,siteCount:typeof o.entries=="number"?o.entries:Array.isArray(o.site_entries)?o.site_entries.length:0,logs:((i=o.workflow)==null?void 0:i.logs)||[]}});te(d),U(!1)});return}!e||e.length;const l=(e||[]).map(r=>{var a,d;return{...r,sites:Array.isArray(r.site_entries)?r.site_entries:[],uploadedAt:r.uploaded_at,uploadedBy:r.uploaded_by||"Unknown",hub:r.hub,month:r.month,projectId:r.project_id,projectName:((a=r.project)==null?void 0:a.name)||r.project_name,mmpId:r.mmp_id||r.id,status:r.status,siteCount:typeof r.entries=="number"?r.entries:Array.isArray(r.site_entries)?r.site_entries.length:0,logs:((d=r.workflow)==null?void 0:d.logs)||[]}});te(l),U(!1)})},[]),he.useEffect(()=>{(async()=>{if(!(_!=null&&_.id)){T([]);return}se(!0);try{const{data:s,error:l}=await H.from("mmp_files").select(`
            *,
            project:projects(
              id,
              name,
              project_code
            )
          `).contains("workflow",{forwardedToFomIds:[_.id]}).order("created_at",{ascending:!1});if(l){const{data:r,error:a}=await H.from("mmp_files").select("*").contains("workflow",{forwardedToFomIds:[_.id]}).order("created_at",{ascending:!1});if(a)T([]);else{const d=(r||[]).map(o=>{var i;return{...o,sites:Array.isArray(o.site_entries)?o.site_entries:[],uploadedAt:o.uploaded_at,uploadedBy:o.uploaded_by||"Unknown",hub:o.hub,month:o.month,projectId:o.project_id,projectName:o.project_name||void 0,mmpId:o.mmp_id||o.id,status:o.status,siteCount:typeof o.entries=="number"?o.entries:Array.isArray(o.site_entries)?o.site_entries.length:0,logs:((i=o.workflow)==null?void 0:i.logs)||[]}});T(d)}}else{const r=(s||[]).map(a=>{var d,o;return{...a,sites:Array.isArray(a.site_entries)?a.site_entries:[],uploadedAt:a.uploaded_at,uploadedBy:a.uploaded_by||"Unknown",hub:a.hub,month:a.month,projectId:a.project_id,projectName:((d=a.project)==null?void 0:d.name)||a.project_name,mmpId:a.mmp_id||a.id,status:a.status,siteCount:typeof a.entries=="number"?a.entries:Array.isArray(a.site_entries)?a.site_entries.length:0,logs:((o=a.workflow)==null?void 0:o.logs)||[]}});T(r)}}finally{se(!1)}})()},[_==null?void 0:_.id]),t.jsxs("div",{className:"min-h-screen py-10 px-2 md:px-8 bg-slate-50 dark:bg-gray-900 space-y-10",children:[t.jsx("div",{className:"max-w-5xl mx-auto",children:t.jsx("div",{className:"bg-blue-700 dark:bg-blue-900 p-8 rounded-2xl shadow-xl border border-blue-100 dark:border-blue-900 flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-white tracking-tight mb-2",children:"Field Operation Manager"}),t.jsx("p",{className:"text-blue-100 dark:text-blue-200/80 font-medium",children:"Review and forward MMPs to related hubs before site-level execution."})]})})}),t.jsxs("div",{className:"max-w-5xl mx-auto",children:[t.jsxs(Q,{className:"mb-10 p-8 bg-white/90 dark:bg-gray-900/90 rounded-2xl shadow-lg border border-emerald-200 dark:border-emerald-900",children:[t.jsx("h2",{className:"text-2xl font-semibold mb-6 text-emerald-800 dark:text-emerald-200",children:"Forwarded to You"}),t.jsx("div",{className:"overflow-x-auto rounded-lg",children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-emerald-50 dark:bg-emerald-950 text-emerald-900 dark:text-emerald-100",children:[t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"MMP"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Project"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Forwarded"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Status"}),t.jsx("th",{className:"px-4 py-3"})]})}),t.jsxs("tbody",{children:[(G||[]).map(e=>{var a,d,o;const s=e.projectName||((a=e.project)==null?void 0:a.name)||"-",l=(d=e.workflow)!=null&&d.forwardedAt?new Date(e.workflow.forwardedAt).toLocaleString():"-",r=e.status;return t.jsxs("tr",{className:"border-b last:border-0 hover:bg-emerald-50/40 dark:hover:bg-emerald-900/40 transition",children:[t.jsx("td",{className:"px-4 py-3 font-medium",children:e.name||e.mmpId||e.id}),t.jsx("td",{className:"px-4 py-3",children:s}),t.jsx("td",{className:"px-4 py-3",children:l}),t.jsx("td",{className:"px-4 py-3",children:t.jsx(W,{variant:r&&((o=r.toLowerCase)==null?void 0:o.call(r))==="approved"?"success":"outline",children:r||""})}),t.jsx("td",{className:"px-4 py-3 text-right",children:t.jsx("button",{className:"text-emerald-700 dark:text-emerald-300 hover:underline text-xs font-semibold",onClick:()=>ee(`/mmp/${e.id}`),children:"Open"})})]},`fwd-${e.id}`)}),(!G||G.length===0)&&t.jsx("tr",{children:t.jsx("td",{colSpan:5,className:"text-center py-8 text-muted-foreground",children:be?"Loading forwarded MMPs…":"No MMPs forwarded to you yet."})})]})]})})]}),t.jsxs(Q,{className:"mb-10 p-8 bg-white/90 dark:bg-gray-900/90 rounded-2xl shadow-lg border border-blue-100 dark:border-blue-900",children:[t.jsx("h2",{className:"text-2xl font-semibold mb-6 text-blue-800 dark:text-blue-200",children:"Uploaded MMPs"}),t.jsx("div",{className:"overflow-x-auto rounded-lg",children:t.jsxs("table",{className:"min-w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-blue-50 dark:bg-blue-950 text-blue-900 dark:text-blue-100",children:[t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"MMP Name"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Project"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Month"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Upload Date"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Uploaded By"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Role"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Hub"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Total Sites"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Logs"}),t.jsx("th",{className:"px-4 py-3"})]})}),t.jsxs("tbody",{children:[(b||[]).map(e=>{var c,N;const s=e.uploadedBy;let l="-",r="-";typeof s=="object"&&s!==null?(l=s.name||s.fullName||s.email||"-",r=s.role||"-"):typeof s=="string"&&(l=s);const a=e.hub||e.projectHub||((c=e.location)==null?void 0:c.hub)||"-",d=e.month?new Date(2024,parseInt(e.month)-1).toLocaleDateString("en-US",{month:"long"}):"-",o=e.projectName||((N=e.project)==null?void 0:N.name)||"-";let i=0;Array.isArray(e.sites)?i=e.sites.length:Array.isArray(e.siteEntries)?i=e.siteEntries.length:typeof e.entries=="number"?i=e.entries:typeof e.processedEntries=="number"?i=e.processedEntries:typeof e.siteCount=="number"&&(i=e.siteCount);const h=e.logs||e.modificationHistory||e.modification_history||[],j=e.uploadedAt?new Date(e.uploadedAt).toLocaleDateString():"-",n=e.status;return t.jsxs("tr",{className:"border-b last:border-0 hover:bg-blue-50/40 dark:hover:bg-blue-900/40 transition",children:[t.jsx("td",{className:"px-4 py-3 font-medium",children:e.name||e.mmpId||e.id}),t.jsx("td",{className:"px-4 py-3",children:o}),t.jsx("td",{className:"px-4 py-3",children:d}),t.jsx("td",{className:"px-4 py-3",children:j}),t.jsx("td",{className:"px-4 py-3",children:l}),t.jsx("td",{className:"px-4 py-3",children:t.jsx(W,{variant:r==="Admin"?"default":"outline",children:r})}),t.jsx("td",{className:"px-4 py-3",children:a}),t.jsx("td",{className:"px-4 py-3",children:i}),t.jsx("td",{className:"px-4 py-3",children:t.jsx(W,{variant:n&&V(n)==="pendingreview"?"outline":n&&V(n)==="reviewed"?"default":n&&V(n)==="approved"?"success":"secondary",children:n?n.replace(/([A-Z])/g," $1").replace(/_/g," ").toUpperCase():""})}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("ul",{className:"text-xs space-y-1",children:((h==null?void 0:h.slice(-2))||[]).map((g,f)=>t.jsxs("li",{children:[g.action||g.type||"Updated",g.by?` by ${g.by}`:"",g.date?` on ${new Date(g.date).toLocaleDateString()}`:""]},f))})}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("button",{className:"text-blue-700 dark:text-blue-300 hover:underline text-xs font-semibold",onClick:()=>ee(`/mmp/${e.id}`),children:"View"})})]},e.id)}),(!b||b.length===0)&&t.jsx("tr",{children:t.jsx("td",{colSpan:9,className:"text-center py-8 text-muted-foreground",children:"No MMPs uploaded yet."})})]})]})})]}),t.jsxs(Q,{className:"p-8 bg-white/90 dark:bg-gray-900/90 rounded-2xl shadow-lg border border-blue-100 dark:border-blue-900",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4",children:[t.jsx("h2",{className:"text-2xl font-semibold text-blue-800 dark:text-blue-200",children:"Total Sites Per Hub"}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-2 w-full md:w-auto relative",children:[t.jsx("input",{type:"text",value:F,onChange:e=>pe(e.target.value),placeholder:"Search by MMP name, ID, or status...",className:"w-full md:w-80 px-4 py-2 rounded-lg border border-blue-200 dark:border-blue-800 bg-white dark:bg-blue-950 text-blue-900 dark:text-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-400"}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{type:"button",className:"w-full md:w-56 px-3 py-2 rounded-lg border border-blue-200 dark:border-blue-800 bg-white dark:bg-blue-950 text-blue-900 dark:text-blue-100 flex items-center justify-between",onClick:()=>we(e=>!e),children:[P.length===0?"Filter by Month":P.map(e=>e).join(", "),t.jsx("span",{className:"ml-2",children:re?"▲":"▼"})]}),re&&t.jsxs("div",{className:"absolute z-10 mt-1 w-full max-h-60 overflow-auto bg-white dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg shadow-lg",children:[Y.length===0&&t.jsx("div",{className:"px-4 py-2 text-sm text-muted-foreground",children:"No months"}),Y.map(e=>t.jsxs("label",{className:"flex items-center px-4 py-2 hover:bg-blue-50 dark:hover:bg-blue-900 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:P.includes(e),onChange:s=>{ge(l=>s.target.checked?[...l,e]:l.filter(r=>r!==e))},className:"mr-2"}),t.jsx("span",{children:e})]},e))]})]})]})]}),t.jsxs("div",{className:"flex gap-2 mb-6",children:[Le.map(e=>t.jsx("button",{className:`px-4 py-2 rounded-full font-semibold transition-all duration-150
                  ${C===e.key?"bg-blue-700 text-white shadow":"bg-blue-100 text-blue-700 hover:bg-blue-200 dark:bg-blue-950 dark:text-blue-200 dark:hover:bg-blue-900"}
                `,onClick:()=>fe(e.key),children:e.label},e.key)),t.jsx("button",{className:"ml-auto px-4 py-2 rounded-full bg-blue-700 text-white font-semibold shadow hover:bg-blue-800",onClick:()=>le(!0),type:"button",children:"Generate Report"})]}),C!=="all"?t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:ie.length>0?ie.map((e,s)=>t.jsxs("div",{className:"bg-blue-100 dark:bg-blue-950 rounded-xl p-6 flex flex-col items-center shadow border border-blue-200 dark:border-blue-800",children:[t.jsx("div",{className:"text-base font-semibold text-blue-900 dark:text-blue-200 mb-1",children:e.mmpName}),t.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:e.mmpId}),t.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[t.jsxs("div",{className:"flex justify-between w-full",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Covered"}),t.jsx("span",{className:"text-xl font-bold text-green-700",children:e.covered})]}),t.jsxs("div",{className:"flex justify-between w-full",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Not Covered"}),t.jsx("span",{className:"text-xl font-bold text-amber-700",children:e.notCovered})]}),t.jsxs("div",{className:"flex justify-between w-full mt-2 border-t pt-2 border-blue-200 dark:border-blue-800",children:[t.jsx("span",{className:"text-xs font-semibold",children:"Total"}),t.jsx("span",{className:"text-lg font-extrabold text-blue-700 dark:text-blue-400",children:e.total})]})]})]},e.mmpId+s)):t.jsx("div",{className:"text-center text-muted-foreground col-span-full",children:"No data available."})}):t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:ce.length>0?ce.map((e,s)=>t.jsxs("div",{className:"bg-blue-100 dark:bg-blue-950 rounded-xl p-6 flex flex-col items-center shadow border border-blue-200 dark:border-blue-800",children:[t.jsx("div",{className:"text-base font-semibold text-blue-900 dark:text-blue-200 mb-1",children:e.mmpName}),t.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:e.mmpId}),t.jsx("div",{className:"text-xs mb-1",children:t.jsx("span",{className:`px-2 py-0.5 rounded-full font-semibold
                        ${e.status==="approved"?"bg-green-100 text-green-700":e.status==="pending"?"bg-amber-100 text-amber-700":"bg-gray-200 text-gray-700"}
                      `,children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),t.jsxs("div",{className:"flex flex-col gap-1 w-full",children:[t.jsxs("div",{className:"flex justify-between w-full",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Covered"}),t.jsx("span",{className:"text-xl font-bold text-green-700",children:e.covered})]}),t.jsxs("div",{className:"flex justify-between w-full",children:[t.jsx("span",{className:"text-xs text-muted-foreground",children:"Not Covered"}),t.jsx("span",{className:"text-xl font-bold text-amber-700",children:e.notCovered})]}),t.jsxs("div",{className:"flex justify-between w-full mt-2 border-t pt-2 border-blue-200 dark:border-blue-800",children:[t.jsx("span",{className:"text-xs font-semibold",children:"Total"}),t.jsx("span",{className:"text-lg font-extrabold text-blue-700 dark:text-blue-400",children:e.total})]})]})]},e.mmpId+e.status+s)):t.jsx("div",{className:"text-center text-muted-foreground col-span-full",children:"No data available."})})]}),je&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:t.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-xl p-8 max-w-lg w-full relative",children:[t.jsx("button",{className:"absolute top-2 right-2 text-xl text-gray-400 hover:text-gray-700",onClick:()=>le(!1),"aria-label":"Close",children:"×"}),t.jsx("h3",{className:"text-xl font-bold mb-4",children:"Generate Report"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block font-semibold mb-1",children:"Period (Months)"}),t.jsx(X,{label:"Months",options:Y,selected:x,setSelected:ye,allLabel:"All Months"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block font-semibold mb-1",children:"Hubs"}),t.jsx(X,{label:"Hubs",options:Me,selected:A,setSelected:ve,allLabel:"All Hubs"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block font-semibold mb-1",children:"MMPs"}),t.jsx(X,{label:"MMPs",options:Se,selected:k,setSelected:Ne,allLabel:"All MMPs"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block font-semibold mb-1",children:"Download Format"}),t.jsxs("select",{value:B,onChange:e=>me(e.target.value),className:"w-full px-3 py-2 rounded border border-blue-200 dark:border-blue-800 bg-white dark:bg-blue-950",children:[t.jsx("option",{value:"pdf",children:"PDF"}),t.jsx("option",{value:"docx",children:"DOCX"}),t.jsx("option",{value:"excel",children:"Excel (CSV)"})]})]}),t.jsx("div",{className:"flex gap-4 mt-6",children:t.jsx("button",{className:"flex-1 px-4 py-2 rounded bg-blue-700 text-white font-semibold shadow hover:bg-blue-800",onClick:()=>{B==="pdf"?Ae():B==="docx"?ke():B==="excel"&&Ce()},children:"Download"})})]})})]})]})};export{We as default};
