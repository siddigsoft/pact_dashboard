import{r as u,j as Q}from"./react-core-B8kFjp2k.js";import{b0 as S,b1 as v,b2 as C,b3 as w,b4 as I,b5 as T}from"./vendor-VlxgVHMv.js";var p=u.createContext(void 0),x=e=>{const s=u.useContext(p);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},L=({client:e,children:s})=>(u.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),Q.jsx(p.Provider,{value:e,children:s})),_=u.createContext(!1),P=()=>u.useContext(_);_.Provider;function N(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var q=u.createContext(N()),O=()=>u.useContext(q),d=(e,s)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(s.isReset()||(e.retryOnMount=!1))},B=e=>{u.useEffect(()=>{e.clearReset()},[e])},k=({result:e,errorResetBoundary:s,throwOnError:o,query:t,suspense:n})=>e.isError&&!s.isReset()&&!e.isFetching&&t&&(n&&e.data===void 0||S(o,[e.error,t])),H=e=>{if(e.suspense){const o=n=>n==="static"?n:Math.max(n??1e3,1e3),t=e.staleTime;e.staleTime=typeof t=="function"?(...n)=>o(t(...n)):o(t),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},U=(e,s)=>e.isLoading&&e.isFetching&&!s,j=(e,s)=>(e==null?void 0:e.suspense)&&s.isPending,R=(e,s,o)=>s.fetchOptimistic(e).catch(()=>{o.clearReset()});function F(e,s,o){var y,m,f,b,g;const t=P(),n=O(),i=x(),r=i.defaultQueryOptions(e);(m=(y=i.getDefaultOptions().queries)==null?void 0:y._experimental_beforeQuery)==null||m.call(y,r),r._optimisticResults=t?"isRestoring":"optimistic",H(r),d(r,n),B(n);const h=!i.getQueryCache().get(r.queryHash),[a]=u.useState(()=>new s(i,r)),c=a.getOptimisticResult(r),E=!t&&e.subscribed!==!1;if(u.useSyncExternalStore(u.useCallback(l=>{const M=E?a.subscribe(v.batchCalls(l)):C;return a.updateResult(),M},[a,E]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),u.useEffect(()=>{a.setOptions(r)},[r,a]),j(r,c))throw R(r,a,n);if(k({result:c,errorResetBoundary:n,throwOnError:r.throwOnError,query:i.getQueryCache().get(r.queryHash),suspense:r.suspense}))throw c.error;if((b=(f=i.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||b.call(f,r,c),r.experimental_prefetchInRender&&!w&&U(c,t)){const l=h?R(r,a,n):(g=i.getQueryCache().get(r.queryHash))==null?void 0:g.promise;l==null||l.catch(C).finally(()=>{a.updateResult()})}return r.notifyOnChangeProps?c:a.trackResult(c)}function V(e,s){return F(e,I)}function z(e,s){const o=x(),[t]=u.useState(()=>new T(o,e));u.useEffect(()=>{t.setOptions(e)},[t,e]);const n=u.useSyncExternalStore(u.useCallback(r=>t.subscribe(v.batchCalls(r)),[t]),()=>t.getCurrentResult(),()=>t.getCurrentResult()),i=u.useCallback((r,h)=>{t.mutate(r,h).catch(C)},[t]);if(n.error&&S(t.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:i,mutateAsync:n.mutate}}export{L as Q,z as a,V as b,x as u};
