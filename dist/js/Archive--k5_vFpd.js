import{j as e,ah as fe,ap as Ne,bL as ve,R as E,a4 as ye,A as Q,G as U,I as V,$ as _,J as ce,Z as L,a3 as we,r as y,a7 as be,aR as Ce,v as ee,X as Se,a0 as Me}from"./react-core-B8kFjp2k.js";import{ag as k,a as p,L as J,M as G,N as W,O as P,y as De,z as Ae,ah as Ve,ai as Fe,a3 as O,C as f,f as b,a4 as w,b as N,g as I,h as de,B as F,ae as oe,D as se,$ as ke,l as te,m as ae,n as le,o as re,I as H,p as ie,H as ne,u as Pe,e as Te,Z as Re,aj as Ie,T as ze,i as Ee,j as Y,k as q}from"./index-PwDgWEVM.js";import{S,a as M,b as D,c as A,d as m}from"./select-CXX5Q_V1.js";import{L as v}from"./label-C4lDws8j.js";import{C as z}from"./checkbox-9q2dlFjr.js";import{bo as Z}from"./vendor-VlxgVHMv.js";import{o as T,i as $e}from"./date-utils-YarVESQS.js";import{T as Ue}from"./textarea-BpQMf5eL.js";import{C as Le}from"./calendar-DEyRSxJX.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";const Be=({onFilterOpen:r,onBackClick:x})=>{const{currentArchive:s,archives:d,selectMonth:h,downloadArchive:u}=k(),j=t=>{const[o,l]=t.split("-").map(Number);h(o,l)},i=async t=>{await u(t)};return e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center p-4 bg-gradient-to-r from-background to-muted rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:x,className:"hover:bg-background/50",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Archives & Documentation"}),e.jsx("p",{className:"text-muted-foreground",children:s?`Viewing ${s.label}`:"Browse all archived records"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(S,{onValueChange:j,defaultValue:s?`${s.year}-${s.month}`:void 0,children:[e.jsx(M,{className:"w-[180px] bg-background/80",children:e.jsx(D,{placeholder:"Select month"})}),e.jsx(A,{children:d.map(t=>e.jsx(m,{value:`${t.year}-${t.month}`,children:t.label},`${t.year}-${t.month}`))})]}),e.jsxs(p,{variant:"outline",onClick:r,className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Filter"})]}),e.jsxs(J,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]})}),e.jsxs(W,{align:"end",children:[e.jsx(P,{onClick:()=>i("excel"),children:"Export as Excel"}),e.jsx(P,{onClick:()=>i("csv"),children:"Export as CSV"}),e.jsx(P,{onClick:()=>i("pdf"),children:"Export as PDF"})]})]})]})]})},Oe=({open:r,onOpenChange:x})=>{var t,o;const{filters:s,setFilters:d}=k(),[h,u]=E.useState(s);E.useEffect(()=>{r&&u(s)},[r,s]);const j=()=>{d(h),x(!1)},i=()=>{u({})};return e.jsx(De,{open:r,onOpenChange:x,children:e.jsxs(Ae,{className:"w-full md:max-w-md",children:[e.jsx(Ve,{children:e.jsx(Fe,{children:"Archive Filters"})}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Date Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"year",children:"Year"}),e.jsxs(S,{value:((t=h.year)==null?void 0:t.toString())||"",onValueChange:l=>u({...h,year:parseInt(l,10)}),children:[e.jsx(M,{id:"year",children:e.jsx(D,{placeholder:"Select year"})}),e.jsxs(A,{children:[e.jsx(m,{value:"2025",children:"2025"}),e.jsx(m,{value:"2024",children:"2024"}),e.jsx(m,{value:"2023",children:"2023"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"quarter",children:"Quarter"}),e.jsxs(S,{value:((o=h.quarter)==null?void 0:o.toString())||"",onValueChange:l=>u({...h,quarter:parseInt(l,10)}),children:[e.jsx(M,{id:"quarter",children:e.jsx(D,{placeholder:"Select quarter"})}),e.jsxs(A,{children:[e.jsx(m,{value:"1",children:"Q1"}),e.jsx(m,{value:"2",children:"Q2"}),e.jsx(m,{value:"3",children:"Q3"}),e.jsx(m,{value:"4",children:"Q4"})]})]})]})]})]}),e.jsx(O,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Document Types"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{id:"mmp"}),e.jsx(v,{htmlFor:"mmp",children:"MMP Files"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{id:"siteVisit"}),e.jsx(v,{htmlFor:"siteVisit",children:"Site Visits"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{id:"permit"}),e.jsx(v,{htmlFor:"permit",children:"Permits"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{id:"verification"}),e.jsx(v,{htmlFor:"verification",children:"Verifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{id:"report"}),e.jsx(v,{htmlFor:"report",children:"Reports"})]})]})]}),e.jsx(O,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"MMP Status"}),e.jsx("div",{className:"space-y-2",children:e.jsxs(S,{value:h.status||"",onValueChange:l=>u({...h,status:l}),children:[e.jsx(M,{children:e.jsx(D,{placeholder:"All statuses"})}),e.jsxs(A,{children:[e.jsx(m,{value:"approved",children:"Approved"}),e.jsx(m,{value:"rejected",children:"Rejected"}),e.jsx(m,{value:"pending",children:"Pending"})]})]})})]}),e.jsx(O,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Location"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"region",children:"Region"}),e.jsxs(S,{value:h.region||"",onValueChange:l=>u({...h,region:l}),children:[e.jsx(M,{id:"region",children:e.jsx(D,{placeholder:"All regions"})}),e.jsxs(A,{children:[e.jsx(m,{value:"north",children:"North"}),e.jsx(m,{value:"east",children:"East"}),e.jsx(m,{value:"west",children:"West"}),e.jsx(m,{value:"south",children:"South"}),e.jsx(m,{value:"central",children:"Central"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"state",children:"State"}),e.jsxs(S,{value:h.state||"",onValueChange:l=>u({...h,state:l}),children:[e.jsx(M,{id:"state",children:e.jsx(D,{placeholder:"All states"})}),e.jsxs(A,{children:[e.jsx(m,{value:"Khartoum",children:"Khartoum"}),e.jsx(m,{value:"North Darfur",children:"North Darfur"}),e.jsx(m,{value:"Red Sea",children:"Red Sea"}),e.jsx(m,{value:"Kassala",children:"Kassala"}),e.jsx(m,{value:"Al Jazirah",children:"Al Jazirah"})]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-8",children:[e.jsx(p,{variant:"outline",className:"flex-1",onClick:i,children:"Reset"}),e.jsx(p,{className:"flex-1",onClick:j,children:"Apply Filters"})]})]})})},Ye=()=>{const{statistics:r,loading:x}=k();return x?e.jsxs(f,{className:"w-full",children:[e.jsxs(b,{children:[e.jsx(w,{className:"h-6 w-1/3"}),e.jsx(w,{className:"h-4 w-1/2"})]}),e.jsxs(N,{className:"space-y-8",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((s,d)=>e.jsx(w,{className:"h-20"},d))}),e.jsx(w,{className:"h-40"})]})]}):e.jsxs(f,{className:"w-full",children:[e.jsxs(b,{children:[e.jsxs(I,{className:"text-lg flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-primary"}),"Archive Statistics"]}),e.jsx(de,{children:"Overview of archived records and documentation"})]}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-muted/40 rounded-md p-4 flex flex-col items-center justify-center text-center",children:[e.jsx(Q,{className:"h-8 w-8 text-primary mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.totalMmps}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total MMPs"})]}),e.jsxs("div",{className:"bg-muted/40 rounded-md p-4 flex flex-col items-center justify-center text-center",children:[e.jsx(U,{className:"h-8 w-8 text-primary mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.totalSiteVisits}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Site Visits"})]}),e.jsxs("div",{className:"bg-muted/40 rounded-md p-4 flex flex-col items-center justify-center text-center",children:[e.jsx(V,{className:"h-8 w-8 text-primary mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.totalDocuments}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Documents"})]}),e.jsxs("div",{className:"bg-primary/10 rounded-md p-4 flex flex-col justify-center",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"Document Categories"}),Object.entries(r.documentsByCategory||{}).slice(0,3).map(([s,d])=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:s.charAt(0).toUpperCase()+s.slice(1)}),e.jsx("span",{className:"font-medium",children:d})]},s)),Object.keys(r.documentsByCategory||{}).length>3&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 text-right",children:["+",Object.keys(r.documentsByCategory||{}).length-3," more"]})]})]}),e.jsxs("div",{className:"bg-muted/20 rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:"Monthly Archives"}),e.jsx("div",{className:"space-y-2",children:r.monthlyTrends.slice(0,6).map((s,d)=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:new Date(s.year,s.month).toLocaleDateString("default",{month:"long",year:"numeric"})}),e.jsxs("span",{children:[s.mmps+s.siteVisits+s.documents," records"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"bg-primary h-full",style:{width:`${s.mmps/(s.mmps+s.siteVisits+s.documents)*100}%`}}),e.jsx("div",{className:"bg-blue-500 h-full",style:{width:`${s.siteVisits/(s.mmps+s.siteVisits+s.documents)*100}%`}}),e.jsx("div",{className:"bg-amber-500 h-full",style:{width:`${s.documents/(s.mmps+s.siteVisits+s.documents)*100}%`}})]})})]},d))}),e.jsxs("div",{className:"flex justify-end gap-4 mt-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"}),e.jsx("span",{className:"text-xs",children:"MMPs"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-xs",children:"Site Visits"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-xs",children:"Documents"})]})]})]})]})]})},qe=()=>{const{archivedMMPs:r,loading:x,currentArchive:s}=k(),d=Z(),h=i=>{d(`/mmp/${i}`)},u=i=>{switch(i){case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"archived":return"bg-slate-100 text-slate-800 border-slate-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};if(x)return e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(w,{className:"h-6 w-1/3"})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((i,t)=>e.jsx(w,{className:"h-24 w-full"},t))})})]});const j=s?r.filter(i=>i.year===s.year&&i.month===s.month):r;return e.jsxs(f,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsxs(I,{className:"text-lg flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-primary"}),"Archived MMP Files"]}),e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(V,{className:"h-4 w-4 mr-2"})," Export List"]})]}),e.jsx(N,{children:j.length>0?e.jsx("div",{className:"space-y-4",children:j.map(i=>e.jsxs("div",{className:"border rounded-lg p-4 transition-all hover:shadow-md flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between md:justify-start md:gap-3",children:[e.jsx("h3",{className:"font-medium text-base truncate",children:i.name}),e.jsx(F,{className:`ml-2 ${u(i.status)}`,children:i.status.charAt(0).toUpperCase()+i.status.slice(1)})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-x-6 gap-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"ID:"}),e.jsx("span",{className:"font-mono",children:i.id})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Uploaded:"}),e.jsx("span",{children:T(new Date(i.uploadedAt),"MMM d, yyyy")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Sites:"}),e.jsx("span",{children:i.entries})]})]}),i.documents.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[e.jsx(V,{className:"h-3.5 w-3.5"}),i.documents.length," document",i.documents.length>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 self-end md:self-center",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>h(i.id),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"View"]}),e.jsxs(J,{children:[e.jsx(G,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",children:e.jsx(ce,{className:"h-4 w-4"})})}),e.jsxs(W,{align:"end",children:[e.jsx(oe,{children:"Actions"}),e.jsxs(P,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsxs(P,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Change Archive Status"]})]})]})]})]},i.id))}):e.jsx("div",{className:"text-center py-10 text-muted-foreground",children:s?`No MMP files found for ${s.label}`:"No archived MMP files found"})})]})},Ke=()=>{const{archivedSiteVisits:r,loading:x,currentArchive:s}=k(),d=Z(),h=t=>{d(`/site-visits/${t}`)},u=t=>{switch(t){case"completed":return"bg-green-100 text-green-800 border-green-200";case"cancelled":case"canceled":return"bg-red-100 text-red-800 border-red-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"inProgress":return"bg-blue-100 text-blue-800 border-blue-200";case"assigned":return"bg-purple-100 text-purple-800 border-purple-200";case"permitVerified":return"bg-teal-100 text-teal-800 border-teal-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},j=t=>{switch(t){case"inProgress":return"In Progress";case"permitVerified":return"Permit Verified";default:return t.charAt(0).toUpperCase()+t.slice(1)}};if(x)return e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(w,{className:"h-6 w-1/3"})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((t,o)=>e.jsx(w,{className:"h-24 w-full"},o))})})]});const i=s?r.filter(t=>{const o=new Date(t.archiveDate);return o.getFullYear()===s.year&&o.getMonth()+1===s.month}):r;return e.jsxs(f,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsxs(I,{className:"text-lg flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-primary"}),"Archived Site Visits"]}),e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(V,{className:"h-4 w-4 mr-2"})," Export List"]})]}),e.jsx(N,{children:i.length>0?e.jsx("div",{className:"space-y-4",children:i.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 transition-all hover:shadow-md flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between md:justify-start md:gap-3",children:[e.jsxs("h3",{className:"font-medium text-base truncate",children:[t.siteName,e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",t.siteCode,")"]})]}),e.jsx(F,{className:`ml-2 ${u(t.status)}`,children:j(t.status)})]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(we,{className:"h-3.5 w-3.5 mr-1"}),t.state,", ",t.locality]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-x-6 gap-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Visit Date:"}),e.jsx("span",{children:T(new Date(t.scheduledDate),"MMM d, yyyy")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Activity:"}),e.jsx("span",{className:"truncate max-w-[150px]",children:t.mainActivity})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Assigned To:"}),e.jsx("span",{children:t.assignedTo})]})]}),t.documents.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[e.jsx(V,{className:"h-3.5 w-3.5"}),t.documents.length," document",t.documents.length>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 self-end md:self-center",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>h(t.id),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"View"]}),e.jsxs(J,{children:[e.jsx(G,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",children:e.jsx(ce,{className:"h-4 w-4"})})}),e.jsxs(W,{align:"end",children:[e.jsx(oe,{children:"Actions"}),e.jsxs(P,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsxs(P,{children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"View Location"]})]})]})]})]},t.id))}):e.jsx("div",{className:"text-center py-10 text-muted-foreground",children:s?`No site visits found for ${s.label}`:"No archived site visits found"})})]})},K=r=>{if(r===0)return"0 Bytes";const x=1024,s=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(r)/Math.log(x));return parseFloat((r/Math.pow(x,d)).toFixed(2))+" "+s[d]},Qe=()=>{const{documents:r,loading:x,uploadDocument:s,deleteDocument:d}=k(),[h,u]=y.useState(!1),[j,i]=y.useState(null),[t,o]=y.useState("mmp"),[l,g]=y.useState(""),[C,$]=y.useState(""),[R,a]=y.useState("mmp"),[n,me]=y.useState(null),[xe,B]=y.useState(!1),he=c=>{c.target.files&&c.target.files[0]&&i(c.target.files[0])},ue=async()=>{if(!j)return;const c={fileName:j.name,fileUrl:URL.createObjectURL(j),fileType:j.type,fileSize:j.size,uploadedBy:"current-user",uploadedAt:new Date().toISOString(),category:t,relatedEntityId:l,relatedEntityType:R,description:C};await s(c)&&(u(!1),je())},je=()=>{i(null),o("mmp"),g(""),$(""),a("mmp")},pe=c=>{me(c),B(!0)},ge=async c=>{window.confirm("Are you sure you want to delete this document?")&&await d(c)};return x?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((c,X)=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(w,{className:"h-6 w-1/3"})}),e.jsx(N,{children:e.jsx(w,{className:"h-24 w-full"})})]},X))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Archive Documents"}),e.jsxs(se,{open:h,onOpenChange:u,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Upload Document"]})}),e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsx(le,{children:"Upload New Document"}),e.jsx(re,{children:"Add a new document to the archive. Select a file and provide additional information."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(v,{htmlFor:"file",children:"Document File"}),e.jsx(H,{id:"file",type:"file",onChange:he,className:"cursor-pointer"}),j&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Selected: ",j.name," (",K(j.size),")"]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(v,{htmlFor:"category",children:"Category"}),e.jsxs(S,{value:t,onValueChange:o,children:[e.jsx(M,{id:"category",children:e.jsx(D,{placeholder:"Select category"})}),e.jsxs(A,{children:[e.jsx(m,{value:"mmp",children:"MMP File"}),e.jsx(m,{value:"siteVisit",children:"Site Visit"}),e.jsx(m,{value:"permit",children:"Permit"}),e.jsx(m,{value:"verification",children:"Verification"}),e.jsx(m,{value:"report",children:"Report"}),e.jsx(m,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(v,{htmlFor:"relatedType",children:"Related To"}),e.jsxs(S,{value:R,onValueChange:c=>a(c),children:[e.jsx(M,{id:"relatedType",children:e.jsx(D,{placeholder:"Select related type"})}),e.jsxs(A,{children:[e.jsx(m,{value:"mmp",children:"MMP File"}),e.jsx(m,{value:"siteVisit",children:"Site Visit"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(v,{htmlFor:"relatedId",children:"Related ID"}),e.jsx(H,{id:"relatedId",placeholder:"Enter related MMP or Site Visit ID",value:l,onChange:c=>g(c.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(v,{htmlFor:"description",children:"Description (optional)"}),e.jsx(Ue,{id:"description",placeholder:"Enter document description",value:C,onChange:c=>$(c.target.value)})]})]}),e.jsxs(ie,{children:[e.jsx(p,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(p,{onClick:ue,disabled:!j,children:"Upload"})]})]})]})]}),r.length===0?e.jsx(f,{children:e.jsxs(N,{className:"flex flex-col items-center justify-center py-10",children:[e.jsx(V,{className:"h-16 w-16 text-muted-foreground/40 mb-4"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"No documents found in the archive"}),e.jsx(p,{variant:"outline",className:"mt-4",onClick:()=>u(!0),children:"Upload Your First Document"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(c=>e.jsxs(f,{className:"overflow-hidden",children:[e.jsx(b,{className:"bg-muted/30 p-3",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:ne("p-2 rounded-md",c.category==="mmp"?"bg-blue-100 text-blue-600":c.category==="siteVisit"?"bg-green-100 text-green-600":"bg-gray-100 text-gray-600"),children:e.jsx(V,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx(I,{className:"text-base",children:c.fileName}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[T(new Date(c.uploadedAt),"MMM dd, yyyy")," Â· ",K(c.fileSize)]})]})]})})}),e.jsxs(N,{className:"p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:c.description||"No description provided"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{variant:"outline",className:ne("capitalize",c.category==="mmp"&&"text-blue-600 bg-blue-50",c.category==="siteVisit"&&"text-green-600 bg-green-50",c.category==="permit"&&"text-amber-600 bg-amber-50",c.category==="verification"&&"text-purple-600 bg-purple-50",c.category==="report"&&"text-indigo-600 bg-indigo-50"),children:c.category}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["ID: ",c.relatedEntityId.substring(0,8)]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>pe(c),children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"icon",children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>ge(c.id),children:e.jsx(Ce,{className:"h-4 w-4"})})]})]})]})]},c.id))}),e.jsx(se,{open:xe,onOpenChange:B,children:e.jsxs(te,{className:"max-w-3xl",children:[e.jsxs(ae,{children:[e.jsx(le,{children:n==null?void 0:n.fileName}),e.jsxs(re,{children:["Uploaded on ",n&&T(new Date(n.uploadedAt),"MMMM dd, yyyy")]})]}),e.jsx("div",{className:"min-h-[400px] border rounded-md p-4",children:e.jsx("div",{className:"flex items-center justify-center h-full",children:n!=null&&n.fileType.includes("image")?e.jsx("img",{src:n==null?void 0:n.fileUrl,alt:n==null?void 0:n.fileName,className:"max-h-[350px] object-contain"}):e.jsxs("div",{className:"text-center",children:[e.jsx(V,{className:"h-16 w-16 mx-auto text-muted-foreground/40 mb-4"}),e.jsx("p",{children:"Document preview not available"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Download the file to view its contents"})]})})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Document Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mt-2",children:[e.jsx("div",{className:"text-muted-foreground",children:"Category:"}),e.jsx("div",{className:"capitalize",children:n==null?void 0:n.category}),e.jsx("div",{className:"text-muted-foreground",children:"Related To:"}),e.jsx("div",{className:"capitalize",children:n==null?void 0:n.relatedEntityType}),e.jsx("div",{className:"text-muted-foreground",children:"Related ID:"}),e.jsx("div",{children:n==null?void 0:n.relatedEntityId}),e.jsx("div",{className:"text-muted-foreground",children:"File Size:"}),e.jsx("div",{children:n&&K(n.fileSize)}),e.jsx("div",{className:"text-muted-foreground",children:"Uploaded By:"}),e.jsx("div",{children:n==null?void 0:n.uploadedBy})]}),(n==null?void 0:n.description)&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-medium text-sm mt-4",children:"Description"}),e.jsx("p",{className:"text-sm mt-1",children:n.description})]})]}),e.jsxs(ie,{children:[e.jsx(p,{variant:"outline",onClick:()=>B(!1),children:"Close"}),e.jsxs(p,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Download"]})]})]})})]})},He=({onResultSelect:r})=>{const{searchArchives:x}=k(),{toast:s}=Pe(),[d,h]=y.useState(""),[u,j]=y.useState(!1),[i,t]=y.useState(!1),[o,l]=y.useState({mmps:[],siteVisits:[],documents:[]}),g=async()=>{if(!d.trim()){s({title:"Empty search",description:"Please enter a search term",variant:"destructive"});return}j(!0);try{const a=await x(d);l(a),t(!0);const n=a.mmps.length+a.siteVisits.length+a.documents.length;s(n===0?{title:"No results found",description:`No matches found for "${d}"`}:{title:"Search complete",description:`Found ${n} result${n!==1?"s":""}`})}catch{s({title:"Search error",description:"An error occurred while searching",variant:"destructive"})}finally{j(!1)}},C=()=>{h(""),l({mmps:[],siteVisits:[],documents:[]}),t(!1)},$=a=>{a.key==="Enter"&&g()},R=(a,n)=>{r&&r(a,n)};return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(H,{placeholder:"Search archives by name, ID, status, region...",value:d,onChange:a=>h(a.target.value),onKeyDown:$,className:"pl-10 w-full bg-background/70 backdrop-blur-sm"}),d&&e.jsx("button",{onClick:C,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:e.jsx(Se,{className:"h-4 w-4"})})]}),e.jsxs(p,{onClick:g,disabled:u||!d.trim(),className:"bg-primary/90",children:[u?e.jsx(Me,{className:"h-4 w-4 animate-spin"}):e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Search"})]})]}),i&&e.jsxs("div",{className:"space-y-6",children:[o.mmps.length===0&&o.siteVisits.length===0&&o.documents.length===0&&e.jsx("div",{className:"text-center py-10",children:e.jsxs("p",{className:"text-muted-foreground",children:['No results found for "',d,'"']})}),o.mmps.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center",children:["MMP Files",e.jsx("span",{className:"ml-2 text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full",children:o.mmps.length})]}),e.jsx("div",{className:"space-y-2",children:o.mmps.map(a=>e.jsx(f,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>R("mmp",a.id),children:e.jsxs(N,{className:"p-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:a.id}),e.jsx("span",{children:T(new Date(a.uploadedAt),"MMM d, yyyy")}),e.jsx("span",{children:a.region||"No region"})]})]}),e.jsx(F,{variant:a.status==="approved"?"default":a.status==="rejected"?"destructive":"outline",children:a.status})]})},a.id))})]}),o.siteVisits.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center",children:["Site Visits",e.jsx("span",{className:"ml-2 text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full",children:o.siteVisits.length})]}),e.jsx("div",{className:"space-y-2",children:o.siteVisits.map(a=>e.jsx(f,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>R("siteVisit",a.id),children:e.jsxs(N,{className:"p-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.siteName}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:a.siteCode}),e.jsxs("span",{children:[a.state,", ",a.locality]}),e.jsx("span",{children:T(new Date(a.scheduledDate),"MMM d, yyyy")})]})]}),e.jsx(F,{variant:a.status==="completed"?"default":a.status==="cancelled"||a.status==="canceled"?"destructive":"outline",children:a.status})]})},a.id))})]}),o.documents.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center",children:["Documents",e.jsx("span",{className:"ml-2 text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full",children:o.documents.length})]}),e.jsx("div",{className:"space-y-2",children:o.documents.map(a=>e.jsx(f,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>R("document",a.id),children:e.jsxs(N,{className:"p-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.fileName}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:a.fileType.toUpperCase()}),e.jsx("span",{children:T(new Date(a.uploadedAt),"MMM d, yyyy")}),e.jsxs("span",{children:[(a.fileSize/(1024*1024)).toFixed(2)," MB"]})]})]}),e.jsx(F,{variant:"outline",children:a.category})]})},a.id))})]})]})]})},_e=()=>{const{archives:r,currentArchive:x,selectMonth:s,loading:d}=k(),[h,u]=E.useState(new Date);E.useEffect(()=>{if(x){const l=new Date;l.setFullYear(x.year),l.setMonth(x.month-1),u(l)}},[x]);const j=l=>{l&&(u(l),s(l.getFullYear(),l.getMonth()+1))},i=E.useMemo(()=>Array.from(new Set(r.map(g=>g.year))).sort((g,C)=>C-g),[r]),t=l=>{const g=parseInt(l,10),C=new Date(h);C.setFullYear(g),u(C)};if(d)return e.jsxs(f,{children:[e.jsx(b,{className:"pb-3",children:e.jsx(w,{className:"h-6 w-1/2"})}),e.jsx(N,{children:e.jsx(w,{className:"h-[260px] w-full"})})]});const o=r.map(l=>{const g=new Date;return g.setFullYear(l.year),g.setMonth(l.month-1),g});return e.jsxs(f,{className:"w-full",children:[e.jsx(b,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{className:"text-lg",children:"Archive Calendar"}),e.jsxs(S,{value:h.getFullYear().toString(),onValueChange:t,children:[e.jsx(M,{className:"w-[100px]",children:e.jsx(D,{placeholder:h.getFullYear().toString()})}),e.jsx(A,{children:i.map(l=>e.jsx(m,{value:l.toString(),children:l},l))})]})]})}),e.jsxs(N,{children:[e.jsx(Le,{mode:"single",selected:h,onSelect:j,className:"rounded-md border",modifiers:{archived:l=>o.some(g=>$e(l,g)&&l.getFullYear()===g.getFullYear())},modifiersClassNames:{archived:"bg-primary/10 font-medium text-primary"}}),x&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("h3",{className:"text-sm font-medium mb-2",children:["Archive Summary: ",x.label]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(F,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),x.mmpsCount," MMPs"]}),e.jsxs(F,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),x.siteVisitsCount," Site Visits"]}),e.jsxs(F,{variant:"secondary",className:"flex items-center",children:[x.documentsCount," Documents"]})]})]})]})]})},js=()=>{const r=Z(),[x,s]=y.useState(!1),{currentUser:d}=Te(),{checkPermission:h,hasAnyRole:u}=Re();if(!(h("reports","read")||u(["admin"])))return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs(f,{className:"w-full max-w-md",children:[e.jsxs(b,{children:[e.jsx(I,{className:"text-destructive",children:"Access Denied"}),e.jsx(de,{children:"You don't have permission to access this page."})]}),e.jsx(N,{children:e.jsx(p,{variant:"outline",onClick:()=>r("/dashboard"),className:"w-full",children:"Return to Dashboard"})})]})});const i=()=>{r("/dashboard")},t=(o,l)=>{o==="mmp"?r(`/mmp/${l}`):o==="siteVisit"&&r(`/site-visits/${l}`)};return e.jsx(Ie,{currentUser:d,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Be,{onFilterOpen:()=>s(!0),onBackClick:i}),e.jsx(Oe,{open:x,onOpenChange:s}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(He,{onResultSelect:t})}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(_e,{})})]}),e.jsx(Ye,{}),e.jsxs(ze,{defaultValue:"mmps",className:"w-full",children:[e.jsxs(Ee,{className:"grid grid-cols-3 max-w-md mx-auto mb-4",children:[e.jsx(Y,{value:"mmps",children:"MMP Files"}),e.jsx(Y,{value:"visits",children:"Site Visits"}),e.jsx(Y,{value:"documents",children:"Documents"})]}),e.jsx(q,{value:"mmps",className:"space-y-6",children:e.jsx(qe,{})}),e.jsx(q,{value:"visits",className:"space-y-6",children:e.jsx(Ke,{})}),e.jsx(q,{value:"documents",className:"space-y-6",children:e.jsx(Qe,{})})]})]})})};export{js as default};
