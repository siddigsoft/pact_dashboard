import{j as e,r as o,l as se,o as He,aP as Ge,p as Ne,ah as de,aO as We,a8 as Je,u as Qe,a3 as oe,n as Xe,am as Ze,bj as Ke,b5 as Ye}from"./react-core-B8kFjp2k.js";import{I as p,a as m,u as be,D as ye,l as Ae,m as we,n as Se,o as es,H as me,a3 as G,B as ae,p as ss,E as as,Z as ts,R as ns,C as B,b as q,A as ls,c as is,d as rs,f as W,g as J,T as cs,i as ds,j as D,k as E,s as os}from"./index-PwDgWEVM.js";import{u as ms,t as xs,o as hs,s as Q}from"./forms-CESK2FDA.js";import{F as us,a as X,b as Z,e as K,c as Y,d as ee}from"./form-BT_tmI7p.js";import{s as ps,g as fs}from"./sudanStates-CkkbYUnU.js";import{R as xe,U as he}from"./UserClassificationBadge-nu7nDiDQ.js";import{C as P,a as js,R as ue}from"./ClassificationBadge-CQcKQdLP.js";import{L as w}from"./label-C4lDws8j.js";import{T as vs}from"./textarea-BpQMf5eL.js";import{S as O,a as M,b as $,c as _,d as I}from"./select-CXX5Q_V1.js";import{S as gs}from"./switch-DFAHzttT.js";import{A as Ce,b as ke,a as Ns}from"./alert-BXWNuJnD.js";import{C as pe}from"./calendar-DEyRSxJX.js";import{P as fe,a as je,b as ve}from"./popover-BSK_FA51.js";import{o as z}from"./date-utils-YarVESQS.js";import{bI as bs,bo as ys}from"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";const As=hs({accountName:Q().min(3,{message:"Account name must be at least 3 characters long"}),branch:Q().min(2,{message:"Branch name is required"}),accountNumber:Q().length(7,{message:"Account number must be exactly 7 digits"}).regex(/^\d+$/,{message:"Account number must contain only digits"})});function ws({onSubmit:b,isSubmitting:S,existingDetails:l,isEditable:v=!0,currentUserRole:n}){const f=n==="admin"||n==="ict"||!l,y=ms({resolver:xs(As),defaultValues:{accountName:(l==null?void 0:l.accountName)||"",branch:(l==null?void 0:l.branch)||"",accountNumber:(l==null?void 0:l.accountNumber)||""}});return e.jsx(us,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit(b),className:"space-y-4",children:[e.jsx(X,{control:y.control,name:"accountName",render:({field:s})=>e.jsxs(Z,{children:[e.jsx(K,{children:"Account Full Name"}),e.jsx(Y,{children:e.jsx(p,{placeholder:"Enter your full name as it appears on your account",...s,disabled:!f||!v})}),e.jsx(ee,{})]})}),e.jsx(X,{control:y.control,name:"branch",render:({field:s})=>e.jsxs(Z,{children:[e.jsx(K,{children:"Branch Name"}),e.jsx(Y,{children:e.jsx(p,{placeholder:"Enter your bank branch name",...s,disabled:!f||!v})}),e.jsx(ee,{})]})}),e.jsx(X,{control:y.control,name:"accountNumber",render:({field:s})=>e.jsxs(Z,{children:[e.jsx(K,{children:"Account Number (7 digits)"}),e.jsx(Y,{children:e.jsx(p,{placeholder:"Enter your 7 digit account number",maxLength:7,...s,onChange:g=>{const N=g.target.value.replace(/[^\d]/g,"");g.target.value=N,s.onChange(N)},disabled:!f||l&&!f||!v})}),e.jsx(ee,{})]})}),v&&e.jsx(m,{type:"submit",className:"w-full",disabled:S||l&&!f,children:S?"Processing...":l?"Update Account":"Register Account"})]})})}const Ss=({open:b,onOpenChange:S,userId:l,userName:v,currentClassification:n,classificationHistory:f=[],onSave:y})=>{const{toast:s}=be(),[g,N]=o.useState(!1),[x,V]=o.useState(!1),[i,h]=o.useState({classificationLevel:(n==null?void 0:n.classificationLevel)||"C",roleScope:(n==null?void 0:n.roleScope)||"dataCollector",effectiveFrom:(n==null?void 0:n.effectiveFrom)||new Date().toISOString(),effectiveUntil:n==null?void 0:n.effectiveUntil,hasRetainer:(n==null?void 0:n.hasRetainer)||!1,retainerAmountCents:(n==null?void 0:n.retainerAmountCents)||0,retainerCurrency:(n==null?void 0:n.retainerCurrency)||"SDG",retainerFrequency:(n==null?void 0:n.retainerFrequency)||"monthly",changeReason:"",notes:""}),[k,c]=o.useState(i.effectiveFrom?new Date(i.effectiveFrom):new Date),[C,d]=o.useState(i.effectiveUntil?new Date(i.effectiveUntil):void 0);o.useEffect(()=>{if(n)h({classificationLevel:n.classificationLevel,roleScope:n.roleScope,effectiveFrom:n.effectiveFrom,effectiveUntil:n.effectiveUntil,hasRetainer:n.hasRetainer,retainerAmountCents:n.retainerAmountCents,retainerCurrency:n.retainerCurrency,retainerFrequency:n.retainerFrequency,changeReason:"",notes:""}),c(new Date(n.effectiveFrom)),n.effectiveUntil?d(new Date(n.effectiveUntil)):d(void 0);else if(b&&l){const t=new Date;h({classificationLevel:"C",roleScope:"dataCollector",effectiveFrom:t.toISOString(),effectiveUntil:void 0,hasRetainer:!1,retainerAmountCents:0,retainerCurrency:"SDG",retainerFrequency:"monthly",changeReason:"",notes:""}),c(t),d(void 0)}},[n,b,l]);const F=async t=>{var U;if(t.preventDefault(),!((U=i.changeReason)!=null&&U.trim())){s({title:"Validation Error",description:"Please provide a reason for this classification change",variant:"destructive"});return}if(i.hasRetainer&&i.retainerAmountCents<=0){s({title:"Validation Error",description:"Retainer amount must be greater than zero",variant:"destructive"});return}N(!0);try{await y(i),s({title:"Success",description:"Classification updated successfully"}),S(!1)}catch(L){s({title:"Error",description:L instanceof Error?L.message:"Failed to update classification",variant:"destructive"})}finally{N(!1)}},T=t=>{const U=parseFloat(t)||0;h({...i,retainerAmountCents:Math.round(U*100)})};return e.jsx(ye,{open:b,onOpenChange:S,children:e.jsxs(Ae,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(we,{children:[e.jsxs(Se,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Manage Classification - ",v]}),n&&e.jsx(P,{level:n.classificationLevel,roleScope:n.roleScope,size:"md"})]}),e.jsx(es,{children:"Assign or update team member classification level and retainer settings"})]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"classification-level",children:"Classification Level"}),e.jsxs(O,{value:i.classificationLevel,onValueChange:t=>h({...i,classificationLevel:t}),children:[e.jsx(M,{id:"classification-level","data-testid":"select-classification-level",children:e.jsx($,{})}),e.jsx(_,{children:["A","B","C"].map(t=>e.jsx(I,{value:t,"data-testid":`option-level-${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{level:t,showTooltip:!1}),e.jsx("span",{children:js[t]})]})},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"role-scope",children:"Role Scope"}),e.jsxs(O,{value:i.roleScope,onValueChange:t=>h({...i,roleScope:t}),children:[e.jsx(M,{id:"role-scope","data-testid":"select-role-scope",children:e.jsx($,{})}),e.jsx(_,{children:["coordinator","dataCollector","supervisor"].map(t=>e.jsx(I,{value:t,"data-testid":`option-scope-${t}`,children:ue[t]},t))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Effective From"}),e.jsxs(fe,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:me("w-full justify-start text-left font-normal",!k&&"text-muted-foreground"),"data-testid":"button-effective-from",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),k?z(k,"PPP"):"Pick a date"]})}),e.jsx(ve,{className:"w-auto p-0",children:e.jsx(pe,{mode:"single",selected:k,onSelect:t=>{c(t),h({...i,effectiveFrom:(t==null?void 0:t.toISOString())||""})},initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Effective Until (Optional)"}),e.jsxs(fe,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:me("w-full justify-start text-left font-normal",!C&&"text-muted-foreground"),"data-testid":"button-effective-until",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),C?z(C,"PPP"):"No end date"]})}),e.jsx(ve,{className:"w-auto p-0",children:e.jsx(pe,{mode:"single",selected:C,onSelect:t=>{d(t),h({...i,effectiveUntil:t==null?void 0:t.toISOString()})},initialFocus:!0})})]})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs(w,{htmlFor:"has-retainer",className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4"}),"Monthly Retainer"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enable recurring monthly payments for this team member"})]}),e.jsx(gs,{id:"has-retainer",checked:i.hasRetainer,onCheckedChange:t=>h({...i,hasRetainer:t}),"data-testid":"switch-has-retainer"})]}),i.hasRetainer&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-primary/20",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"retainer-amount",children:"Retainer Amount"}),e.jsx(p,{id:"retainer-amount",type:"number",step:"0.01",min:"0",value:(i.retainerAmountCents/100).toFixed(2),onChange:t=>T(t.target.value),placeholder:"0.00","data-testid":"input-retainer-amount"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"retainer-currency",children:"Currency"}),e.jsxs(O,{value:i.retainerCurrency,onValueChange:t=>h({...i,retainerCurrency:t}),children:[e.jsx(M,{id:"retainer-currency","data-testid":"select-retainer-currency",children:e.jsx($,{})}),e.jsx(_,{children:["SDG","USD","EUR"].map(t=>e.jsx(I,{value:t,"data-testid":`option-currency-${t}`,children:t},t))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"retainer-frequency",children:"Payment Frequency"}),e.jsxs(O,{value:i.retainerFrequency,onValueChange:t=>h({...i,retainerFrequency:t}),children:[e.jsx(M,{id:"retainer-frequency","data-testid":"select-retainer-frequency",children:e.jsx($,{})}),e.jsxs(_,{children:[e.jsx(I,{value:"monthly","data-testid":"option-frequency-monthly",children:"Monthly"}),e.jsx(I,{value:"quarterly","data-testid":"option-frequency-quarterly",children:"Quarterly"}),e.jsx(I,{value:"annual","data-testid":"option-frequency-annual",children:"Annual"})]})]})]})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"change-reason",className:"flex items-center gap-2",children:["Change Reason ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(p,{id:"change-reason",value:i.changeReason,onChange:t=>h({...i,changeReason:t.target.value}),placeholder:"e.g., Promotion to Level A due to exceptional performance",required:!0,"data-testid":"input-change-reason"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"notes",children:"Additional Notes (Optional)"}),e.jsx(vs,{id:"notes",value:i.notes,onChange:t=>h({...i,notes:t.target.value}),placeholder:"Any additional information about this classification...",rows:3,"data-testid":"textarea-notes"})]}),f.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(G,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>V(!x),className:"flex items-center gap-2","data-testid":"button-toggle-history",children:[e.jsx(Ge,{className:"h-4 w-4"}),x?"Hide":"Show"," Classification History (",f.length,")"]}),x&&e.jsx("div",{className:"space-y-2 pl-4 border-l-2 border-muted",children:f.map(t=>e.jsxs("div",{className:"flex items-start gap-3 text-sm",children:[e.jsx(P,{level:t.classificationLevel,size:"sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:ue[t.roleScope]}),e.jsxs(ae,{variant:"outline",className:"text-xs",children:[z(new Date(t.effectiveFrom),"PP"),t.effectiveUntil&&` - ${z(new Date(t.effectiveUntil),"PP")}`]})]}),t.changeReason&&e.jsx("p",{className:"text-muted-foreground mt-1",children:t.changeReason})]})]},t.id))})]})]}),n&&e.jsxs(Ce,{children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx(ke,{children:"This will update the team member's classification and may affect their site visit fees and wallet calculations."})]}),e.jsxs(ss,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>S(!1),disabled:g,"data-testid":"button-cancel",children:"Cancel"}),e.jsx(m,{type:"submit",disabled:g,"data-testid":"button-save-classification",children:g?"Saving...":n?"Update Classification":"Assign Classification"})]})]})]})})},ge=["admin","ict","fom","financialAdmin","supervisor","coordinator","dataCollector","reviewer"],Ks=()=>{var re;const{id:b}=bs(),{users:S,currentUser:l,updateUser:v,approveUser:n,rejectUser:f,refreshUsers:y}=as(),[s,g]=o.useState(null),N=ys(),{toast:x}=be(),[V,i]=o.useState(!1),h=(l==null?void 0:l.role)==="admin"||(l==null?void 0:l.role)==="Admin"||(l==null?void 0:l.role)==="ict"||(l==null?void 0:l.role)==="ICT",k=(l==null?void 0:l.role)==="admin"||(l==null?void 0:l.role)==="Admin"||(l==null?void 0:l.roles)&&(l.roles.includes("admin")||l.roles.includes("Admin")),[c,C]=o.useState(!1),[d,F]=o.useState({}),[T,t]=o.useState(!1),[U,L]=o.useState(!1),[Fe,te]=o.useState(!1),[Ue,ne]=o.useState(!1),{canManageFinances:Ie}=ts(),{getUserClassification:Le,getClassificationHistory:Re,assignClassification:De,refreshUserClassifications:Ee}=ns(),[Pe,H]=o.useState(!1),le=Ie(),j=s?Le(s.id):void 0,ie=s?Re(s.id):[];o.useEffect(()=>{if(b){ne(!0);const a=S.find(u=>u.id===b);a?(g(a),F(a),ne(!1)):(x({title:"User not found",description:`No user with ID ${b} exists`,variant:"destructive"}),N("/users"))}},[b,S,N,x]);const Te=a=>{if(!s)return;const u={...s,bankAccount:{accountName:a.accountName,accountNumber:a.accountNumber,branch:a.branch}};v&&v(u).then(r=>{r&&(g(u),x({title:"Bank Account Updated",description:`Bank account details updated for ${s.name}`}),i(!1))}).catch(r=>{x({title:"Update failed",description:"There was a problem updating the bank account information.",variant:"destructive"})})},Be=async a=>{if(s)try{await De(s.id,a),await Ee(),y&&await y(),x({title:"Classification Updated",description:`Classification updated for ${s.name}`}),H(!1)}catch{x({title:"Update failed",description:"There was a problem updating the classification.",variant:"destructive"})}},qe=a=>{if(!a.stateId)return"Not specified";const u=ps.find(R=>R.id===a.stateId);if(!u)return"Unknown state";if(!a.localityId)return u.name;const r=fs(a.stateId).find(R=>R.id===a.localityId);return r?`${u.name}, ${r.name}`:u.name},Oe=a=>a.split(" ").map(u=>u[0]).join("").toUpperCase().substring(0,2),Me=()=>{C(!0)},$e=()=>{C(!1),F(s||{})},A=(a,u)=>{F(r=>({...r,[a]:u}))},_e=async()=>{if(!(!v||!s)){t(!0);try{const a={...s,...d};if(await v(a)){const{data:r,error:R}=await os.from("profiles").select("*").eq("id",s.id).single();if(R||!r)g(a),F(a);else{const ce={id:r.id,name:r.full_name||r.username||"Unknown",email:r.email||a.email||"",role:r.role||a.role,roles:a.roles,stateId:r.state_id||a.stateId,hubId:r.hub_id||a.hubId,localityId:r.locality_id||a.localityId,avatar:r.avatar_url||a.avatar,username:r.username||a.username,fullName:r.full_name||a.fullName,phone:r.phone||a.phone,employeeId:r.employee_id||a.employeeId,bankAccount:r.bank_account||a.bankAccount,lastActive:a.lastActive||new Date().toISOString(),isApproved:r.status==="approved"||!1,availability:r.availability||a.availability||"offline",createdAt:r.created_at||a.createdAt||new Date().toISOString(),location:typeof r.location=="string"?(()=>{try{return JSON.parse(r.location)}catch{return a.location}})():r.location||a.location,performance:a.performance};g(ce),F(ce)}x({title:"User updated",description:"User information was successfully updated and will persist between sessions.",variant:"success"}),C(!1)}else x({title:"Update failed",description:"There was a problem updating the user information.",variant:"destructive"})}catch{x({title:"Update failed",description:"There was a problem updating the user information.",variant:"destructive"})}finally{t(!1)}}},ze=async()=>{!s||!n||(L(!0),await n(s.id),L(!1),x({title:"User approved",description:`${s.name} has been approved.`}))},Ve=async()=>{!s||!f||(te(!0),await f(s.id),te(!1),x({title:"User rejected",description:`${s.name} has been rejected.`}),N("/users"))};return Ue?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Loading user details..."})]})}):s?e.jsxs("div",{className:"container max-w-5xl mx-auto p-4 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>N("/users"),children:[e.jsx(de,{className:"mr-2 h-4 w-4"})," Back to Users"]}),k&&!c&&e.jsxs(m,{onClick:Me,variant:"outline",children:[e.jsx(We,{className:"h-4 w-4 mr-1"}),"Edit User"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx(B,{className:"md:col-span-1 shadow-lg border-0 bg-gradient-to-b from-primary/5 to-background",children:e.jsxs(q,{className:"pt-8 pb-6 flex flex-col items-center",children:[e.jsx(ls,{className:"h-32 w-32 shadow-lg border-4 border-background -mt-20 mb-4",children:s.avatar?e.jsx(is,{src:s.avatar,alt:s.name}):e.jsx(rs,{className:"bg-primary text-primary-foreground text-3xl",children:Oe(s.name)})}),e.jsxs("div",{className:"text-center w-full",children:[c?e.jsx(p,{className:"font-bold text-2xl text-center mb-1",value:d.name||"",onChange:a=>A("name",a.target.value)}):e.jsx("h2",{className:"text-2xl font-bold",children:s.name}),e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-1",children:[c?e.jsxs("select",{className:"border rounded px-2 py-1 text-center",value:d.role||"",onChange:a=>A("role",a.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select role"}),ge.map(a=>e.jsx("option",{value:a,children:a},a))]}):e.jsx(xe,{role:s.role,size:"sm"}),e.jsx(he,{userId:s.id}),e.jsx(ae,{className:"ml-2",variant:s.isApproved?"default":"destructive",children:s.isApproved?"Active":"Pending Approval"})]})]}),e.jsxs("div",{className:"w-full mt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),c?e.jsx(p,{type:"email",value:d.email||"",onChange:a=>A("email",a.target.value)}):e.jsx("span",{children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground"}),c?e.jsx(p,{value:d.phone||"",onChange:a=>A("phone",a.target.value)}):e.jsx("span",{children:s.phone||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"}),c?e.jsx(p,{value:d.stateId||"",placeholder:"State ID",onChange:a=>A("stateId",a.target.value)}):e.jsx("span",{children:qe(s)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Rating: ",((re=s.performance)==null?void 0:re.rating)??"-","/5"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Last Active: ",s.lastActive?new Date(s.lastActive).toLocaleString():"N/A"]})]})]}),!s.isApproved&&k&&!c&&e.jsxs("div",{className:"w-full flex justify-center gap-2 mt-6",children:[e.jsxs(m,{onClick:ze,disabled:U,variant:"default",children:[e.jsx(Ze,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(m,{onClick:Ve,disabled:Fe,variant:"destructive",children:[e.jsx(Ke,{className:"h-4 w-4 mr-1"}),"Reject"]})]}),c&&e.jsxs("div",{className:"w-full flex justify-center gap-2 mt-6",children:[e.jsx(m,{onClick:_e,disabled:T,variant:"default",children:T?"Saving...":"Save"}),e.jsx(m,{onClick:$e,variant:"outline",children:"Cancel"})]})]})}),e.jsxs(B,{className:"md:col-span-2 shadow-lg border-0",children:[e.jsx(W,{children:e.jsx(J,{className:"text-xl",children:"User Details"})}),e.jsx(q,{children:e.jsxs(cs,{defaultValue:"details",className:"w-full",children:[e.jsxs(ds,{className:"mb-4 w-full flex",children:[e.jsx(D,{value:"details",className:"flex-1",children:"Details"}),e.jsx(D,{value:"performance",className:"flex-1",children:"Performance"}),e.jsx(D,{value:"bankak",className:"flex-1",children:"Bank Account"}),e.jsx(D,{value:"location",className:"flex-1",children:"Location"}),le&&e.jsx(D,{value:"classification",className:"flex-1",children:"Classification"})]}),e.jsx(E,{value:"details",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm text-muted-foreground",children:"Full Name"}),c?e.jsx(p,{value:d.name||"",onChange:a=>A("name",a.target.value)}):e.jsx("p",{className:"font-semibold",children:s.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm text-muted-foreground",children:"Email"}),c?e.jsx(p,{type:"email",value:d.email||"",onChange:a=>A("email",a.target.value)}):e.jsx("p",{className:"font-semibold",children:s.email})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm text-muted-foreground",children:"Role"}),c?e.jsxs("select",{className:"border rounded px-2 py-1 w-full",value:d.role||"",onChange:a=>A("role",a.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select role"}),ge.map(a=>e.jsx("option",{value:a,children:a},a))]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx(xe,{role:s.role,size:"sm"}),e.jsx(he,{userId:s.id})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm text-muted-foreground",children:"Employee ID"}),c?e.jsx(p,{value:d.employeeId||"",onChange:a=>A("employeeId",a.target.value)}):e.jsx("p",{className:"font-semibold",children:s.employeeId||"N/A"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm text-muted-foreground",children:"Phone"}),c?e.jsx(p,{value:d.phone||"",onChange:a=>A("phone",a.target.value)}):e.jsx("p",{className:"font-semibold",children:s.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm text-muted-foreground",children:"Status"}),e.jsx(ae,{variant:s.isApproved?"default":"destructive",children:s.isApproved?"Active":"Pending Approval"})]})]})}),e.jsx(E,{value:"performance",children:s.performance?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-sm mb-1",children:"Rating"}),e.jsxs("p",{className:"text-2xl font-bold",children:[s.performance.rating,"/5"]})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-sm mb-1",children:"Completed Tasks"}),e.jsx("p",{className:"text-2xl font-bold",children:s.performance.totalCompletedTasks})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-sm mb-1",children:"On-Time Completion"}),e.jsxs("p",{className:"text-2xl font-bold",children:[s.performance.onTimeCompletion,"%"]})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-sm mb-1",children:"Current Workload"}),e.jsx("p",{className:"text-2xl font-bold",children:s.performance.currentWorkload||0})]})]})}):e.jsx("p",{className:"text-muted-foreground",children:"No performance data available."})}),e.jsx(E,{value:"bankak",children:s.bankAccount?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Bank Account Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Account Name"}),e.jsx("p",{className:"font-medium",children:s.bankAccount.accountName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Account Number"}),e.jsx("p",{className:"font-medium",children:s.bankAccount.accountNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Branch"}),e.jsx("p",{className:"font-medium",children:s.bankAccount.branch})]})]})]}),h&&e.jsx(m,{onClick:()=>i(!0),children:"Edit Bank Account"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"No bank account details available."}),h&&e.jsx(m,{onClick:()=>i(!0),children:"Add Bank Account"})]})}),e.jsx(E,{value:"location",children:s.location?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Latitude"}),e.jsx("p",{className:"font-medium",children:s.location.latitude})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Longitude"}),e.jsx("p",{className:"font-medium",children:s.location.longitude})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last Updated"}),e.jsx("p",{className:"font-medium",children:s.location.lastUpdated?new Date(s.location.lastUpdated).toLocaleString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Location Sharing"}),e.jsx("p",{className:"font-medium",children:s.location.isSharing?"Enabled":"Disabled"})]})]}),e.jsx("div",{className:"h-[300px] bg-slate-100 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Map view is not available in this view"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Check the Field Team page for interactive map"})]})})]}):e.jsx("p",{className:"text-muted-foreground",children:"No location data available."})}),le&&e.jsx(E,{value:"classification",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Current Classification"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage user classification and retainer"})]}),e.jsxs(m,{onClick:()=>H(!0),"data-testid":"button-manage-classification",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),j?"Update Classification":"Assign Classification"]})]}),j?e.jsxs(B,{children:[e.jsx(W,{children:e.jsx(J,{className:"text-base",children:"Active Classification"})}),e.jsx(q,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Level"}),e.jsx(P,{level:j.classificationLevel,size:"md",showTooltip:!1})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Role Scope"}),e.jsx("p",{className:"font-medium",children:j.roleScope})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Effective From"}),e.jsx("p",{className:"font-medium",children:new Date(j.effectiveFrom).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("p",{className:"font-medium",children:j.effectiveUntil&&new Date(j.effectiveUntil)<new Date?"Expired":"Active"})]}),j.retainerAmount&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Retainer Amount"}),e.jsxs("p",{className:"font-medium",children:[(j.retainerAmount/100).toFixed(2)," ",j.retainerCurrency]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Retainer Period"}),e.jsx("p",{className:"font-medium capitalize",children:j.retainerPeriod})]})]})]})})]}):e.jsxs(Ce,{children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx(Ns,{children:"No Classification Assigned"}),e.jsx(ke,{children:"This user doesn't have a classification assigned yet. Click the button above to assign one."})]}),ie.length>0&&e.jsxs(B,{children:[e.jsx(W,{children:e.jsx(J,{className:"text-base",children:"Classification History"})}),e.jsx(q,{children:e.jsx("div",{className:"space-y-2",children:ie.map(a=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{level:a.classificationLevel,size:"sm",showTooltip:!1}),e.jsx("span",{className:"text-sm font-medium",children:a.roleScope})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(a.effectiveFrom).toLocaleDateString()," -",a.effectiveUntil?new Date(a.effectiveUntil).toLocaleDateString():"Present"]})]}),a.retainerAmount&&e.jsxs("p",{className:"text-sm font-medium",children:[(a.retainerAmount/100).toFixed(2)," ",a.retainerCurrency,"/",a.retainerPeriod]})]},a.id))})})]})]})})]})})]})]}),e.jsx(ye,{open:V,onOpenChange:i,children:e.jsxs(Ae,{children:[e.jsx(we,{children:e.jsx(Se,{children:s!=null&&s.bankAccount?"Edit Bankak Account":"Add Bankak Account"})}),e.jsx(ws,{onSubmit:Te,isSubmitting:!1,existingDetails:s==null?void 0:s.bankAccount,currentUserRole:l==null?void 0:l.role})]})}),s&&e.jsx(Ss,{open:Pe,onOpenChange:H,onSave:Be,userId:s.id,userName:s.name,currentClassification:j})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Loading user details..."}),e.jsx("p",{className:"text-gray-500",children:"If this persists, the user may not exist."}),e.jsxs(m,{className:"mt-4",variant:"outline",onClick:()=>N("/users"),children:[e.jsx(de,{className:"mr-2 h-4 w-4"})," Back to Users"]})]})})};export{Ks as default};
