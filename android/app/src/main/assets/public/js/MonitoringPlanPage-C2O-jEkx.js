import{j as e,I as M,a3 as T,as as A,R as f}from"./react-core-B8kFjp2k.js";import{C as m,f as d,g as x,b as j,B as c,U as P,Z as C,a as E}from"./index-PwDgWEVM.js";import{M as k}from"./MMPSiteEntriesTable-DBUyVHQg.js";import"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./date-utils-YarVESQS.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";import"./table-CZ8ZB6wW.js";import"./checkbox-9q2dlFjr.js";const B=({data:t})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(m,{children:[e.jsx(d,{className:"pb-3",children:e.jsxs(x,{className:"flex items-center gap-2 text-lg",children:[e.jsx(M,{className:"h-5 w-5"}),"Project Overview"]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Project:"}),e.jsx(c,{variant:"outline",children:t.project})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Modality:"}),e.jsx(c,{variant:"secondary",children:t.modality})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Survey Tool:"}),e.jsx(c,{variant:"default",children:t.surveyTool})]})]})]}),e.jsxs(m,{children:[e.jsx(d,{className:"pb-3",children:e.jsxs(x,{className:"flex items-center gap-2 text-lg",children:[e.jsx(T,{className:"h-5 w-5"}),"Location Summary"]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Hub Office:"}),e.jsx("span",{className:"font-medium",children:t.hubOffice})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"State:"}),e.jsx("span",{className:"font-medium",children:t.state})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Kulbus Sites:"}),e.jsx(c,{variant:"outline",children:t.kulbusSites})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Geneina Sites:"}),e.jsx(c,{variant:"outline",children:t.geneinaSites})]})]})]}),e.jsxs(m,{children:[e.jsx(d,{className:"pb-3",children:e.jsxs(x,{className:"flex items-center gap-2 text-lg",children:[e.jsx(A,{className:"h-5 w-5"}),"Monitoring Details"]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Sites:"}),e.jsx(c,{variant:"default",className:"text-lg px-3 py-1",children:t.totalSites})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Monitoring By:"}),e.jsx(c,{variant:"secondary",children:t.monitoringEntity})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Activity Type:"}),e.jsx(c,{variant:"outline",children:"GFA"})]})]})]})]}),Y=()=>{const{mmpFiles:t,loading:O,error:g}=P(),{checkPermission:N,hasAnyRole:y}=C();if(!(N("mmp","read")||y(["admin"])))return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs(m,{className:"w-full max-w-md",children:[e.jsx(d,{children:e.jsx(x,{className:"text-destructive",children:"Access Denied"})}),e.jsx(j,{children:e.jsx(E,{variant:"outline",onClick:()=>window.history.back(),className:"w-full",children:"Go Back"})})]})});const n=f.useMemo(()=>(t||[]).flatMap(i=>(Array.isArray(i.siteEntries)?i.siteEntries:[]).map((r,l)=>({...r,id:(r==null?void 0:r.id)||`${i.id}-${l}`,mmpId:i.id,projectName:i.projectName||i.name||""}))),[t]),o=p=>{const i=new Map;p.forEach(l=>{const a=(l||"").toString().trim();a&&i.set(a,(i.get(a)||0)+1)});let h="",r=0;for(const[l,a]of i)a>r&&(r=a,h=l);return h||"—"},u=f.useMemo(()=>{const p=n.length,i=n.map(s=>s.locality||s.locality_name||""),h=n.map(s=>s.state||s.state_name||""),r=n.map(s=>s.hubOffice||s.hub_office||""),l=n.map(s=>s.siteActivity||s.activity_at_site||s.activity||""),a=n.map(s=>s.monitoringBy||s.monitoring_by||""),v=n.map(s=>s.surveyTool||s.survey_tool||""),b=(t||[]).map(s=>s.projectName||s.name||""),w=i.filter(s=>(s||"").toString().toLowerCase()==="kulbus").length,S=i.filter(s=>(s||"").toString().toLowerCase()==="geneina").length;return{totalSites:p,kulbusSites:w,geneinaSites:S,hubOffice:o(r),state:o(h),project:o(b)||"—",modality:o(l)||"—",monitoringEntity:o(a)||"PACT",surveyTool:o(v)||"PDM"}},[n,t]);return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Monitoring Plan"}),e.jsxs("p",{className:"text-muted-foreground",children:["Revised October-2025 monitoring plan for ",u.hubOffice," ",u.monitoringEntity]})]})}),g?e.jsx("div",{className:"text-sm text-red-600",children:"Failed to load monitoring plan data."}):e.jsx(B,{data:u}),e.jsxs(m,{children:[e.jsxs(d,{children:[e.jsx(x,{children:"Site Entries"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["All monitoring sites for the ",u.project," project with CBT-Value Voucher modality"]})]}),e.jsx(j,{children:e.jsx(k,{siteEntries:n})})]}),e.jsxs(m,{children:[e.jsx(d,{children:e.jsx(x,{children:"Project Notes"})}),e.jsx(j,{children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-red-800 font-medium",children:[e.jsx("strong",{children:"Note:"})," Those locations are for ",u.project," project and the GFA modality used was (CBT-Value Voucher)"]})})})]})]})};export{Y as default};
