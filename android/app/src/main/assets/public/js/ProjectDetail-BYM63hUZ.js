import{j as e,c as R,p as U,q as J,ag as H,l as C,aw as W,U as L,i as Y,r as p,bo as K,aO as Q,aR as X,a0 as Z,bp as F,E as ee,G as se,b5 as y,bq as ae,I as te,Y as k}from"./react-core-B8kFjp2k.js";import{C as f,f as D,g as A,b as v,B as d,F as z,a as m,T as re,i as le,j as I,k as S,r as ie,u as ne}from"./index-PwDgWEVM.js";import{P as B}from"./progress-vMwTbqUI.js";import{A as ce,h as de,a as me,b as oe,c as xe,d as he,e as ue,f as je,g as ge}from"./alert-dialog-D6avgrWz.js";import{J as P,o as _,G as T}from"./date-utils-YarVESQS.js";import{H as q,a as V,b as O}from"./hover-card-BltHYp3k.js";import{bo as G,bI as Ne}from"./vendor-VlxgVHMv.js";import{A as M,a as $,b as E}from"./alert-BXWNuJnD.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";const pe=({activities:s})=>{const l=a=>{switch(a){case"completed":return e.jsx(H,{className:"h-4 w-4 text-green-500"});case"inProgress":return e.jsx(J,{className:"h-4 w-4 text-blue-500"});case"cancelled":return e.jsx(U,{className:"h-4 w-4 text-red-500"});default:return e.jsx(R,{className:"h-4 w-4 text-gray-500"})}},r=a=>{try{const n=P(a);return T(n)?_(n,"PP"):"Invalid date"}catch{return"Invalid date"}};return e.jsxs(f,{children:[e.jsx(D,{children:e.jsx(A,{className:"text-lg",children:"Activity Timeline"})}),e.jsx(v,{children:e.jsx("div",{className:"relative",children:s.map((a,n)=>e.jsxs("div",{className:"mb-8 flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"rounded-full p-1 bg-muted",children:l(a.status)}),n<s.length-1&&e.jsx("div",{className:"w-0.5 h-full bg-muted mt-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:a.name}),e.jsx(d,{variant:a.status==="completed"?"default":"outline",children:a.status})]}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:a.description}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r(a.startDate)," - ",r(a.endDate)]})]})]},a.id))})})]})},fe=({userId:s,busy:l=!1})=>{const r=[new Date().toLocaleDateString(),new Date(Date.now()+864e5).toLocaleDateString(),new Date(Date.now()+2592e5).toLocaleDateString()];return e.jsxs(q,{children:[e.jsx(V,{children:e.jsxs(d,{variant:l?"destructive":"secondary",className:"cursor-help",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),l?"Calendar Busy":"Available"]})}),e.jsx(O,{className:"w-80",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Calendar Availability"}),l?e.jsxs("p",{className:"text-sm text-muted-foreground",children:["This user has conflicting assignments on:",e.jsx("ul",{className:"mt-2 space-y-1",children:r.map(a=>e.jsxs("li",{className:"text-destructive",children:["• ",a]},a))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"User is available for new assignments"})]})})]})},ve=({userId:s})=>{const{projects:l}=z(),r=l.filter(a=>{var n,h,x,o;return((h=(n=a.team)==null?void 0:n.members)==null?void 0:h.includes(s))||((o=(x=a.team)==null?void 0:x.teamComposition)==null?void 0:o.some(c=>c.userId===s))});return r.length===0?null:e.jsxs(q,{children:[e.jsx(V,{children:e.jsxs(d,{variant:r.length>2?"warning":"secondary",className:"cursor-help",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),r.length," Project",r.length!==1?"s":""]})}),e.jsx(O,{className:"w-80",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Project History"}),e.jsx("div",{className:"space-y-1",children:r.map(a=>e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:a.name}),e.jsxs("span",{className:"text-muted-foreground",children:[" - ",a.status]})]},a.id))}),r.length>2&&e.jsx("p",{className:"text-sm text-amber-600 mt-2",children:"⚠️ User is assigned to multiple projects"})]})})]})},be=({member:s})=>{const l=r=>r?r>80?"bg-red-500":r>60?"bg-amber-500":"bg-green-500":"bg-gray-200";return e.jsx(f,{className:"overflow-hidden hover:shadow-md transition-shadow",children:e.jsxs(v,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(L,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx(d,{variant:"outline",className:"mt-1",children:s.role})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"flex-1 h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${l(s.workload)} transition-all`,style:{width:`${s.workload||0}%`}})}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.workload||0,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ve,{userId:s.userId}),e.jsx(fe,{userId:s.userId,busy:s.workload?s.workload>80:!1})]})]})]})})},we=({project:s,onEdit:l,onDelete:r,deleting:a})=>{var b;const n=G(),[h,x]=p.useState("overview"),o=t=>{try{const i=P(t);return T(i)?_(i,"PPP"):"Invalid date"}catch{return"Invalid date"}},c=t=>{switch(t){case"draft":return e.jsxs(d,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"})," Draft"]});case"active":return e.jsxs(d,{variant:"default",className:"bg-green-600 flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3"})," Active"]});case"onHold":return e.jsxs(d,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3"})," On Hold"]});case"completed":return e.jsxs(d,{variant:"default",className:"bg-blue-600 flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3"})," Completed"]});case"cancelled":return e.jsxs(d,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"})," Cancelled"]});default:return e.jsx(d,{variant:"outline",children:t})}},u=()=>{const t=s.activities.filter(g=>g.status==="completed").length,i=s.activities.length;return{completed:t,total:i,percentage:i>0?t/i*100:0}},j=()=>{try{const t=P(s.startDate),i=P(s.endDate),g=new Date;if(!T(t)||!T(i))return 0;const N=i.getTime()-t.getTime();if(N<=0)return 0;const w=Math.min(g.getTime()-t.getTime(),N);return Math.max(0,Math.min(100,Math.round(w/N*100)))}catch{return 0}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.name}),c(s.status)]}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mt-1",children:[e.jsx(K,{className:"h-4 w-4 mr-1"})," ",s.projectCode]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l&&e.jsxs(m,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(Q,{className:"h-4 w-4 mr-2"})," Edit Project"]}),r&&e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(m,{variant:"outline",size:"sm",className:"text-destructive hover:bg-destructive/10 hover:text-destructive",disabled:!!a,children:[e.jsx(X,{className:"h-4 w-4 mr-2"})," Delete"]})}),e.jsxs(me,{children:[e.jsxs(oe,{children:[e.jsx(xe,{children:"Are you sure you want to delete this project?"}),e.jsxs(he,{children:['This action cannot be undone. This will permanently delete the project "',s.name,'" and all associated data including activities, team members, and progress tracking.']})]}),e.jsxs(ue,{children:[e.jsx(je,{children:"Cancel"}),e.jsx(ge,{onClick:r,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:!!a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2 animate-spin"})," Deleting..."]}):"Delete Project"})]})]})]})]})]}),e.jsxs(re,{defaultValue:"overview",value:h,onValueChange:x,children:[e.jsxs(le,{className:"grid grid-cols-3 md:w-[400px]",children:[e.jsx(I,{value:"overview",children:"Overview"}),e.jsx(I,{value:"activities",children:"Activities"}),e.jsx(I,{value:"team",children:"Team"})]}),e.jsx(S,{value:"overview",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(f,{className:"md:col-span-2",children:[e.jsx(D,{children:e.jsx(A,{className:"text-lg",children:"Project Details"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Project Type"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"h-4 w-4 mr-2 text-primary"}),e.jsx("span",{className:"capitalize",children:s.projectType})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:c(s.status)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start Date"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"h-4 w-4 mr-2 text-primary"}),e.jsx("span",{children:o(s.startDate)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"End Date"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"h-4 w-4 mr-2 text-primary"}),e.jsx("span",{children:o(s.endDate)})]})]}),s.budget&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Budget"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-2 text-primary"}),e.jsxs("span",{children:[s.budget.total.toLocaleString()," ",s.budget.currency]})]})]}),s.location&&(s.location.region||s.location.state)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Location"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-2 text-primary"}),e.jsxs("span",{children:[s.location.region,s.location.state&&`, ${s.location.state}`,s.location.locality&&`, ${s.location.locality}`]})]})]})]}),s.description&&e.jsxs("div",{className:"space-y-1 pt-2 border-t border-border",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{children:s.description})]})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(pe,{activities:s.activities})}),e.jsxs(f,{children:[e.jsx(D,{children:e.jsx(A,{className:"text-lg",children:"Progress"})}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Activities"}),e.jsxs("span",{className:"text-primary",children:[u().completed,"/",u().total]})]}),e.jsx(B,{value:u().percentage,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Timeline"}),e.jsxs("span",{className:"text-primary",children:[j(),"%"]})]}),e.jsx(B,{value:j(),className:"h-2"})]}),s.budget&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Budget"}),e.jsxs("span",{className:"text-primary",children:[Math.round(s.budget.allocated/s.budget.total*100)||0,"%"]})]}),e.jsx(B,{value:Math.round(s.budget.allocated/s.budget.total*100)||0,className:"h-2"})]})]})]})]})}),e.jsxs(S,{value:"activities",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Activities"}),e.jsxs(m,{size:"sm",onClick:()=>n(`/projects/${s.id}/activities/create`),children:[e.jsx(y,{className:"h-4 w-4 mr-2"})," Add Activity"]})]}),s.activities.length>0?e.jsx("div",{className:"space-y-4",children:s.activities.map(t=>e.jsxs(f,{className:"overflow-hidden",children:[e.jsx(D,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-md",children:t.name}),e.jsx(d,{variant:t.status==="completed"?"default":t.status==="inProgress"?"secondary":"outline",children:t.status})]})}),e.jsxs(v,{className:"py-2",children:[t.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"h-4 w-4 mr-1 text-muted-foreground"}),e.jsxs("span",{className:"text-muted-foreground",children:[o(t.startDate)," - ",o(t.endDate)]})]}),t.assignedTo&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"h-4 w-4 mr-1 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:t.assignedTo})]})]}),t.subActivities.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground font-medium",children:"SUB-ACTIVITIES"}),e.jsx("div",{className:"grid gap-2",children:t.subActivities.map(i=>e.jsxs("div",{className:"flex items-center justify-between py-1 px-3 rounded-md bg-muted/50",children:[e.jsx("span",{className:"text-sm",children:i.name}),e.jsx(d,{variant:i.status==="completed"?"default":i.status==="inProgress"?"secondary":"outline",className:"text-xs",children:i.status})]},i.id))})]})]}),e.jsx(ie,{className:"border-t pt-2 flex justify-end",children:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>n(`/projects/${s.id}/activities/${t.id}`),children:"View Details"})})]},t.id))}):e.jsxs("div",{className:"text-center py-12 border border-dashed rounded-lg border-border",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-muted mb-4",children:e.jsx(F,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium",children:"No activities yet"}),e.jsx("p",{className:"text-muted-foreground mt-1 max-w-md mx-auto",children:"Activities help you break down your project into manageable tasks"}),e.jsxs(m,{className:"mt-4",onClick:()=>n(`/projects/${s.id}/activities/create`),children:[e.jsx(y,{className:"h-4 w-4 mr-2"})," Add First Activity"]})]})]}),e.jsxs(S,{value:"team",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Team Members"}),e.jsxs(m,{size:"sm",onClick:()=>n(`/projects/${s.id}/team`),children:[e.jsx(y,{className:"h-4 w-4 mr-2"})," Add Members"]})]}),(b=s.team)!=null&&b.teamComposition&&s.team.teamComposition.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:s.team.teamComposition.map(t=>e.jsx(be,{member:t},t.userId))}):e.jsxs("div",{className:"text-center py-12 border border-dashed rounded-lg border-border",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-muted mb-4",children:e.jsx(L,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium",children:"No team members yet"}),e.jsx("p",{className:"text-muted-foreground mt-1 max-w-md mx-auto",children:"Assign team members to this project"}),e.jsxs(m,{className:"mt-4",onClick:()=>n(`/projects/${s.id}/team`),children:[e.jsx(y,{className:"h-4 w-4 mr-2"})," Add Team Members"]})]})]})]})]})},qe=()=>{const{id:s}=Ne(),l=G(),{getProjectById:r,loading:a,error:n,fetchProjects:h,projects:x,deleteProject:o}=z(),[c,u]=p.useState(void 0),{toast:j}=ne(),[b,t]=p.useState(!1);p.useEffect(()=>{x.length===0&&!a&&h()},[]),p.useEffect(()=>{if(!s){u(void 0);return}const w=r(s);u(w),!w&&!a&&x.length>0&&j({title:"Project Not Found",description:"The requested project could not be found.",variant:"destructive"})},[s,x,a]);const i=()=>{l(`/projects/${s}/edit`)},g=async()=>{if(!s){j({title:"Invalid Project",description:"Missing project ID. Please try again.",variant:"destructive"});return}try{t(!0),await o(s),l("/projects")}finally{t(!1)}};if(a&&!c)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative w-16 h-16 mx-auto",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-primary/20 animate-[spin_3s_linear_infinite]"}),e.jsx("div",{className:"absolute inset-[6px] rounded-full border-4 border-t-primary animate-[spin_2s_linear_infinite]"})]}),e.jsx("p",{className:"text-muted-foreground animate-pulse",children:"Loading project details..."})]})});if(n)return e.jsx("div",{className:"max-w-2xl mx-auto my-12",children:e.jsxs(M,{variant:"destructive",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx($,{children:"Error"}),e.jsxs(E,{children:[n,e.jsx("div",{className:"mt-4",children:e.jsx(m,{variant:"outline",onClick:()=>l("/projects"),children:"Back to Projects"})})]})]})});if(!c&&!a)return e.jsx("div",{className:"max-w-2xl mx-auto my-12",children:e.jsxs(M,{children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx($,{children:"Project Not Found"}),e.jsxs(E,{children:["The project you are looking for does not exist or has been removed.",e.jsx("div",{className:"mt-4",children:e.jsx(m,{variant:"outline",onClick:()=>l("/projects"),children:"Back to Projects"})})]})]})});const N=c&&c.startDate&&c.endDate&&c.projectType&&c.status;return e.jsx("div",{className:"space-y-6 animate-fade-in",children:N?e.jsx(we,{project:c,onEdit:i,onDelete:g,deleting:b}):c?e.jsx("div",{className:"max-w-2xl mx-auto my-12",children:e.jsxs(M,{children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx($,{children:"Incomplete Project Data"}),e.jsxs(E,{children:["Some required project information is missing. Please update the project details.",e.jsx("div",{className:"mt-4",children:e.jsx(m,{variant:"outline",onClick:()=>l(`/projects/${s}/edit`),children:"Edit Project"})})]})]})}):null})};export{qe as default};
