import{r as o,j as e,aS as j,t as y,aT as b,a2 as M,aU as C,ah as D,I as A,q as P,ag as k}from"./react-core-B8kFjp2k.js";import{e as T,u as I,D as E,$ as O,a as d,l as $,m as B,n as U,o as V,p as R,s as H,B as x}from"./index-PwDgWEVM.js";import{S as q,a as z,b as L,c as Y,d as _}from"./select-CXX5Q_V1.js";import{M as G}from"./MMPStatusBadge-CjxSGCNB.js";import{o as u}from"./date-utils-YarVESQS.js";const f=["notStarted","draft","verified","implementation","completed"];function J({currentStage:s,mmpId:l,onStageChange:c}){const[i,n]=o.useState(!1),[a,p]=o.useState(s),[h,g]=o.useState(!1),{currentUser:r}=T(),{toast:m}=I(),N=(r==null?void 0:r.role)==="admin"||(r==null?void 0:r.role)==="ict",S=f.indexOf(s),v=f.slice(S),w=async()=>{if(a===s){n(!1);return}g(!0);try{const t=await H.from("mmp_files").update({workflow:{currentStage:a,lastUpdated:new Date().toISOString(),assignedTo:(r==null?void 0:r.id)||null,comments:`Stage changed from ${s} to ${a}`}}).eq("id",l);if(t.error)throw t.error;c(a),m({description:`MMP stage updated to ${a}`}),n(!1)}catch{m({title:"Error",description:"Failed to update MMP stage",variant:"destructive"})}finally{g(!1)}};return N?e.jsxs(E,{open:i,onOpenChange:n,children:[e.jsx(O,{asChild:!0,children:e.jsx(d,{variant:"outline",size:"sm",className:"ml-2",children:"Change Stage"})}),e.jsxs($,{children:[e.jsxs(B,{children:[e.jsx(U,{children:"Change MMP Stage"}),e.jsx(V,{children:"Select the new stage for this MMP. You can only move forward in the workflow."})]}),e.jsx("div",{className:"py-4",children:e.jsxs(q,{value:a,onValueChange:t=>p(t),children:[e.jsx(z,{children:e.jsx(L,{placeholder:"Select new stage"})}),e.jsx(Y,{children:v.map(t=>e.jsx(_,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]})}),e.jsxs(R,{children:[e.jsx(d,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(d,{onClick:w,disabled:h||a===s,children:h?"Updating...":"Update Stage"})]})]})]}):null}const K=s=>{switch(s){case"notStarted":return"bg-gray-100 text-gray-800";case"draft":return"bg-blue-100 text-blue-800";case"verified":return"bg-green-100 text-green-800";case"implementation":return"bg-purple-100 text-purple-800";case"completed":return"bg-emerald-100 text-emerald-800";default:return"bg-gray-100 text-gray-800"}},Q=s=>{switch(s){case"notStarted":return e.jsx(j,{className:"h-3.5 w-3.5"});case"draft":return e.jsx(C,{className:"h-3.5 w-3.5"});case"verified":return e.jsx(M,{className:"h-3.5 w-3.5"});case"implementation":return e.jsx(b,{className:"h-3.5 w-3.5"});case"completed":return e.jsx(y,{className:"h-3.5 w-3.5"});default:return e.jsx(j,{className:"h-3.5 w-3.5"})}},W=({stage:s,lastUpdated:l,assignedTo:c,mmpId:i,onStageChange:n,status:a})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(x,{variant:"outline",className:`${K(s)} flex items-center gap-2`,children:[Q(s),s==="notStarted"?"Not Started":s.charAt(0).toUpperCase()+s.slice(1)]}),a&&e.jsx(x,{variant:"outline",className:a==="approved"?"bg-green-100 text-green-800":a==="rejected"?"bg-red-100 text-red-800":"bg-amber-100 text-amber-800",children:a.charAt(0).toUpperCase()+a.slice(1)}),l&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Updated ",new Date(l).toLocaleDateString()]}),c&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Assigned to ",c]}),n&&e.jsx(J,{currentStage:s,mmpId:i,onStageChange:n})]}),ae=({mmpFile:s,verificationProgress:l,onGoBack:c})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:c,children:e.jsx(D,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Verify MMP File"}),e.jsx("p",{className:"text-muted-foreground",children:(s==null?void 0:s.mmpId)||(s==null?void 0:s.id)})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsxs(x,{variant:"outline",className:"bg-amber-50 border-amber-200 text-amber-800",children:[l,"% Complete"]}),(s==null?void 0:s.workflow)&&e.jsx(W,{stage:s.workflow.currentStage,mmpId:s.id,status:s.status})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 rounded-lg border bg-card",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"File Details"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:["Name: ",s.name]}),e.jsxs("p",{className:"text-sm",children:["Type: ",s.type||"N/A"]}),e.jsxs("p",{className:"text-sm",children:["Project: ",s.projectName||"N/A"]}),e.jsx("div",{className:"flex items-center gap-2 pt-1",children:e.jsx(G,{status:s.status})})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Timeline"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:["Uploaded: ",u(new Date(s.uploadedAt),"MMM dd, yyyy")]}),e.jsxs("p",{className:"text-sm",children:["Month: ",s.month||"N/A"]}),e.jsxs("p",{className:"text-sm",children:["Year: ",s.year||"N/A"]}),s.expiryDate&&e.jsxs("p",{className:"text-sm",children:["Expires: ",u(new Date(s.expiryDate),"MMM dd, yyyy")]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Verification Progress"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:["Total Entries: ",s.entries]}),e.jsxs("p",{className:"text-sm",children:["Processed: ",s.processedEntries||0]}),e.jsxs("p",{className:"text-sm",children:["Region: ",s.region||"N/A"]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${l}%`}})})]})]})]})]});export{ae as M};
