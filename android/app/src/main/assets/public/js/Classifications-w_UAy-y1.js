import{r as c,j as e,o as te,a0 as Re,aB as ue,n as J,a4 as Me,ba as pe,Z as Te,b5 as Ee,K as z,U as fe,T as Ue,v as Ve,ap as $e,aO as Ie,aq as Ge,a5 as ze,aC as Pe,bA as Oe}from"./react-core-B8kFjp2k.js";import{R as De,D as _e,l as qe,m as He,n as Ye,o as Ze,B as F,I as ae,p as Je,a as N,u as Qe,e as Ke,Z as We,C as b,f as y,g as S,b as v,T as Xe,i as es,j as je,k as ge,h as be,s as ve}from"./index-PwDgWEVM.js";import{A as we,b as Ne}from"./alert-BXWNuJnD.js";import{S as Ce,a as ye,b as Se,c as Fe,d as w}from"./select-CXX5Q_V1.js";import{u as ss,t as ts,o as as,s as rs,c as Le}from"./forms-CESK2FDA.js";import{F as ls,a as Q,b as K,e as W,c as X,f as ee,d as se}from"./form-BT_tmI7p.js";import{T as is}from"./textarea-BpQMf5eL.js";import{bo as ns}from"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./date-utils-YarVESQS.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";import"./label-C4lDws8j.js";const os=as({siteVisitBaseFeeCents:Le.number().min(0,"Base fee must be positive").max(1e8,"Base fee too large"),complexityMultiplier:Le.number().min(1,"Multiplier must be at least 1.0").max(5,"Multiplier cannot exceed 5.0"),changeNotes:rs().min(5,"Please explain the reason for this change").max(500)});function cs({open:L,onOpenChange:p,feeStructure:C}){const{updateFeeStructure:O}=De(),[A,g]=c.useState(!1),m=ss({resolver:ts(os),defaultValues:{siteVisitBaseFeeCents:C.siteVisitBaseFeeCents/100,complexityMultiplier:C.complexityMultiplier,changeNotes:""}}),_=async r=>{try{g(!0),await O(C.id,{siteVisitBaseFeeCents:Math.round(r.siteVisitBaseFeeCents*100),complexityMultiplier:r.complexityMultiplier,changeNotes:r.changeNotes}),m.reset(),p(!1)}catch{}finally{g(!1)}},R=r=>{switch(r){case"A":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"B":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"C":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"}},D=r=>({coordinator:"Coordinator",dataCollector:"Data Collector",supervisor:"Supervisor"})[r]||r,j=m.watch("siteVisitBaseFeeCents")||0;return e.jsx(_e,{open:L,onOpenChange:p,children:e.jsxs(qe,{className:"sm:max-w-[600px]",children:[e.jsxs(He,{children:[e.jsxs(Ye,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-primary"}),"Edit Fee Structure"]}),e.jsxs(Ze,{children:["Update base fee for"," ",e.jsxs(F,{className:R(C.classificationLevel),children:["Level ",C.classificationLevel]})," ",e.jsx(F,{variant:"outline",children:D(C.roleScope||"")}),". Transport fees come from approved site visits only."]})]}),e.jsx(ls,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(_),className:"space-y-4",children:[e.jsx(Q,{control:m.control,name:"siteVisitBaseFeeCents",render:({field:r})=>e.jsxs(K,{children:[e.jsx(W,{children:"Base Fee (SDG)"}),e.jsx(X,{children:e.jsx(ae,{type:"number",step:"0.01",min:"0",placeholder:"1500.00",...r,"data-testid":"input-base-fee"})}),e.jsx(ee,{children:"Site visit base compensation per classification level. Transport fees are paid separately from approved site visits."}),e.jsx(se,{})]})}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Base Fee:"}),e.jsxs("span",{className:"text-lg font-bold text-primary",children:["SDG ",j.toFixed(2)]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Note: Transport fees are not part of fee structures and come only from approved site visits"})]}),e.jsx(Q,{control:m.control,name:"complexityMultiplier",render:({field:r})=>e.jsxs(K,{children:[e.jsx(W,{children:"Complexity Multiplier"}),e.jsx(X,{children:e.jsx(ae,{type:"number",step:"0.1",min:"1",max:"5",placeholder:"1.0",...r,"data-testid":"input-multiplier"})}),e.jsx(ee,{children:"Applied to base fee for complex assignments (1.0 - 5.0x)"}),e.jsx(se,{})]})}),e.jsx(Q,{control:m.control,name:"changeNotes",render:({field:r})=>e.jsxs(K,{children:[e.jsx(W,{children:"Change Notes *"}),e.jsx(X,{children:e.jsx(is,{placeholder:"Explain the reason for updating this fee structure...",className:"min-h-[80px]",...r,"data-testid":"input-change-notes"})}),e.jsx(ee,{children:"Required: Provide justification for audit trail"}),e.jsx(se,{})]})}),e.jsxs(Je,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:A,"data-testid":"button-cancel",children:"Cancel"}),e.jsxs(N,{type:"submit",disabled:A,"data-testid":"button-save",children:[A&&e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})})]})})}const P=(L,p="SDG")=>new Intl.NumberFormat("en-US",{style:"currency",currency:p==="SDG"?"USD":p,minimumFractionDigits:2,maximumFractionDigits:2}).format(L).replace("$",p==="SDG"?"SDG ":"$"),ks=()=>{const L=ns(),{toast:p}=Qe(),{currentUser:C}=Ke(),{canManageFinances:O,canEditFeeStructures:A}=We(),{feeStructures:g,userClassifications:m,loading:_}=De(),[R,D]=c.useState("fee-structures"),[j,r]=c.useState([]),[q,M]=c.useState(!0),[re,le]=c.useState(null),[Be,ie]=c.useState(null),[ne,H]=c.useState(!1),[d,T]=c.useState(""),[h,E]=c.useState("all"),[u,U]=c.useState("all"),[B,Y]=c.useState(!1),V=O(),Z=A();c.useEffect(()=>{V?(async()=>{if(!V){r([]),M(!1);return}if(m.length===0){r([]),M(!1);return}try{le(null);const t=m.map(f=>f.userId),{data:l,error:x}=await ve.from("profiles").select("id, full_name, email").in("id",t);if(x)throw new Error(`Failed to fetch profiles: ${x.message}`);const{data:o,error:i}=await ve.from("user_roles").select("user_id, role").in("user_id",t);if(i)throw new Error(`Failed to fetch user roles: ${i.message}`);const a=new Map((l==null?void 0:l.map(f=>[f.id,f]))||[]),G=new Map((o==null?void 0:o.map(f=>[f.user_id,f.role]))||[]),me=[];for(const f of m){const k=a.get(f.userId),he=G.get(f.userId);he&&me.push({...f,fullName:(k==null?void 0:k.full_name)||"Unknown User",email:(k==null?void 0:k.email)||"no-email@unknown.com",userRole:he})}r(me)}catch(t){const l=t instanceof Error?t.message:"Failed to load user data";le(l),r([]),p({title:"Error Loading Data",description:l,variant:"destructive"})}finally{M(!1)}})():M(!1)},[m,p,V]);const $=c.useMemo(()=>j.filter(s=>{var o,i;const t=d===""||((o=s.fullName)==null?void 0:o.toLowerCase().includes(d.toLowerCase()))||((i=s.email)==null?void 0:i.toLowerCase().includes(d.toLowerCase())),l=h==="all"||s.classificationLevel===h,x=u==="all"||s.userRole===u;return t&&l&&x}),[j,d,h,u]),I=c.useMemo(()=>g.filter(s=>{var o,i;const t=d===""||((o=s.classificationLevel)==null?void 0:o.toLowerCase().includes(d.toLowerCase()))||((i=s.roleScope)==null?void 0:i.toLowerCase().includes(d.toLowerCase())),l=h==="all"||s.classificationLevel===h,x=u==="all"||s.roleScope===u;return t&&l&&x}),[g,d,h,u]),oe=s=>{switch(s){case"A":return{gradient:"bg-gradient-to-r from-emerald-500 to-teal-500",border:"border-emerald-400/50",glow:"shadow-lg shadow-emerald-500/20",icon:Oe,iconColor:"text-emerald-100"};case"B":return{gradient:"bg-gradient-to-r from-blue-500 to-cyan-500",border:"border-blue-400/50",glow:"shadow-lg shadow-blue-500/20",icon:Pe,iconColor:"text-blue-100"};case"C":return{gradient:"bg-gradient-to-r from-orange-500 to-amber-500",border:"border-orange-400/50",glow:"shadow-lg shadow-orange-500/20",icon:ze,iconColor:"text-orange-100"};default:return{gradient:"bg-gradient-to-r from-gray-500 to-slate-500",border:"border-gray-400/50",glow:"shadow-lg shadow-gray-500/20",icon:J,iconColor:"text-gray-100"}}},ce=({level:s})=>{const t=oe(s),l=t.icon;return e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md border ${t.gradient} ${t.border} ${t.glow} text-white font-semibold text-xs transition-all hover:scale-105`,children:[e.jsx(l,{className:`h-3.5 w-3.5 ${t.iconColor}`}),e.jsx("span",{children:xe(s)})]})},de=s=>({coordinator:"Coordinator",dataCollector:"Data Collector",supervisor:"Supervisor"})[s]||s,xe=s=>{switch(s){case"A":return"Level A (Senior)";case"B":return"Level B (Regular)";case"C":return"Level C (Junior)";default:return s}},n={totalStructures:g.length,totalClassified:j.length,levelACount:j.filter(s=>s.classificationLevel==="A").length,levelBCount:j.filter(s=>s.classificationLevel==="B").length,levelCCount:j.filter(s=>s.classificationLevel==="C").length,withRetainer:j.filter(s=>s.hasRetainer).length,avgBaseFee:g.length>0?g.reduce((s,t)=>s+(t.siteVisitBaseFeeCents||0),0)/g.length/100:0,totalBudget:j.reduce((s,t)=>s+(t.hasRetainer&&t.retainerAmountCents||0),0)/100},ke=()=>{if(R==="fee-structures"){const s=["Level","Role","Base Fee","Multiplier","Total","Currency"],t=I.map(a=>{var G;return[a.classificationLevel,a.roleScope||"",((a.siteVisitBaseFeeCents||0)/100).toString(),((G=a.complexityMultiplier)==null?void 0:G.toString())||"1",((a.siteVisitBaseFeeCents||0)/100).toString(),a.currency||"SDG"]}),l=[s,...t].map(a=>a.join(",")).join(`
`),x=new Blob([l],{type:"text/csv"}),o=window.URL.createObjectURL(x),i=document.createElement("a");i.href=o,i.download=`fee-structures-${new Date().toISOString().split("T")[0]}.csv`,i.click()}else{const s=["Name","Email","Level","Role","Effective From","Retainer","Amount"],t=$.map(a=>[a.fullName||"",a.email||"",a.classificationLevel,a.roleScope||"",a.effectiveFrom?new Date(a.effectiveFrom).toLocaleDateString():"",a.hasRetainer?"Yes":"No",a.hasRetainer?((a.retainerAmountCents||0)/100).toString():"0"]),l=[s,...t].map(a=>a.join(",")).join(`
`),x=new Blob([l],{type:"text/csv"}),o=window.URL.createObjectURL(x),i=document.createElement("a");i.href=o,i.download=`user-classifications-${new Date().toISOString().split("T")[0]}.csv`,i.click()}p({title:"Export Successful",description:"Data has been exported to CSV file"})},Ae=_||q;return V?Ae?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading classifications..."})]})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(J,{className:"h-8 w-8 text-blue-600"}),"Team Classifications"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage user classifications and fee structures"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>Y(!B),"data-testid":"button-toggle-visualization",children:[B?e.jsx(Me,{className:"h-4 w-4 mr-2"}):e.jsx(pe,{className:"h-4 w-4 mr-2"}),B?"Hide":"Show"," Charts"]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:ke,"data-testid":"button-export-csv",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Export"]}),Z&&e.jsxs(N,{size:"sm",onClick:()=>{ie(null),H(!0)},"data-testid":"button-create-fee-structure",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"New Fee Structure"]})]})]}),re?e.jsx("div",{className:"space-y-4",children:e.jsxs(we,{variant:"destructive",children:[e.jsx(ue,{className:"h-5 w-5"}),e.jsxs(Ne,{className:"flex flex-col gap-2",children:[e.jsx("span",{children:re}),e.jsx("button",{onClick:()=>window.location.reload(),className:"text-sm underline hover:no-underline",children:"Retry loading classifications"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(b,{className:"hover-elevate active-elevate-2 cursor-pointer overflow-hidden relative bg-gradient-to-br from-blue-500 to-blue-700 text-white border-0",onClick:()=>{D("fee-structures"),E("all"),U("all"),T("")},"data-testid":"card-fee-structures",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium text-white/90",children:"Fee Structures"}),e.jsx(te,{className:"h-5 w-5 text-white/80"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:n.totalStructures}),e.jsx("p",{className:"text-xs text-white/80 mt-1",children:"Click to view all structures"})]}),e.jsx(z,{className:"absolute -right-4 -bottom-4 h-24 w-24 text-white/10"})]}),e.jsxs(b,{className:"hover-elevate active-elevate-2 cursor-pointer overflow-hidden relative bg-gradient-to-br from-green-500 to-emerald-700 text-white border-0",onClick:()=>{D("user-classifications"),E("all"),U("all"),T("")},"data-testid":"card-classified-users",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium text-white/90",children:"Classified Users"}),e.jsx(fe,{className:"h-5 w-5 text-white/80"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:n.totalClassified}),e.jsxs("p",{className:"text-xs text-white/80 mt-1",children:[n.withRetainer," with retainer"]})]}),e.jsx(z,{className:"absolute -right-4 -bottom-4 h-24 w-24 text-white/10"})]}),e.jsxs(b,{className:"hover-elevate active-elevate-2 cursor-pointer overflow-hidden relative bg-gradient-to-br from-purple-500 to-purple-700 text-white border-0",onClick:()=>Y(!B),"data-testid":"card-level-distribution",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium text-white/90",children:"Level Distribution"}),e.jsx(J,{className:"h-5 w-5 text-white/80"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[e.jsxs(F,{className:"bg-white/20 text-white border-white/30",children:["A: ",n.levelACount]}),e.jsxs(F,{className:"bg-white/20 text-white border-white/30",children:["B: ",n.levelBCount]}),e.jsxs(F,{className:"bg-white/20 text-white border-white/30",children:["C: ",n.levelCCount]})]}),e.jsxs("p",{className:"text-xs text-white/80 mt-2",children:["Click to ",B?"hide":"show"," charts"]})]}),e.jsx(z,{className:"absolute -right-4 -bottom-4 h-24 w-24 text-white/10"})]}),e.jsxs(b,{className:"hover-elevate active-elevate-2 cursor-pointer overflow-hidden relative bg-gradient-to-br from-orange-500 to-red-600 text-white border-0",onClick:()=>{D("fee-structures"),Y(!0)},"data-testid":"card-avg-fee",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium text-white/90",children:"Avg Base Fee"}),e.jsx(Ue,{className:"h-5 w-5 text-white/80"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:P(n.avgBaseFee,"SDG")}),e.jsx("p",{className:"text-xs text-white/80 mt-1",children:"Click to view analytics"})]}),e.jsx(z,{className:"absolute -right-4 -bottom-4 h-24 w-24 text-white/10"})]})]}),B&&e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"Distribution Analytics"]})}),e.jsx(v,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",children:"Level Distribution"}),e.jsx("div",{className:"space-y-3",children:["A","B","C"].map(s=>{const t=s==="A"?n.levelACount:s==="B"?n.levelBCount:n.levelCCount,l=n.totalClassified>0?Math.round(t/n.totalClassified*100):0,x=oe(s),o=x.icon;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:`h-4 w-4 ${s==="A"?"text-emerald-500":s==="B"?"text-blue-500":"text-orange-500"}`}),e.jsx("span",{className:"font-medium",children:xe(s)})]}),e.jsxs("span",{className:"text-muted-foreground",children:[t," (",l,"%)"]})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner",children:e.jsx("div",{className:`h-full ${x.gradient} shadow-lg transition-all duration-500 ease-out`,style:{width:`${l}%`}})})]},s)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",children:"Fee Structure Overview"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"Total Budget (Retainers)"}),e.jsx("span",{className:"font-bold",children:P(n.totalBudget,"SDG")})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"Fee Structures"}),e.jsx("span",{className:"font-bold",children:n.totalStructures})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-sm",children:"Users with Retainer"}),e.jsx("span",{className:"font-bold",children:n.withRetainer})]})]})]})]})})]}),e.jsx(b,{children:e.jsx(v,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ae,{placeholder:"Search by name or email...",value:d,onChange:s=>T(s.target.value),className:"pl-10","data-testid":"input-search-users"})]}),e.jsxs(Ce,{value:h,onValueChange:E,children:[e.jsx(ye,{className:"w-full md:w-[180px]","data-testid":"select-filter-level",children:e.jsx(Se,{placeholder:"Filter by Level"})}),e.jsxs(Fe,{children:[e.jsx(w,{value:"all",children:"All Levels"}),e.jsx(w,{value:"A",children:"Level A (Senior)"}),e.jsx(w,{value:"B",children:"Level B (Regular)"}),e.jsx(w,{value:"C",children:"Level C (Junior)"})]})]}),e.jsxs(Ce,{value:u,onValueChange:U,children:[e.jsx(ye,{className:"w-full md:w-[180px]","data-testid":"select-filter-role",children:e.jsx(Se,{placeholder:"Filter by Role"})}),e.jsxs(Fe,{children:[e.jsx(w,{value:"all",children:"All Roles"}),e.jsx(w,{value:"coordinator",children:"Coordinator"}),e.jsx(w,{value:"dataCollector",children:"Data Collector"}),e.jsx(w,{value:"supervisor",children:"Supervisor"})]})]}),(d||h!=="all"||u!=="all")&&e.jsx(N,{variant:"outline",size:"icon",onClick:()=>{T(""),E("all"),U("all")},"data-testid":"button-clear-filters",children:e.jsx($e,{className:"h-4 w-4"})})]})})}),e.jsxs(Xe,{value:R,onValueChange:D,children:[e.jsxs(es,{className:"grid w-full grid-cols-2",children:[e.jsxs(je,{value:"fee-structures","data-testid":"tab-fee-structures",children:["Fee Structures (",I.length,")"]}),e.jsxs(je,{value:"user-classifications","data-testid":"tab-user-classifications",children:["User Classifications (",$.length,")"]})]}),e.jsx(ge,{value:"fee-structures",className:"space-y-4",children:e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsx(S,{children:"Fee Structures"}),e.jsx(be,{children:"Site visit fee rates for each classification level and role combination"})]}),e.jsx(v,{children:I.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"No Fee Structures Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:h!=="all"||u!=="all"?"Try adjusting your filters":"Create your first fee structure to get started"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-sm",children:"Level"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-sm",children:"Role"}),e.jsx("th",{className:"text-right py-3 px-4 font-semibold text-sm",children:"Base Fee"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-sm",children:"Multiplier"}),Z&&e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-sm",children:"Actions"})]})}),e.jsx("tbody",{children:I.sort((s,t)=>s.classificationLevel!==t.classificationLevel?s.classificationLevel.localeCompare(t.classificationLevel):(s.roleScope||"").localeCompare(t.roleScope||"")).map(s=>e.jsxs("tr",{className:"border-b hover-elevate transition-colors","data-testid":`row-fee-structure-${s.id}`,children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx(ce,{level:s.classificationLevel})}),e.jsx("td",{className:"py-3 px-4 text-sm",children:de(s.roleScope||"")}),e.jsx("td",{className:"py-3 px-4 text-right font-medium text-sm",children:P((s.siteVisitBaseFeeCents||0)/100,s.currency||"SDG")}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs(F,{variant:"outline",children:[s.complexityMultiplier,"x"]})}),Z&&e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>{ie(s),H(!0)},"data-testid":`button-edit-fee-${s.id}`,children:e.jsx(Ie,{className:"h-4 w-4"})})})]},s.id))})]})})})]})}),e.jsx(ge,{value:"user-classifications",className:"space-y-4",children:e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsx(S,{children:"User Classifications"}),e.jsx(be,{children:"Team members with assigned classification levels"})]}),e.jsx(v,{children:$.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2",children:d||h!=="all"||u!=="all"?"No Users Found":"No Classifications Yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:d||h!=="all"||u!=="all"?"Try adjusting your search or filters":"Go to User Management to assign classifications to team members"}),!d&&h==="all"&&u==="all"&&e.jsx(N,{onClick:()=>L("/users"),"data-testid":"button-go-to-users",children:"Go to User Management"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-sm",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-sm",children:"Level"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-sm",children:"Role Scope"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-sm",children:"Effective From"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-sm",children:"Retainer"})]})}),e.jsx("tbody",{children:$.map(s=>e.jsxs("tr",{className:"border-b hover-elevate transition-colors cursor-pointer",onClick:()=>L(`/users/${s.userId}?tab=classification`),"data-testid":`row-user-classification-${s.userId}`,children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.fullName||"Unknown",e.jsx(Ge,{className:"h-3 w-3 text-muted-foreground"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email||"No email"})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(ce,{level:s.classificationLevel})}),e.jsx("td",{className:"py-3 px-4 text-sm",children:de(s.roleScope||"")}),e.jsx("td",{className:"py-3 px-4 text-sm text-muted-foreground",children:s.effectiveFrom?new Date(s.effectiveFrom).toLocaleDateString():"Not set"}),e.jsx("td",{className:"py-3 px-4 text-center",children:s.hasRetainer?e.jsxs(F,{variant:"outline",className:"bg-green-50 text-green-700 dark:bg-green-900 dark:text-green-200",children:[P((s.retainerAmountCents||0)/100,s.retainerCurrency||"SDG"),"/",s.retainerFrequency||"month"]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No retainer"})})]},s.id))})]})})})]})})]})]}),ne&&e.jsx(cs,{open:ne,onOpenChange:H,feeStructure:Be})]}):e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs(we,{variant:"destructive",children:[e.jsx(ue,{className:"h-5 w-5"}),e.jsx(Ne,{children:"Access Denied: You do not have permission to view classifications. This page is restricted to administrators and financial admins."})]})})};export{ks as default};
