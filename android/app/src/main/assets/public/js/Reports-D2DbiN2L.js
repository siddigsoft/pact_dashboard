var Ee=Object.defineProperty;var $e=(c,i,o)=>i in c?Ee(c,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[i]=o;var $=(c,i,o)=>$e(c,typeof i!="symbol"?i+"":i,o);import{r as j,j as e,ah as ze,bm as he,aM as Be,aA as Ke,I as Ce,aG as ee,bn as te,Z as Se}from"./react-core-B8kFjp2k.js";import{u as Ye,Z as Ie,C as L,f as O,g as U,h as W,b as H,a as _,T as Le,i as Oe,j as ue,k as pe,L as se,M as ae,N as ie,O as T,s as R}from"./index-PwDgWEVM.js";import{T as Pe,a as Ne,b as re,c as S,d as Me,e as P,f as Fe}from"./table-CZ8ZB6wW.js";import{D as De}from"./date-range-picker-sQlSgQMW.js";import{u as ge,w as Ue}from"./xlsx-CBxwqXDA.js";import{h as We,b as He}from"./docs-D2Yi4cpO.js";import{E as Ge,a as Qe}from"./jspdf-rld7HkB6.js";import{o as x,a as fe,N as xe}from"./date-utils-YarVESQS.js";import{f as Te,g as Xe,h as Ze,i as qe,j as Je,k as et,l as tt,p as st,m as at,n as it,A as rt,o as ot,q as nt}from"./charts-B79l2W3h.js";import{bo as lt}from"./vendor-VlxgVHMv.js";import"./react-dom-BLwj5vIO.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";import"./calendar-DEyRSxJX.js";import"./popover-BSK_FA51.js";class oe{constructor(){$(this,"doc");$(this,"pageHeight");$(this,"pageWidth");$(this,"margin",20);$(this,"currentY",20);this.doc=new Ge,this.pageHeight=this.doc.internal.pageSize.height,this.pageWidth=this.doc.internal.pageSize.width}addHeader(i,o,l){if(this.doc.setFontSize(10),this.doc.setTextColor(100),this.doc.text("TPM Workflow System",this.margin,this.currentY),this.doc.text(`Generated: ${x(new Date,"PPP")}`,this.pageWidth-this.margin-60,this.currentY),this.currentY+=15,this.doc.setFontSize(20),this.doc.setTextColor(0),this.doc.setFont("helvetica","bold"),this.doc.text(i,this.margin,this.currentY),this.currentY+=10,o&&(this.doc.setFontSize(14),this.doc.setFont("helvetica","normal"),this.doc.setTextColor(60),this.doc.text(o,this.margin,this.currentY),this.currentY+=8),l!=null&&l.from||l!=null&&l.to){this.doc.setFontSize(12),this.doc.setTextColor(80);let a="Report Period: ";l.from&&l.to?a+=`${x(l.from,"MMM dd, yyyy")} - ${x(l.to,"MMM dd, yyyy")}`:l.from?a+=`From ${x(l.from,"MMM dd, yyyy")}`:l.to&&(a+=`Until ${x(l.to,"MMM dd, yyyy")}`),this.doc.text(a,this.margin,this.currentY),this.currentY+=15}this.doc.setDrawColor(200),this.doc.line(this.margin,this.currentY,this.pageWidth-this.margin,this.currentY),this.currentY+=10}addSummarySection(i){this.doc.setFontSize(14),this.doc.setFont("helvetica","bold"),this.doc.setTextColor(0),this.doc.text("Summary",this.margin,this.currentY),this.currentY+=10;const o=(this.pageWidth-2*this.margin-20)/Math.min(i.length,3),l=25;i.forEach((a,h)=>{const g=this.margin+h%3*(o+10),r=this.currentY+Math.floor(h/3)*(l+10);this.doc.setFillColor(240,248,255),this.doc.rect(g,r,o,l,"F"),this.doc.setDrawColor(200),this.doc.rect(g,r,o,l,"S"),this.doc.setFontSize(10),this.doc.setTextColor(60),this.doc.text(a.label,g+5,r+8),this.doc.setFontSize(14),this.doc.setFont("helvetica","bold"),this.doc.setTextColor(0),this.doc.text(String(a.value),g+5,r+18)}),this.currentY+=Math.ceil(i.length/3)*(l+10)+10}async addChart(i){try{const o=await We(i,{backgroundColor:"white",scale:2}),l=o.toDataURL("image/png"),a=this.pageWidth-2*this.margin,h=o.height*a/o.width;this.currentY+h>this.pageHeight-this.margin&&(this.doc.addPage(),this.currentY=this.margin),this.doc.addImage(l,"PNG",this.margin,this.currentY,a,h),this.currentY+=h+10}catch{}}addTable(i,o){const l=i.map(a=>o.map(h=>a[h.dataKey]||""));Qe(this.doc,{head:[o.map(a=>a.header)],body:l,startY:this.currentY,margin:{left:this.margin,right:this.margin},styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},didDrawPage:a=>{var h,g;this.doc.setFontSize(8),this.doc.setTextColor(100);try{const r=(g=(h=this.doc).getCurrentPageInfo)==null?void 0:g.call(h),y=(r==null?void 0:r.pageNumber)??this.doc.getNumberOfPages();this.doc.text(`Page ${y}`,this.pageWidth-this.margin-20,this.pageHeight-10)}catch{}}}),this.currentY=this.doc.lastAutoTable.finalY+10}addFooter(){const i=this.doc.getNumberOfPages();for(let o=1;o<=i;o++)this.doc.setPage(o),this.doc.setDrawColor(200),this.doc.line(this.margin,this.pageHeight-20,this.pageWidth-this.margin,this.pageHeight-20),this.doc.setFontSize(8),this.doc.setTextColor(100),this.doc.text("TPM Workflow System - Confidential Report",this.margin,this.pageHeight-10)}async generateReport(i){this.addHeader(i.title,i.subtitle,i.dateRange),i.summary&&i.summary.length>0&&this.addSummarySection(i.summary),i.chartElement&&(this.doc.setFontSize(14),this.doc.setFont("helvetica","bold"),this.doc.text("Visual Analysis",this.margin,this.currentY),this.currentY+=10,await this.addChart(i.chartElement)),i.data.length>0&&(this.doc.setFontSize(14),this.doc.setFont("helvetica","bold"),this.doc.text("Detailed Data",this.margin,this.currentY),this.currentY+=10,this.addTable(i.data,i.columns)),this.addFooter()}download(i){this.doc.save(i)}getBlob(){return this.doc.output("blob")}}const ct=async(c,i,o)=>{const l=new oe,a=c.filter(p=>(p.Status??p.status)==="completed").length,h=c.filter(p=>(p.Status??p.status)==="pending").length,g=c.reduce((p,f)=>p+(Number(f["Total Fee"])||0),0),r=[{label:"Total Visits",value:c.length},{label:"Completed",value:a},{label:"Pending",value:h},{label:"Total Fees",value:`$${g.toLocaleString()}`}],y=[{header:"Site Name",dataKey:"Site Name"},{header:"Site Code",dataKey:"Site Code"},{header:"State",dataKey:"State"},{header:"Locality",dataKey:"Locality"},{header:"Activity",dataKey:"Activity"},{header:"Main Activity",dataKey:"Main Activity"},{header:"Visit Type",dataKey:"Visit Type"},{header:"Due Date",dataKey:"Due Date"},{header:"Status",dataKey:"Status"},{header:"Total Fee",dataKey:"Total Fee"},{header:"Currency",dataKey:"Currency"}];await l.generateReport({title:"Site Visits Report",subtitle:"Comprehensive analysis of site visit activities and performance",dateRange:i,data:c,columns:y,summary:r,chartElement:o});const v=`site_visits_report_${x(new Date,"yyyy-MM-dd")}.pdf`;l.download(v)},dt=async(c,i,o)=>{const l=new oe,a=c.reduce((p,f)=>p+(f["Budget Total"]||0),0),h=c.reduce((p,f)=>p+(f["Budget Allocated"]||0),0),g=c.reduce((p,f)=>p+(f["Budget Remaining"]||0),0),r=[{label:"Total Projects",value:c.length},{label:"Total Budget",value:`$${a.toLocaleString()}`},{label:"Allocated",value:`$${h.toLocaleString()}`},{label:"Remaining",value:`$${g.toLocaleString()}`}],y=[{header:"Project Name",dataKey:"Project Name"},{header:"Project Code",dataKey:"Project Code"},{header:"Status",dataKey:"Status"},{header:"Budget Total",dataKey:"Budget Total"},{header:"Budget Allocated",dataKey:"Budget Allocated"},{header:"Budget Remaining",dataKey:"Budget Remaining"},{header:"Currency",dataKey:"Currency"},{header:"Updated At",dataKey:"Updated At"}];await l.generateReport({title:"Project Budget Report",subtitle:"Financial overview and budget allocation analysis",dateRange:i,data:c,columns:y,summary:r,chartElement:o});const v=`project_budget_report_${x(new Date,"yyyy-MM-dd")}.pdf`;l.download(v)},mt=async(c,i,o)=>{const l=new oe,a=c.reduce((p,f)=>p+(f.Entries||0),0),h=c.reduce((p,f)=>p+(f["Processed Entries"]||0),0),g=a>0?Math.round(h/a*100):0,r=[{label:"Total MMP Files",value:c.length},{label:"Total Entries",value:a},{label:"Processed",value:h},{label:"Completion Rate",value:`${g}%`}],y=[{header:"Name",dataKey:"Name"},{header:"Status",dataKey:"Status"},{header:"Entries",dataKey:"Entries"},{header:"Processed Entries",dataKey:"Processed Entries"},{header:"MMP ID",dataKey:"MMP ID"},{header:"Uploaded At",dataKey:"Uploaded At"}];await l.generateReport({title:"MMP Implementation Progress Report",subtitle:"Monitoring and evaluation of MMP implementation activities",dateRange:i,data:c,columns:y,summary:r,chartElement:o});const v=`mmp_progress_report_${x(new Date,"yyyy-MM-dd")}.pdf`;l.download(v)},ht=async(c,i,o)=>{const l=new oe,a=c.reduce((p,f)=>p+(f["Assigned Visits"]||0),0),h=c.reduce((p,f)=>p+(f["Completed Visits"]||0),0),g=c.length>0?Math.round(h/a*100):0,r=[{label:"Team Members",value:c.length},{label:"Total Assigned",value:a},{label:"Total Completed",value:h},{label:"Avg Completion",value:`${g}%`}],y=[{header:"User",dataKey:"User"},{header:"Role",dataKey:"Role"},{header:"Assigned Visits",dataKey:"Assigned Visits"},{header:"Completed Visits",dataKey:"Completed Visits"},{header:"Pending/Active",dataKey:"Pending/Active"}];await l.generateReport({title:"Team Performance Report",subtitle:"Analysis of team productivity and task completion rates",dateRange:i,data:c,columns:y,summary:r,chartElement:o});const v=`team_performance_report_${x(new Date,"yyyy-MM-dd")}.pdf`;l.download(v)};qe.register(Je,et,tt,st,at,it,rt,ot,nt);const be=({type:c,data:i,options:o={},onChartReady:l,title:a})=>{const h=j.useRef(null);j.useEffect(()=>{if(h.current&&l){const y=h.current.canvas;y&&setTimeout(()=>l(y),100)}},[l,i]);const g={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!!a,text:a,font:{size:16,weight:"bold"}}},...o},r=()=>{switch(c){case"bar":return e.jsx(Te,{ref:h,data:i,options:g});case"pie":return e.jsx(Ze,{ref:h,data:i,options:g});case"line":return e.jsx(Xe,{ref:h,data:i,options:g});default:return e.jsx(Te,{ref:h,data:i,options:g})}};return e.jsx("div",{className:"w-full h-64 mb-4",children:r()})},ut=c=>{const i=c.reduce((o,l)=>{const a=l.Status||l.status||"unknown";return o[a]=(o[a]||0)+1,o},{});return{labels:Object.keys(i),datasets:[{label:"Site Visits by Status",data:Object.values(i),backgroundColor:["rgba(54, 162, 235, 0.8)","rgba(255, 99, 132, 0.8)","rgba(255, 205, 86, 0.8)","rgba(75, 192, 192, 0.8)","rgba(153, 102, 255, 0.8)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 99, 132, 1)","rgba(255, 205, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)"],borderWidth:1}]}},pt=c=>{const i=c.slice(0,10).map(a=>a["Project Name"]||a.name||"Unknown"),o=c.slice(0,10).map(a=>{var h;return a["Budget Total"]||((h=a.budget)==null?void 0:h.total)||0}),l=c.slice(0,10).map(a=>{var h;return a["Budget Allocated"]||((h=a.budget)==null?void 0:h.allocated)||0});return{labels:i,datasets:[{label:"Total Budget",data:o,backgroundColor:"rgba(54, 162, 235, 0.8)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1},{label:"Allocated Budget",data:l,backgroundColor:"rgba(255, 99, 132, 0.8)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]}},gt=c=>{const i=c.slice(0,10).map(a=>a.Name||a.name||"Unknown"),o=c.slice(0,10).map(a=>a.Entries||a.entries||0),l=c.slice(0,10).map(a=>a["Processed Entries"]||a.processed_entries||0);return{labels:i,datasets:[{label:"Total Entries",data:o,backgroundColor:"rgba(75, 192, 192, 0.8)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1},{label:"Processed Entries",data:l,backgroundColor:"rgba(153, 102, 255, 0.8)",borderColor:"rgba(153, 102, 255, 1)",borderWidth:1}]}},ft=c=>{const i=c.map(a=>a.User||a.user||"Unknown"),o=c.map(a=>a["Assigned Visits"]||a.assigned||0),l=c.map(a=>a["Completed Visits"]||a.completed||0);return{labels:i,datasets:[{label:"Assigned Visits",data:o,backgroundColor:"rgba(255, 205, 86, 0.8)",borderColor:"rgba(255, 205, 86, 1)",borderWidth:1},{label:"Completed Visits",data:l,backgroundColor:"rgba(54, 162, 235, 0.8)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]}},zt=()=>{const[c,i]=j.useState("financial"),{toast:o}=Ye(),l=lt(),{checkPermission:a,hasAnyRole:h}=Ie();if(!(a("reports","read")||h(["admin"])))return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs(L,{className:"w-full max-w-md",children:[e.jsxs(O,{children:[e.jsx(U,{className:"text-destructive",children:"Access Denied"}),e.jsx(W,{children:"You don't have permission to access this page."})]}),e.jsx(H,{children:e.jsx(_,{variant:"outline",onClick:()=>l("/dashboard"),className:"w-full",children:"Return to Dashboard"})})]})});const[r,y]=j.useState(void 0),[v,p]=j.useState(!1),[f,G]=j.useState(null),[A,z]=j.useState([]),[Q,B]=j.useState([]),[ye,K]=j.useState([]),[Re,Y]=j.useState([]),[X,ne]=j.useState(null),[V,je]=j.useState(!1),[D,E]=j.useState(!1),ke=()=>{l("/dashboard")};j.useEffect(()=>{(async()=>{try{p(!0),G(null);let t=R.from("mmp_site_entries").select("*"),n=R.from("mmp_files").select("*"),d=R.from("projects").select("*"),m=R.from("profiles").select("id, full_name, role, email");if(r!=null&&r.from){const k=fe(r.from).toISOString();t=t.gte("visit_date",k),n=n.gte("created_at",k),d=d.gte("created_at",k)}if(r!=null&&r.to){const k=xe(r.to).toISOString();t=t.lte("visit_date",k),n=n.lte("created_at",k),d=d.lte("created_at",k)}t=t.order("visit_date",{ascending:!1}),n=n.order("created_at",{ascending:!1}),d=d.order("created_at",{ascending:!1});const[u,b,F,w]=await Promise.all([t,n,d,m]);if(u.error)throw u.error;if(b.error)throw b.error;if(F.error)throw F.error;if(w.error)throw w.error;z(u.data||[]),B(b.data||[]),K(F.data||[]),Y(w.data||[])}catch(t){G((t==null?void 0:t.message)||"Failed to load reports data")}finally{p(!1)}})()},[r]);const Z=async()=>{try{p(!0),G(null);let s=R.from("mmp_site_entries").select("*"),t=R.from("mmp_files").select("*"),n=R.from("projects").select("*"),d=R.from("profiles").select("id, full_name, role, email");if(r!=null&&r.from){const w=fe(r.from).toISOString();s=s.gte("due_date",w),t=t.gte("created_at",w),n=n.gte("created_at",w)}if(r!=null&&r.to){const w=xe(r.to).toISOString();s=s.lte("due_date",w),t=t.lte("created_at",w),n=n.lte("created_at",w)}s=s.order("due_date",{ascending:!1}),t=t.order("created_at",{ascending:!1}),n=n.order("created_at",{ascending:!1});const[m,u,b,F]=await Promise.all([s,t,n,d]);if(m.error)throw m.error;if(u.error)throw u.error;if(b.error)throw b.error;if(F.error)throw F.error;return{siteVisits:m.data||[],mmpFiles:u.data||[],projects:b.data||[],profiles:F.data||[]}}catch(s){throw G((s==null?void 0:s.message)||"Failed to load reports data"),s}finally{p(!1)}},_e=j.useMemo(()=>{const s=new Date().toISOString();return[{id:"financial_site_visits_fees",name:"Site Visits Fees Summary",date:s,type:"Financial",format:"Excel",size:"-"},{id:"financial_project_budget",name:"Project Budget Summary",date:s,type:"Financial",format:"Excel",size:"-"},{id:"operational_site_visits",name:"Site Visits Performance",date:s,type:"Operational",format:"Excel",size:"-"},{id:"operational_mmp_progress",name:"MMP Implementation Progress",date:s,type:"Operational",format:"Excel",size:"-"}]},[ye,A,Q]),Ae=[{id:"t1",name:"Financial Summary",description:"Overview of financial transactions and budget status",category:"Financial"},{id:"t2",name:"Site Visit Status",description:"Summary of all site visits and their completion status",category:"Operations"},{id:"t3",name:"Team Performance",description:"Analysis of field team performance metrics",category:"Management"},{id:"t4",name:"MMP Implementation",description:"Progress report on MMP implementation stages",category:"Operations"}],le=s=>{if(!s||!(r!=null&&r.from)&&!(r!=null&&r.to))return!0;const t=new Date(s),n=r!=null&&r.from?fe(r.from):void 0,d=r!=null&&r.to?xe(r.to):void 0;return!(n&&t<n||d&&t>d)},C=(s,t)=>{const n=ge.json_to_sheet(s),d=ge.book_new();ge.book_append_sheet(d,n,"Report");const m=Ue(d,{bookType:"xlsx",type:"array"}),u=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=`${t}_${x(new Date,"yyyy-MM-dd")}.xlsx`;He.saveAs(u,b)},N=async(s,t,n)=>{const d=r?{from:r.from,to:r.to}:void 0;switch(t){case"site_visits":await ct(s,d,X||void 0);break;case"project_budget":await dt(s,d,X||void 0);break;case"mmp_progress":await mt(s,d,X||void 0);break;case"team_performance":await ht(s,d,X||void 0);break}},M=s=>s.filter(t=>le(t.due_date||t.created_at)).map(t=>{var n,d,m;return{"Site Name":t.site_name||"","Site Code":t.site_code||"",State:t.state||"",Locality:t.locality||"",Activity:t.activity||"","Main Activity":t.main_activity||"","Visit Type":((n=t.visit_data)==null?void 0:n.visitType)||"","Due Date":t.due_date?x(new Date(t.due_date),"yyyy-MM-dd"):"",Status:t.status||"","Total Fee":((d=t.fees)==null?void 0:d.total)??"",Currency:((m=t.fees)==null?void 0:m.currency)||""}}),ce=s=>s.filter(t=>le(t.updated_at||t.created_at)).map(t=>{var n,d,m,u;return{"Project Name":t.name||"","Project Code":t.project_code||"",Status:t.status||"","Budget Total":((n=t.budget)==null?void 0:n.total)??"","Budget Allocated":((d=t.budget)==null?void 0:d.allocated)??"","Budget Remaining":((m=t.budget)==null?void 0:m.remaining)??"",Currency:((u=t.budget)==null?void 0:u.currency)||"","Updated At":t.updated_at?x(new Date(t.updated_at),"yyyy-MM-dd"):t.created_at?x(new Date(t.created_at),"yyyy-MM-dd"):""}}),I=s=>s.filter(t=>le(t.uploaded_at||t.created_at)).map(t=>({Name:t.name||"",Status:t.status||"",Entries:t.entries??"","Processed Entries":t.processed_entries??"","MMP ID":t.mmp_id||"","Uploaded At":t.uploaded_at?x(new Date(t.uploaded_at),"yyyy-MM-dd"):t.created_at?x(new Date(t.created_at),"yyyy-MM-dd"):""})),de=(s,t)=>{const n={},d={};return t.forEach(m=>{d[m.id]={name:m.full_name||m.email||m.id,role:m.role||""}}),s.forEach(m=>{const u=m.assigned_to;if(u){if(!n[u]){const b=d[u]||{name:u,role:""};n[u]={user:b.name,role:b.role,assigned:0,completed:0,pending:0}}n[u].assigned+=1,m.status==="completed"?n[u].completed+=1:n[u].pending+=1}}),Object.values(n).map(m=>({User:m.user,Role:m.role,"Assigned Visits":m.assigned,"Completed Visits":m.completed,"Pending/Active":m.pending}))},we=async s=>{try{E(!0);const t=await Z(),n=t.siteVisits,d=t.mmpFiles,m=t.projects,u=t.profiles;switch(z(n),B(d),K(m),Y(u),s.id){case"financial_site_visits_fees":C(M(n),"site_visits_fees_summary");break;case"financial_project_budget":C(ce(m),"project_budget_summary");break;case"operational_site_visits":C(M(n),"site_visits_performance");break;case"operational_mmp_progress":C(I(d),"mmp_implementation_progress");break;default:C([],"report")}const b=`${s.name.toLowerCase().replace(/\s+/g,"_")}_${x(new Date(s.date),"yyyy-MM-dd")}.xlsx`;o({title:"Report Downloaded",description:`${s.name} has been downloaded as ${b}`})}catch(t){o({title:"Export failed",description:(t==null?void 0:t.message)||"Unable to generate the report",variant:"destructive"})}finally{E(!1)}},ve=async s=>{try{E(!0);const t=await Z(),n=t.siteVisits,d=t.mmpFiles,m=t.projects,u=t.profiles;switch(z(n),B(d),K(m),Y(u),s.id){case"financial_site_visits_fees":await N(M(n),"site_visits","site_visits_fees_summary");break;case"financial_project_budget":await N(ce(m),"project_budget","project_budget_summary");break;case"operational_site_visits":await N(M(n),"site_visits","site_visits_performance");break;case"operational_mmp_progress":await N(I(d),"mmp_progress","mmp_implementation_progress");break;default:await N([],"site_visits","report")}o({title:"PDF Report Generated",description:`${s.name} has been downloaded as PDF`})}catch(t){o({title:"PDF Export failed",description:(t==null?void 0:t.message)||"Unable to generate the PDF report",variant:"destructive"})}finally{E(!1)}},q=async s=>{try{E(!0);const t=await Z(),n=t.siteVisits,d=t.mmpFiles,m=t.projects,u=t.profiles;z(n),B(d),K(m),Y(u),s==="Financial Summary"?C(M(n),"financial_summary"):s==="Site Visit Report"?C(M(n),"site_visit_report"):s==="Team Performance Report"?C(de(n,u),"team_performance_report"):s==="MMP Implementation Report"?C(I(d),"mmp_implementation_report"):C([],s.toLowerCase().replace(/\s+/g,"_"));const b=x(new Date,"yyyy-MM-dd"),F=`${s.toLowerCase().replace(/\s+/g,"_")}_${b}.xlsx`;o({title:"Report Generated",description:`${s} report has been generated as ${F}`})}catch(t){o({title:"Export failed",description:(t==null?void 0:t.message)||"Unable to generate the report",variant:"destructive"})}},J=async s=>{try{E(!0);const t=await Z(),n=t.siteVisits,d=t.mmpFiles,m=t.projects,u=t.profiles;z(n),B(d),K(m),Y(u),s==="Financial Summary"?await N(M(n),"site_visits","financial_summary"):s==="Site Visit Report"?await N(M(n),"site_visits","site_visit_report"):s==="Team Performance Report"?await N(de(n,u),"team_performance","team_performance_report"):s==="MMP Implementation Report"&&await N(I(d),"mmp_progress","mmp_implementation_report"),o({title:"PDF Report Generated",description:`${s} report has been generated as PDF`})}catch(t){o({title:"PDF Export failed",description:(t==null?void 0:t.message)||"Unable to generate the PDF report",variant:"destructive"})}},Ve=s=>{o({title:"Template Selected",description:`${s.name} template is ready to use`})},me=s=>{switch(s){case"site_visits":return ut(M(A));case"project_budget":return pt(ce(ye));case"mmp_progress":return gt(I(Q));case"team_performance":return ft(de(A,Re));default:return null}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center mb-6",children:e.jsxs(_,{variant:"outline",size:"sm",className:"mr-4",onClick:ke,children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg shadow-sm border animate-fade-in",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"Reports"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Generate, view, and manage reports across all system operations"})]}),e.jsxs(Le,{value:c,onValueChange:i,className:"w-full",children:[e.jsxs(Oe,{className:"grid w-full grid-cols-1 md:grid-cols-3 gap-2 p-1 h-auto",children:[e.jsx(ue,{value:"financial",className:"py-2 data-[state=active]:bg-blue-50",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:"Financial Reports"})]})}),e.jsx(ue,{value:"operational",className:"py-2 data-[state=active]:bg-blue-50",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{children:"Operational Reports"})]})}),e.jsx(ue,{value:"templates",className:"py-2 data-[state=active]:bg-blue-50",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Report Templates"})]})})]}),e.jsx(pe,{value:"financial",className:"mt-4",children:e.jsxs(L,{children:[e.jsxs(O,{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Financial Reports"}),e.jsx(W,{children:"View and download financial reports and analyses"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(_,{className:"flex items-center gap-2",disabled:D,children:[e.jsx(Ce,{className:"h-4 w-4"}),"Generate Excel",e.jsx(ee,{className:"h-4 w-4"})]})}),e.jsx(ie,{align:"end",children:e.jsx(T,{onClick:()=>q("Financial Summary"),children:"Financial Summary"})})]}),e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(_,{className:"flex items-center gap-2",disabled:D,variant:"outline",children:[e.jsx(te,{className:"h-4 w-4"}),"Generate PDF",e.jsx(ee,{className:"h-4 w-4"})]})}),e.jsx(ie,{align:"end",children:e.jsx(T,{onClick:()=>J("Financial Summary"),children:"Financial Summary PDF"})})]}),e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>je(!V),className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),V?"Hide":"Show"," Chart"]}),e.jsx("div",{className:"w-[250px]",children:e.jsx(De,{dateRange:r,onDateRangeChange:y})})]})]}),e.jsxs(H,{children:[f&&e.jsx("div",{className:"text-sm text-red-600 mb-3",children:f}),v&&e.jsx("div",{className:"text-sm text-muted-foreground mb-3",children:"Loading data..."}),V&&A.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Site Visits Overview"}),e.jsx(be,{type:"pie",data:me("site_visits"),title:"Site Visits by Status",onChartReady:s=>ne(s)})]}),e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(Pe,{children:[e.jsx(Ne,{children:e.jsxs(re,{children:[e.jsx(S,{children:"Report Name"}),e.jsx(S,{children:"Date"}),e.jsx(S,{children:"Format"}),e.jsx(S,{children:"Size"}),e.jsx(S,{className:"text-right",children:"Actions"})]})}),e.jsx(Me,{children:_e.filter(s=>s.type==="Financial").map(s=>e.jsxs(re,{children:[e.jsx(P,{className:"font-medium",children:s.name}),e.jsx(P,{children:new Date(s.date).toLocaleDateString()}),e.jsx(P,{children:s.format}),e.jsx(P,{children:s.size}),e.jsx(P,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(_,{variant:"ghost",size:"sm",disabled:D,onClick:()=>we(s),children:[e.jsx(Se,{className:"h-4 w-4 mr-1"})," Excel"]}),e.jsxs(_,{variant:"ghost",size:"sm",disabled:D,onClick:()=>ve(s),children:[e.jsx(te,{className:"h-4 w-4 mr-1"})," PDF"]})]})})]},s.id))}),e.jsx(Fe,{children:"A list of your recent financial reports."})]})})]})]})}),e.jsx(pe,{value:"operational",className:"mt-4",children:e.jsxs(L,{children:[e.jsxs(O,{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Operational Reports"}),e.jsx(W,{children:"View and manage operational metrics and performance"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(_,{className:"flex items-center gap-2",disabled:D,children:[e.jsx(Ce,{className:"h-4 w-4"}),"Generate Excel",e.jsx(ee,{className:"h-4 w-4"})]})}),e.jsxs(ie,{align:"end",children:[e.jsx(T,{onClick:()=>q("Site Visit Report"),children:"Site Visit Report"}),e.jsx(T,{onClick:()=>q("Team Performance Report"),children:"Team Performance Report"}),e.jsx(T,{onClick:()=>q("MMP Implementation Report"),children:"MMP Implementation Report"})]})]}),e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(_,{className:"flex items-center gap-2",disabled:D,variant:"outline",children:[e.jsx(te,{className:"h-4 w-4"}),"Generate PDF",e.jsx(ee,{className:"h-4 w-4"})]})}),e.jsxs(ie,{align:"end",children:[e.jsx(T,{onClick:()=>J("Site Visit Report"),children:"Site Visit Report PDF"}),e.jsx(T,{onClick:()=>J("Team Performance Report"),children:"Team Performance PDF"}),e.jsx(T,{onClick:()=>J("MMP Implementation Report"),children:"MMP Implementation PDF"})]})]}),e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>je(!V),className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),V?"Hide":"Show"," Chart"]}),e.jsx("div",{className:"w-[250px]",children:e.jsx(De,{dateRange:r,onDateRangeChange:y})})]})]}),e.jsxs(H,{children:[f&&e.jsx("div",{className:"text-sm text-red-600 mb-3",children:f}),v&&e.jsx("div",{className:"text-sm text-muted-foreground mb-3",children:"Loading data..."}),V&&(A.length>0||Q.length>0)&&e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[A.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Site Visits Performance"}),e.jsx(be,{type:"bar",data:me("site_visits"),title:"Site Visits by Status",onChartReady:s=>ne(s)})]}),Q.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"MMP Progress"}),e.jsx(be,{type:"bar",data:me("mmp_progress"),title:"MMP Implementation Progress",onChartReady:s=>ne(s)})]})]}),e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(Pe,{children:[e.jsx(Ne,{children:e.jsxs(re,{children:[e.jsx(S,{children:"Report Name"}),e.jsx(S,{children:"Date"}),e.jsx(S,{children:"Format"}),e.jsx(S,{children:"Size"}),e.jsx(S,{className:"text-right",children:"Actions"})]})}),e.jsx(Me,{children:_e.filter(s=>s.type!=="Financial").map(s=>e.jsxs(re,{children:[e.jsx(P,{className:"font-medium",children:s.name}),e.jsx(P,{children:new Date(s.date).toLocaleDateString()}),e.jsx(P,{children:s.format}),e.jsx(P,{children:s.size}),e.jsx(P,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(_,{variant:"ghost",size:"sm",disabled:D,onClick:()=>we(s),children:[e.jsx(Se,{className:"h-4 w-4 mr-1"})," Excel"]}),e.jsxs(_,{variant:"ghost",size:"sm",disabled:D,onClick:()=>ve(s),children:[e.jsx(te,{className:"h-4 w-4 mr-1"})," PDF"]})]})})]},s.id))}),e.jsx(Fe,{children:"A list of your recent operational reports."})]})})]})]})}),e.jsx(pe,{value:"templates",className:"mt-4",children:e.jsxs(L,{children:[e.jsxs(O,{children:[e.jsx(U,{children:"Report Templates"}),e.jsx(W,{children:"Standard report templates for generating consistent reports"})]}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Ae.map(s=>e.jsxs(L,{className:"overflow-hidden hover:border-primary transition-colors",children:[e.jsxs(O,{className:"bg-slate-50 pb-2",children:[e.jsx(U,{className:"text-base",children:s.name}),e.jsx(W,{className:"text-xs",children:s.category})]}),e.jsxs(H,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:s.description}),e.jsx("div",{className:"flex justify-end",children:e.jsx(_,{variant:"outline",size:"sm",onClick:()=>Ve(s),children:"Use Template"})})]})]},s.id))})})]})})]})]})};export{zt as default};
