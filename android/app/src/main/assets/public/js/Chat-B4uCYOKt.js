import{r as n,j as e,v as h,b5 as S,M as E,a3 as j,U as M,b6 as T,l as A}from"./react-core-B8kFjp2k.js";import{v as D,E as U,I as N,D as z,$ as L,a as I,l as $,m as F,n as P,o as V,S as g,A as O,e as k,a5 as q,u as Q,q as W}from"./index-PwDgWEVM.js";import{L as B}from"./date-utils-YarVESQS.js";import{C as H}from"./ChatWindow-BJzXkqLX.js";import{bo as R}from"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";import"./textarea-BpQMf5eL.js";const Y=({chat:t,isActive:r,onClick:i})=>{var l,a;return e.jsx("div",{className:`p-3 rounded-md cursor-pointer transition-colors ${r?"bg-primary/10 border-l-4 border-primary":"hover:bg-muted"}`,onClick:i,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.type==="private"?e.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center text-primary",children:t.name.charAt(0).toUpperCase()}):t.type==="state-group"?e.jsx("div",{className:"w-10 h-10 bg-green-500/20 rounded-full flex items-center justify-center text-green-500",children:e.jsx(j,{size:18})}):e.jsx("div",{className:"w-10 h-10 bg-secondary/20 rounded-full flex items-center justify-center text-secondary",children:e.jsx(M,{size:18})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:`font-medium text-sm ${t.unreadCount>0?"text-foreground font-semibold":"text-muted-foreground"}`,children:t.name}),t.unreadCount>0&&e.jsx("span",{className:"bg-primary text-white text-xs rounded-full px-2 py-0.5 ml-2",children:t.unreadCount})]}),t.relatedEntityType&&e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground mt-1",children:[t.relatedEntityType==="mmpFile"&&e.jsx(T,{size:12,className:"mr-1"}),t.relatedEntityType==="siteVisit"&&e.jsx(j,{size:12,className:"mr-1"}),t.relatedEntityType==="project"&&e.jsx(A,{size:12,className:"mr-1"}),e.jsxs("span",{children:[t.relatedEntityType==="mmpFile"&&"MMP File",t.relatedEntityType==="siteVisit"&&"Site Visit",t.relatedEntityType==="project"&&"Project"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate max-w-[200px]",children:((l=t.lastMessage)==null?void 0:l.content)||(t.type==="private"?"Start a conversation":`${t.participants.length} participants`)})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-nowrap",children:B(new Date(((a=t.lastMessage)==null?void 0:a.timestamp)||t.createdAt),{addSuffix:!0,includeSeconds:!0})})]})})},G=()=>{const{chats:t,activeChat:r,setActiveChat:i,createChat:l}=D(),[a,v]=n.useState(""),[y,c]=n.useState(!1),[o,m]=n.useState(""),{currentUser:d,users:w}=U(),x=w.filter(s=>s.id!==(d==null?void 0:d.id)),u=o?x.filter(s=>(s.fullName||s.name||s.username||"").toLowerCase().includes(o.toLowerCase())):x,b=async(s,C)=>{const f=await l([s],C,"private");f&&(i(f),c(!1),m(""))},p=a?t.filter(s=>s.name.toLowerCase().includes(a.toLowerCase())):t;return e.jsxs("div",{className:"w-full h-full flex flex-col border-r",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Messages"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(h,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(N,{placeholder:"Search chats...",className:"pl-8",value:a,onChange:s=>v(s.target.value)})]}),e.jsxs(z,{open:y,onOpenChange:c,children:[e.jsx(L,{asChild:!0,children:e.jsx(I,{size:"icon",variant:"outline",className:"h-10 w-10",children:e.jsx(S,{size:18})})}),e.jsxs($,{children:[e.jsxs(F,{children:[e.jsx(P,{children:"Start a new chat"}),e.jsx(V,{children:"Select a user to start a conversation"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(h,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(N,{placeholder:"Search users...",className:"pl-8",value:o,onChange:s=>m(s.target.value)})]}),e.jsx(g,{className:"h-64",children:e.jsxs("div",{className:"space-y-1",children:[u.map(s=>e.jsxs("button",{className:"w-full flex items-center gap-3 p-2 rounded-md hover:bg-muted text-left",onClick:()=>b(s.id,s.fullName||s.name||s.username||"Chat"),children:[e.jsx(O,{className:"h-8 w-8",children:e.jsx("div",{className:"bg-primary/20 w-full h-full rounded-full flex items-center justify-center text-primary",children:(s.fullName||s.name||s.username||"U").charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:s.fullName||s.name||s.username||"User"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.role||""})]})]},s.id)),u.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground p-3",children:"No users found"})]})})]})]})]})]})]}),e.jsx(g,{className:"flex-1",children:e.jsx("div",{className:"p-2 space-y-1",children:p.length>0?p.map(s=>e.jsx(Y,{chat:s,isActive:(r==null?void 0:r.id)===s.id,onClick:()=>i(s)},s.id)):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(E,{className:"h-8 w-8 mx-auto text-muted-foreground/50"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:a?"No chats found":"No chats yet"})]})})})]})},xe=()=>{const{currentUser:t}=k(),r=R(),{viewMode:i}=q();Q();const{sendNotification:l}=W(),a=i==="mobile";return n.useEffect(()=>{t||r("/login")},[t,r]),n.useEffect(()=>{t&&l({title:"Chat System Active",message:"The messaging system is now active. You can communicate with your team in real-time.",type:"info",userId:t.id})},[]),e.jsx("div",{className:"container mx-auto p-0 h-[calc(100vh-10rem)]",children:e.jsxs("div",{className:"flex h-full overflow-hidden rounded-lg shadow-sm border bg-white",children:[e.jsx("div",{className:`${a?"w-full md:w-80":"w-80"} h-full border-r`,children:e.jsx(G,{})}),e.jsx("div",{className:"flex-1 h-full overflow-hidden",children:e.jsx(H,{})})]})})};export{xe as default};
