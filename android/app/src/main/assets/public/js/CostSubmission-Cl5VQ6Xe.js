import{r as T,j as e,a0 as L,a7 as Z,X as ee,bQ as se,I as E,b6 as te,bE as ae,bR as ne,bG as ie,J as le,o as P,$ as re,bS as oe,aV as H,ag as V,p as z,q as B,N as ce,b5 as G}from"./react-core-B8kFjp2k.js";import{u as O,a as S,C as u,b as h,B as $,s as M,am as de,f as J,g as Q,h as me,I as k,r as xe,D as ue,$ as he,l as pe,m as je,n as Ne,o as fe,e as ge,J as be,an as ve,ao as Ce,T as ye,i as we,j as R,k as U,a4 as _}from"./index-PwDgWEVM.js";import{u as Se,t as De,o as Ae,s as D,n as I}from"./forms-CESK2FDA.js";import{F as Fe,a as b,b as v,e as C,c as y,f as A,d as w}from"./form-BT_tmI7p.js";import{T as F}from"./textarea-BpQMf5eL.js";import{S as Te,a as ke,b as Ie,c as Ee,d as $e}from"./select-CXX5Q_V1.js";import{o as Pe}from"./date-utils-YarVESQS.js";import{bo as Ve}from"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";import"./label-C4lDws8j.js";const ze=({documents:p,onChange:s})=>{const{toast:g}=O(),[N,i]=T.useState(!1),d=async t=>{const o=t.target.files;if(!(!o||o.length===0)){i(!0);try{const f=[];for(let x=0;x<o.length;x++){const l=o[x],a=l.name.split(".").pop(),j=`cost-receipts/${`${Date.now()}_${Math.random().toString(36).substring(2,9)}.${a}`}`,{data:Re,error:Y}=await M.storage.from("uploads").upload(j,l);if(Y)throw new Error(`Failed to upload ${l.name}`);const{data:X}=M.storage.from("uploads").getPublicUrl(j),q=l.type.startsWith("image/"),K=l.type==="application/pdf",W=q?"receipt_photo":K?"receipt_pdf":"other";f.push({url:X.publicUrl,type:W,filename:l.name,uploadedAt:new Date().toISOString(),size:l.size,description:""})}s([...p,...f]),g({title:"Success",description:`${f.length} document(s) uploaded successfully`}),t.target.value=""}catch(f){g({title:"Upload Failed",description:f.message||"Failed to upload documents",variant:"destructive"})}finally{i(!1)}}},n=t=>{const o=p.filter((f,x)=>x!==t);s(o)},m=t=>t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB",c=t=>t.type==="receipt_photo"?e.jsx(se,{className:"h-5 w-5 text-blue-600"}):t.type==="receipt_pdf"?e.jsx(E,{className:"h-5 w-5 text-red-600"}):e.jsx(te,{className:"h-5 w-5 text-gray-600"});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{id:"document-upload",type:"file",multiple:!0,accept:"image/*,application/pdf",onChange:d,className:"hidden",disabled:N,"data-testid":"input-file-upload"}),e.jsx("label",{htmlFor:"document-upload",children:e.jsx(S,{type:"button",variant:"outline",className:"w-full",disabled:N,asChild:!0,"data-testid":"button-upload-document",children:e.jsx("span",{className:"cursor-pointer",children:N?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Upload Documents"]})})})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Supported formats: Images (JPG, PNG) and PDF. Max 5MB per file."})]}),p.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Uploaded Documents (",p.length,")"]}),e.jsx("div",{className:"space-y-2",children:p.map((t,o)=>e.jsx(u,{"data-testid":`document-${o}`,children:e.jsx(h,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[c(t),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.filename}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx($,{variant:"outline",className:"text-xs",children:t.type.replace("_"," ")}),t.size&&e.jsx("span",{className:"text-xs text-muted-foreground",children:m(t.size)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{type:"button",variant:"ghost",size:"sm",onClick:()=>window.open(t.url,"_blank"),"data-testid":`button-view-${o}`,children:"View"}),e.jsx(S,{type:"button",variant:"ghost",size:"icon",onClick:()=>n(o),"data-testid":`button-remove-${o}`,children:e.jsx(ee,{className:"h-4 w-4"})})]})]})})},o))})]})]})},Be=Ae({mmpSiteEntryId:D().min(1,"Please select a site visit"),transportationCostCents:I().min(0,"Transportation cost must be positive"),accommodationCostCents:I().min(0,"Accommodation cost must be positive"),mealAllowanceCents:I().min(0,"Meal allowance must be positive"),otherCostsCents:I().min(0,"Other costs must be positive"),transportationDetails:D().optional(),accommodationDetails:D().optional(),mealDetails:D().optional(),otherCostsDetails:D().optional(),submissionNotes:D().optional(),currency:D().default("SDG")}),Ge=({siteVisits:p})=>{const{toast:s}=O(),{useCreateSubmission:g}=de(),{mutate:N,isPending:i}=g(),[d,n]=T.useState(null),[m,c]=T.useState([]),t=Se({resolver:De(Be),defaultValues:{mmpSiteEntryId:"",transportationCostCents:0,accommodationCostCents:0,mealAllowanceCents:0,otherCostsCents:0,transportationDetails:"",accommodationDetails:"",mealDetails:"",otherCostsDetails:"",submissionNotes:"",currency:"SDG"},mode:"onChange"}),o=a=>{const r=p.find(j=>j.id===a);n(r||null),t.setValue("mmpSiteEntryId",a)},f=async a=>{if(!d){s({title:"Error",description:"Please select a site visit",variant:"destructive"});return}try{if(!d.mmpDetails.projectId){s({title:"Error",description:"Cannot submit costs: Site visit is not linked to a project",variant:"destructive"});return}await N({mmpSiteEntryId:a.mmpSiteEntryId,mmpFileId:d.mmpDetails.mmpId,projectId:d.mmpDetails.projectId,transportationCostCents:Number(a.transportationCostCents),accommodationCostCents:Number(a.accommodationCostCents),mealAllowanceCents:Number(a.mealAllowanceCents),otherCostsCents:Number(a.otherCostsCents),transportationDetails:a.transportationDetails,accommodationDetails:a.accommodationDetails,mealDetails:a.mealDetails,otherCostsDetails:a.otherCostsDetails,submissionNotes:a.submissionNotes,currency:a.currency,supportingDocuments:m}),s({title:"Success",description:"Cost submission created successfully"}),t.reset(),n(null),c([])}catch(r){s({title:"Error",description:r.message||"Failed to submit costs",variant:"destructive"})}},x=t.watch("transportationCostCents")+t.watch("accommodationCostCents")+t.watch("mealAllowanceCents")+t.watch("otherCostsCents"),l=(a,r)=>`${(a/100).toFixed(2)} ${r}`;return e.jsx(Fe,{...t,children:e.jsx("form",{onSubmit:t.handleSubmit(f),className:"space-y-6",children:e.jsxs(u,{children:[e.jsxs(J,{children:[e.jsx(Q,{children:"Submit Actual Costs"}),e.jsx(me,{children:"Enter the actual costs incurred during your site visit. All amounts should be in whole numbers (e.g., 50 for 0.50 SDG)."})]}),e.jsxs(h,{className:"space-y-6",children:[e.jsx(b,{control:t.control,name:"mmpSiteEntryId",render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:"Select Site Visit *"}),e.jsxs(Te,{onValueChange:o,value:a.value,"data-testid":"select-site-visit",children:[e.jsx(y,{children:e.jsx(ke,{children:e.jsx(Ie,{placeholder:"Choose a completed site visit"})})}),e.jsx(Ee,{children:p.map(r=>e.jsx($e,{value:r.id,"data-testid":`option-site-${r.id}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:r.siteName}),e.jsx($,{variant:"outline",className:"text-xs",children:r.siteCode}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[r.locality,", ",r.state]})]})},r.id))})]}),e.jsx(A,{children:"Select the completed site visit for which you're submitting costs"}),e.jsx(w,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:t.control,name:"transportationCostCents",render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Transportation Cost (cents)"]})}),e.jsx(y,{children:e.jsx(k,{type:"number",min:"0",step:"1",...a,value:a.value,onChange:r=>{const j=r.target.value===""?0:Number(r.target.value);a.onChange(j)},"data-testid":"input-transportation-cost"})}),e.jsx(A,{children:"Enter amount in cents (e.g., 5000 for 50.00 SDG)"}),e.jsx(w,{})]})}),e.jsx(b,{control:t.control,name:"transportationDetails",render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:"Transportation Details"}),e.jsx(y,{children:e.jsx(F,{placeholder:"e.g., Bus fare 30 SDG + Taxi 20 SDG",className:"resize-none",...a,"data-testid":"textarea-transportation-details"})}),e.jsx(w,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:t.control,name:"accommodationCostCents",render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Accommodation Cost (cents)"]})}),e.jsx(y,{children:e.jsx(k,{type:"number",min:"0",step:"1",...a,value:a.value,onChange:r=>{const j=r.target.value===""?0:Number(r.target.value);a.onChange(j)},"data-testid":"input-accommodation-cost"})}),e.jsx(A,{children:"Enter amount in cents (e.g., 10000 for 100.00 SDG)"}),e.jsx(w,{})]})}),e.jsx(b,{control:t.control,name:"accommodationDetails",render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:"Accommodation Details"}),e.jsx(y,{children:e.jsx(F,{placeholder:"e.g., Hotel stay 1 night at 100 SDG",className:"resize-none",...a,"data-testid":"textarea-accommodation-details"})}),e.jsx(w,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:t.control,name:"mealAllowanceCents",render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Meal Allowance (cents)"]})}),e.jsx(y,{children:e.jsx(k,{type:"number",min:"0",step:"1",...a,value:a.value,onChange:r=>{const j=r.target.value===""?0:Number(r.target.value);a.onChange(j)},"data-testid":"input-meal-cost"})}),e.jsx(A,{children:"Enter amount in cents (e.g., 3000 for 30.00 SDG)"}),e.jsx(w,{})]})}),e.jsx(b,{control:t.control,name:"mealDetails",render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:"Meal Details"}),e.jsx(y,{children:e.jsx(F,{placeholder:"e.g., Lunch and dinner",className:"resize-none",...a,"data-testid":"textarea-meal-details"})}),e.jsx(w,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:t.control,name:"otherCostsCents",render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Other Costs (cents)"]})}),e.jsx(y,{children:e.jsx(k,{type:"number",min:"0",step:"1",...a,value:a.value,onChange:r=>{const j=r.target.value===""?0:Number(r.target.value);a.onChange(j)},"data-testid":"input-other-costs"})}),e.jsx(A,{children:"Enter amount in cents (e.g., 1500 for 15.00 SDG)"}),e.jsx(w,{})]})}),e.jsx(b,{control:t.control,name:"otherCostsDetails",render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:"Other Costs Details"}),e.jsx(y,{children:e.jsx(F,{placeholder:"e.g., Parking fees, phone calls",className:"resize-none",...a,"data-testid":"textarea-other-details"})}),e.jsx(w,{})]})})]})]}),e.jsx(b,{control:t.control,name:"submissionNotes",render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"Additional Notes"]})}),e.jsx(y,{children:e.jsx(F,{placeholder:"Add any additional information about your costs...",className:"resize-none",rows:4,...a,"data-testid":"textarea-submission-notes"})}),e.jsx(A,{children:"Provide any context or justification for your expenses"}),e.jsx(w,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Supporting Documents"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Upload receipts, photos, or other documents to support your cost submission"})]}),e.jsx(ze,{documents:m,onChange:c})]}),e.jsx(u,{className:"bg-muted",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),e.jsx("span",{className:"text-lg font-semibold",children:"Total Cost:"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-primary","data-testid":"text-total-cost",children:l(x,t.watch("currency"))}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x," cents"]})]})]})})})]}),e.jsxs(xe,{className:"flex justify-between gap-4",children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>{t.reset(),n(null),c([])},disabled:i,"data-testid":"button-reset",children:"Reset Form"}),e.jsxs(S,{type:"submit",disabled:i||!d,"data-testid":"button-submit-costs",children:[i&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Costs for Approval"]})]})]})})})},Me=({submissions:p})=>{const[s,g]=T.useState(null),N=n=>{const m={pending:{variant:"outline",icon:B,label:"Pending Review"},under_review:{variant:"default",icon:z,label:"Under Review"},approved:{variant:"default",icon:V,label:"Approved"},rejected:{variant:"destructive",icon:H,label:"Rejected"},paid:{variant:"default",icon:P,label:"Paid"},cancelled:{variant:"secondary",icon:oe,label:"Cancelled"}},c=m[n]||m.pending,t=c.icon;return e.jsxs($,{variant:c.variant,className:"flex items-center gap-1",children:[e.jsx(t,{className:"h-3 w-3"}),c.label]})},i=(n,m)=>`${(n/100).toFixed(2)} ${m}`,d=n=>{try{return Pe(new Date(n),"MMM dd, yyyy HH:mm")}catch{return n}};return p.length===0?e.jsx(u,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Submissions Yet"}),e.jsx("p",{className:"text-muted-foreground",children:"You haven't submitted any cost submissions yet. Go to the Submit Costs tab to create your first submission."})]})})}):e.jsx("div",{className:"space-y-4",children:p.map(n=>e.jsxs(u,{"data-testid":`submission-${n.id}`,children:[e.jsx(J,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(Q,{className:"text-base",children:["Cost Submission #",n.id.slice(0,8)]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Submitted on ",d(n.submittedAt)]})]}),N(n.status)]})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Transportation"}),e.jsx("p",{className:"text-sm font-semibold",children:i(n.transportationCostCents,n.currency)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Accommodation"}),e.jsx("p",{className:"text-sm font-semibold",children:i(n.accommodationCostCents,n.currency)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Meals"}),e.jsx("p",{className:"text-sm font-semibold",children:i(n.mealAllowanceCents,n.currency)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Other"}),e.jsx("p",{className:"text-sm font-semibold",children:i(n.otherCostsCents,n.currency)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-md",children:[e.jsx("span",{className:"font-semibold",children:"Total Cost:"}),e.jsx("span",{className:"text-lg font-bold text-primary","data-testid":`total-${n.id}`,children:i(n.totalCostCents,n.currency)})]}),n.reviewerNotes&&e.jsxs("div",{className:"p-3 border rounded-md",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Reviewer Notes:"}),e.jsx("p",{className:"text-sm",children:n.reviewerNotes})]}),n.approvalNotes&&e.jsxs("div",{className:"p-3 border rounded-md",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Approval Notes:"}),e.jsx("p",{className:"text-sm",children:n.approvalNotes})]}),n.status==="paid"&&n.paidAt&&e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-950 border border-green-200 dark:border-green-800 rounded-md",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-700 dark:text-green-300",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Paid on ",d(n.paidAt),n.paidAmountCents&&e.jsxs("span",{className:"ml-2",children:["(",i(n.paidAmountCents,n.currency),")"]})]})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(ue,{children:[e.jsx(he,{asChild:!0,children:e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>g(n),"data-testid":`button-view-details-${n.id}`,children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"View Details"]})}),e.jsxs(pe,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(je,{children:[e.jsx(Ne,{children:"Cost Submission Details"}),e.jsx(fe,{children:"Full details and supporting documents for this submission"})]}),s&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),N(s.status)]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Submitted"}),e.jsx("p",{className:"text-sm",children:d(s.submittedAt)})]}),s.reviewedAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Reviewed"}),e.jsx("p",{className:"text-sm",children:d(s.reviewedAt)})]}),s.paidAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Paid"}),e.jsx("p",{className:"text-sm",children:d(s.paidAt)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"Cost Breakdown"}),s.transportationCostCents>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Transportation"}),e.jsx("span",{className:"text-sm font-semibold",children:i(s.transportationCostCents,s.currency)})]}),s.transportationDetails&&e.jsx("p",{className:"text-xs text-muted-foreground pl-4",children:s.transportationDetails})]}),s.accommodationCostCents>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Accommodation"}),e.jsx("span",{className:"text-sm font-semibold",children:i(s.accommodationCostCents,s.currency)})]}),s.accommodationDetails&&e.jsx("p",{className:"text-xs text-muted-foreground pl-4",children:s.accommodationDetails})]}),s.mealAllowanceCents>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Meals"}),e.jsx("span",{className:"text-sm font-semibold",children:i(s.mealAllowanceCents,s.currency)})]}),s.mealDetails&&e.jsx("p",{className:"text-xs text-muted-foreground pl-4",children:s.mealDetails})]}),s.otherCostsCents>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Other Costs"}),e.jsx("span",{className:"text-sm font-semibold",children:i(s.otherCostsCents,s.currency)})]}),s.otherCostsDetails&&e.jsx("p",{className:"text-xs text-muted-foreground pl-4",children:s.otherCostsDetails})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsx("span",{className:"font-semibold",children:"Total"}),e.jsx("span",{className:"text-lg font-bold text-primary",children:i(s.totalCostCents,s.currency)})]})]}),s.supportingDocuments&&s.supportingDocuments.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Supporting Documents"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.supportingDocuments.map((m,c)=>e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>window.open(m.url,"_blank"),className:"justify-start","data-testid":`button-document-${c}`,children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"truncate",children:m.filename})]},c))})]}),s.submissionNotes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Submission Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.submissionNotes})]})]})]})]})})]})})]},n.id))})},ls=()=>{const p=Ve(),{currentUser:s,roles:g}=ge(),{siteVisits:N}=be(),i=(g==null?void 0:g.includes("admin"))||(s==null?void 0:s.role)==="admin",[d,n]=T.useState(i?"history":"submit"),m=ve(i),c=Ce(i?"":(s==null?void 0:s.id)||""),{submissions:t,isLoading:o}=i?{submissions:m.submissions||[],isLoading:m.isLoading}:{submissions:c.submissions||[],isLoading:c.isLoading},f=i?N.filter(l=>l.status==="completed"):N.filter(l=>l.assignedTo===(s==null?void 0:s.id)&&l.status==="completed"),x={total:t.length,pending:t.filter(l=>l.status==="pending").length,underReview:t.filter(l=>l.status==="under_review").length,approved:t.filter(l=>l.status==="approved").length,rejected:t.filter(l=>l.status==="rejected").length,paid:t.filter(l=>l.status==="paid").length};return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(S,{variant:"ghost",size:"sm",onClick:()=>p(-1),className:"mb-4","data-testid":"button-back",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:[i?"Cost Approval & Tracking":"Cost Submission",i&&e.jsx($,{variant:"outline",className:"ml-2",children:"Admin View"})]}),e.jsx("p",{className:"text-muted-foreground",children:i?"Review, approve, and track cost submissions from all team members":"Submit actual costs for completed site visits and track approval status"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx(u,{"data-testid":"stat-pending",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:x.pending})]}),e.jsx(B,{className:"h-8 w-8 text-amber-600"})]})})}),e.jsx(u,{"data-testid":"stat-under-review",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Under Review"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:x.underReview})]}),e.jsx(z,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(u,{"data-testid":"stat-approved",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:x.approved})]}),e.jsx(V,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(u,{"data-testid":"stat-rejected",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:x.rejected})]}),e.jsx(H,{className:"h-8 w-8 text-red-600"})]})})}),e.jsx(u,{"data-testid":"stat-paid",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Paid"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:x.paid})]}),e.jsx(V,{className:"h-8 w-8 text-primary"})]})})}),e.jsx(u,{"data-testid":"stat-total",children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:x.total})]}),e.jsx(G,{className:"h-8 w-8 text-muted-foreground"})]})})})]}),e.jsxs(ye,{value:d,onValueChange:l=>n(l),className:"space-y-4",children:[e.jsxs(we,{children:[!i&&e.jsxs(R,{value:"submit","data-testid":"tab-submit",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Submit Costs"]}),e.jsxs(R,{value:"history","data-testid":"tab-history",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),i?"All Submissions":"My Submissions"]})]}),!i&&e.jsx(U,{value:"submit",className:"space-y-4",children:o?e.jsx(u,{children:e.jsx(h,{className:"pt-6",children:e.jsx(_,{className:"h-96 w-full"})})}):f.length===0?e.jsx(u,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Completed Site Visits"}),e.jsx("p",{className:"text-muted-foreground",children:"You don't have any completed site visits yet. Complete a site visit to submit costs."})]})})}):e.jsx(Ge,{siteVisits:f})}),e.jsx(U,{value:"history",className:"space-y-4",children:o?e.jsx(u,{children:e.jsx(h,{className:"pt-6",children:e.jsx(_,{className:"h-96 w-full"})})}):e.jsx(Me,{submissions:t})})]})]})};export{ls as default};
