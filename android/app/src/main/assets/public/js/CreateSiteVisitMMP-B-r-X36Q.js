import{r as o,j as e,N as M,v as g,I as C,l as w,b5 as b,p as y}from"./react-core-B8kFjp2k.js";import{e as P,Z as A,U as S,C as d,f as m,g as x,h,b as u,a as i,I as L,S as k,r as I}from"./index-PwDgWEVM.js";import{d as V}from"./mmpUtils-CTST1Zxt.js";import{bo as E}from"./vendor-VlxgVHMv.js";import{o as D}from"./date-utils-YarVESQS.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";const X=()=>{const r=E(),{currentUser:T}=P(),{checkPermission:p,hasAnyRole:j}=A(),{mmpFiles:a,loading:f}=S(),[l,N]=o.useState("");o.useEffect(()=>{V(a||[],"CreateSiteVisitMMP")},[a]);const c=(a==null?void 0:a.filter(s=>{var t;return s.status==="approved"&&(((t=s.siteEntries)==null?void 0:t.length)||s.entries||0)>0}))||[],n=c.filter(s=>{var t;return((t=s.name)==null?void 0:t.toLowerCase().includes(l.toLowerCase()))||s.mmpId&&s.mmpId.toLowerCase().includes(l.toLowerCase())||s.projectName&&s.projectName.toLowerCase().includes(l.toLowerCase())});if(!(p("site_visits","create")||j(["admin"])))return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs(d,{className:"w-full max-w-md",children:[e.jsxs(m,{children:[e.jsx(x,{className:"text-destructive",children:"Access Denied"}),e.jsx(h,{children:"You don't have permission to access this page."})]}),e.jsx(u,{children:e.jsx(i,{variant:"outline",onClick:()=>r("/site-visits"),className:"w-full",children:"Return to Site Visits"})})]})});const v=s=>{r(`/site-visits/create/mmp/${s}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>r("/site-visits/create"),className:"mr-2",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Create Site Visit from MMP"}),e.jsx("p",{className:"text-muted-foreground",children:"Select an approved MMP file to create site visits"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(L,{placeholder:"Search by MMP name or ID...",className:"pl-8",value:l,onChange:s=>N(s.target.value)})]}),f?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx("p",{children:"Loading MMP files..."})}):n.length>0?e.jsx(k,{className:"h-[60vh]",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(s=>{var t;return e.jsxs(d,{className:"cursor-pointer hover:border-primary",onClick:()=>v(s.id),children:[e.jsxs(m,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(x,{className:"text-lg truncate",children:s.name}),e.jsx("div",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:s.mmpId||"MMP"})]}),e.jsx(h,{children:s.projectName||"No project name"})]}),e.jsx(u,{className:"pb-2",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(C,{className:"h-3.5 w-3.5 mr-1"}),((t=s.siteEntries)==null?void 0:t.length)||s.entries||0," site entries"]}),e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(w,{className:"h-3.5 w-3.5 mr-1"}),s.approvedAt?D(new Date(s.approvedAt),"MMM d, yyyy"):"N/A"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:s.description||"No description available"})]})}),e.jsx(I,{className:"pt-2",children:e.jsxs(i,{className:"w-full",size:"sm",children:[e.jsx(b,{className:"h-3.5 w-3.5 mr-1.5"})," Create Site Visits"]})})]},s.id)})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center",children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(y,{className:"h-10 w-10 text-amber-500"})}),e.jsx("h3",{className:"text-lg font-medium",children:"No MMPs found"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:a.length===0?"You haven't uploaded any MMPs yet.":c.length===0?"Your uploaded MMPs need to be approved before they appear here.":"No MMPs matching your search criteria."}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx(i,{variant:"outline",onClick:()=>r("/mmp"),className:"mt-4",children:"View All MMPs"}),e.jsx(i,{onClick:()=>r("/mmp/upload"),className:"mt-4",children:"Upload New MMP"})]})]})]})};export{X as default};
