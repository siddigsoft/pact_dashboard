import{j as e,l as X,r as u,b5 as I,aG as Y,C as Z,aO as z,aR as _,R as D}from"./react-core-B8kFjp2k.js";import{I as M,a as m,H as V,B as R,D as S,l as b,m as C,n as v}from"./index-PwDgWEVM.js";import{C as y,a as ee,b as se}from"./collapsible-DNmzDQGQ.js";import{A as ne}from"./ActivityForm-DxwKkf_I.js";import{u as re,t as de,o as le,d as oe,s as P,e as ae}from"./forms-CESK2FDA.js";import{F as ce,a as h,b as j,e as p,c as g,d as f}from"./form-BT_tmI7p.js";import{T as te}from"./textarea-BpQMf5eL.js";import{S as B,a as H,b as W,c as q,d as w}from"./select-CXX5Q_V1.js";import{P as me,a as xe,b as ie}from"./popover-BSK_FA51.js";import{C as ue}from"./calendar-DEyRSxJX.js";import{o as he}from"./date-utils-YarVESQS.js";const je=le({name:P().min(3,{message:"Sub-activity name must be at least 3 characters."}),description:P().optional(),status:ae(["pending","inProgress","completed","cancelled"]),assignedTo:P().optional(),dueDate:oe().optional()}),k=({onSubmit:t,onCancel:x,initialData:d})=>{const o=re({resolver:de(je),defaultValues:{name:(d==null?void 0:d.name)||"",description:(d==null?void 0:d.description)||"",status:(d==null?void 0:d.status)||"pending",assignedTo:(d==null?void 0:d.assignedTo)||"",dueDate:d!=null&&d.dueDate?new Date(d.dueDate):void 0}}),i=r=>{t({...r,dueDate:r.dueDate?r.dueDate.toISOString():void 0,id:(d==null?void 0:d.id)||`sub-${Date.now()}`})};return e.jsx(ce,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(i),className:"space-y-6",children:[e.jsx(h,{control:o.control,name:"name",render:({field:r})=>e.jsxs(j,{children:[e.jsx(p,{children:"Sub-Activity Name*"}),e.jsx(g,{children:e.jsx(M,{placeholder:"Enter sub-activity name",...r})}),e.jsx(f,{})]})}),e.jsx(h,{control:o.control,name:"description",render:({field:r})=>e.jsxs(j,{children:[e.jsx(p,{children:"Description"}),e.jsx(g,{children:e.jsx(te,{placeholder:"Enter sub-activity description",className:"resize-none",...r})}),e.jsx(f,{})]})}),e.jsx(h,{control:o.control,name:"status",render:({field:r})=>e.jsxs(j,{children:[e.jsx(p,{children:"Status"}),e.jsxs(B,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(g,{children:e.jsx(H,{children:e.jsx(W,{placeholder:"Select status"})})}),e.jsxs(q,{children:[e.jsx(w,{value:"pending",children:"Pending"}),e.jsx(w,{value:"inProgress",children:"In Progress"}),e.jsx(w,{value:"completed",children:"Completed"}),e.jsx(w,{value:"cancelled",children:"Cancelled"})]})]}),e.jsx(f,{})]})}),e.jsx(h,{control:o.control,name:"assignedTo",render:({field:r})=>e.jsxs(j,{children:[e.jsx(p,{children:"Assigned To"}),e.jsx(g,{children:e.jsx(M,{placeholder:"Enter assignee",...r})}),e.jsx(f,{})]})}),e.jsx(h,{control:o.control,name:"dueDate",render:({field:r})=>e.jsxs(j,{className:"flex flex-col",children:[e.jsx(p,{children:"Due Date"}),e.jsxs(me,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(g,{children:e.jsxs(m,{variant:"outline",className:V("w-full pl-3 text-left font-normal",!r.value&&"text-muted-foreground"),children:[r.value?he(r.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(X,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(ie,{className:"w-auto p-0",align:"start",children:e.jsx(ue,{mode:"single",selected:r.value,onSelect:r.onChange,initialFocus:!0})})]}),e.jsx(f,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:x,children:"Cancel"}),e.jsx(m,{type:"submit",children:d?"Update Sub-Activity":"Add Sub-Activity"})]})]})})},Pe=({activities:t,onActivitiesChange:x,projectType:d})=>{const[o,i]=u.useState({}),[r,a]=u.useState({}),[A,G]=u.useState({}),[$,pe]=u.useState([]),[F,L]=u.useState([]);u.useEffect(()=>{(()=>{const s=$.filter(l=>(l.workload||0)>80).map(l=>l.userId);L(s)})()},[$]);const U=n=>{const s={...n,id:`act-${Date.now()}`,subActivities:[]};x([...t,s]),i({...o,new:!1})},J=n=>{x(t.filter(s=>s.id!==n))},K=(n,s)=>{const l=t.map(c=>c.id===n?{...c,subActivities:[...c.subActivities,s]}:c);x(l),a({...r,[n]:!1})},E=(n,s,l)=>{const c=t.map(N=>N.id===n?{...N,subActivities:N.subActivities.map(T=>T.id===s?{...T,...l}:T)}:N);x(c),a({...r,[`${n}-${s}`]:!1})},O=n=>{switch(n){case"pending":return"default";case"inProgress":return"secondary";case"completed":return"outline";case"cancelled":return"destructive";default:return"default"}},Q=(n,s)=>{const l=t.map(c=>c.id===n?{...c,assignedTo:s}:c);x(l)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Activities"}),e.jsxs(m,{onClick:()=>i({...o,new:!0}),size:"sm",children:[e.jsx(I,{className:"h-4 w-4 mr-2"})," Add Activity"]})]}),e.jsx("div",{className:"space-y-2",children:t.map(n=>e.jsxs(y,{open:A[n.id],onOpenChange:s=>G({...A,[n.id]:s}),className:"border rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ee,{className:"flex items-center hover:bg-muted/50 rounded-md px-2 py-1 w-full",children:[e.jsxs("div",{className:"flex items-center",children:[A[n.id]?e.jsx(Y,{className:"h-4 w-4 mr-2"}):e.jsx(Z,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"font-medium",children:n.name})]}),e.jsx(R,{variant:O(n.status),className:"ml-2",children:n.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),i({...o,[n.id]:!0})},children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:s=>{s.stopPropagation(),J(n.id)},children:e.jsx(_,{className:"h-4 w-4 text-destructive"})})]})]}),e.jsx(se,{className:"pt-2",children:e.jsxs("div",{className:"pl-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Assignment"}),e.jsxs(B,{value:n.assignedTo,onValueChange:s=>Q(n.id,s),children:[e.jsx(H,{className:"w-[200px]",children:e.jsx(W,{placeholder:"Assign to team member"})}),e.jsx(q,{children:$.map(s=>e.jsxs(w,{value:s.userId,className:V(F.includes(s.userId)&&"text-yellow-500 font-medium"),children:[s.name," ",F.includes(s.userId)&&"(High Workload)"]},s.userId))})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Sub-Activities"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>a({...r,[n.id]:!0}),children:[e.jsx(I,{className:"h-3 w-3 mr-1"})," Add Sub-Activity"]})]}),e.jsx("div",{className:"space-y-1",children:n.subActivities.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 rounded-md p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:s.name}),e.jsx(R,{variant:O(s.status),className:"text-xs",children:s.status})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>a({...r,[`${n.id}-${s.id}`]:!0}),children:e.jsx(z,{className:"h-3 w-3"})})})]},s.id))})]})}),n.subActivities.map(s=>e.jsx(S,{open:r[`${n.id}-${s.id}`],onOpenChange:l=>a({...r,[`${n.id}-${s.id}`]:l}),children:e.jsxs(b,{className:"w-[95vw] sm:max-w-2xl max-h-[85vh] overflow-y-auto",children:[e.jsx(C,{children:e.jsx(v,{children:"Edit Sub-Activity"})}),e.jsx(k,{initialData:s,onSubmit:l=>E(n.id,s.id,l),onCancel:()=>a({...r,[`${n.id}-${s.id}`]:!1})})]})},`${n.id}-${s.id}`))]},n.id))}),e.jsx(S,{open:o.new,onOpenChange:n=>i({...o,new:n}),children:e.jsxs(b,{className:"w-[95vw] sm:max-w-2xl max-h-[85vh] overflow-y-auto",children:[e.jsx(C,{children:e.jsx(v,{children:"Add Activity"})}),e.jsx(ne,{onSubmit:U,onCancel:()=>i({...o,new:!1}),projectType:d})]})}),t.map(n=>e.jsxs(D.Fragment,{children:[n.subActivities.map(s=>e.jsx(S,{open:r[`${n.id}-${s.id}`],onOpenChange:l=>a({...r,[`${n.id}-${s.id}`]:l}),children:e.jsxs(b,{className:"w-[95vw] sm:max-w-2xl max-h-[85vh] overflow-y-auto",children:[e.jsx(C,{children:e.jsx(v,{children:"Edit Sub-Activity"})}),e.jsx(k,{initialData:s,onSubmit:l=>E(n.id,s.id,l),onCancel:()=>a({...r,[`${n.id}-${s.id}`]:!1})})]})},`${n.id}-${s.id}`)),e.jsx(S,{open:r[n.id],onOpenChange:s=>a({...r,[n.id]:s}),children:e.jsxs(b,{className:"w-[95vw] sm:max-w-2xl max-h-[85vh] overflow-y-auto",children:[e.jsx(C,{children:e.jsx(v,{children:"Add Sub-Activity"})}),e.jsx(k,{onSubmit:s=>K(n.id,s),onCancel:()=>a({...r,[n.id]:!1})})]})})]},n.id))]})};export{Pe as A};
