const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index-PwDgWEVM.js","js/react-core-B8kFjp2k.js","js/vendor-VlxgVHMv.js","js/docs-D2Yi4cpO.js","js/react-dom-BLwj5vIO.js","js/date-utils-YarVESQS.js","js/jspdf-rld7HkB6.js","js/router-CKy9yO3R.js","js/query-CJ0Bt4ph.js","js/supabase-CwPDIVMD.js","js/xlsx-CBxwqXDA.js","js/forms-CESK2FDA.js","js/radix-ui-C2DV4xtt.js","js/radix-dialogs-CnlmQBMC.js","js/radix-menus-CPezQVZk.js","assets/index-D008cfpT.css"])))=>i.map(i=>d[i]);
import{_ as z}from"./jspdf-rld7HkB6.js";import{r as c,j as e,a3 as _,ag as ne,p as re,a0 as oe,S as le,B as ce,bx as de,y as he,D as me}from"./react-core-B8kFjp2k.js";import{E as $,u as J,C as v,f as w,g as N,h as C,b as y,B as G,a as h,aa as pe,T as ue,i as xe,j as g,k as j,I as k,D as ge,l as je,m as fe,n as ve,o as we,p as Ne,ab as Ce}from"./index-PwDgWEVM.js";import{S as f}from"./switch-DFAHzttT.js";import{L as r}from"./label-C4lDws8j.js";import{R as ye,U as be}from"./UserClassificationBadge-nu7nDiDQ.js";import"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./date-utils-YarVESQS.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";import"./ClassificationBadge-CQcKQdLP.js";const Pe=()=>{var D,E;const{currentUser:a,updateUserLocation:i}=$(),[T,t]=c.useState(!1),[l,m]=c.useState(!1),[b,d]=c.useState(null),{toast:p}=J();c.useEffect(()=>{var o,n;(o=a==null?void 0:a.location)!=null&&o.latitude&&((n=a==null?void 0:a.location)!=null&&n.longitude)&&m(!0)},[a]);const P=async()=>{if(t(!0),d(null),!navigator.geolocation){d("Geolocation is not supported by your browser"),t(!1),p({title:"Location not supported",description:"Your browser does not support geolocation",variant:"destructive"});return}navigator.geolocation.getCurrentPosition(async o=>{const{latitude:n,longitude:L}=o.coords;try{if(await i(n,L))m(!0),p({title:"Location captured",description:`Your location has been saved: ${n.toFixed(4)}, ${L.toFixed(4)}`,variant:"default"});else throw new Error("Failed to update location")}catch{d("Failed to save location"),p({title:"Location update failed",description:"There was a problem saving your location",variant:"destructive"})}finally{t(!1)}},o=>{let n="Unable to retrieve your location";switch(o.code){case o.PERMISSION_DENIED:n="Location permission denied. Please enable location access in your browser settings.";break;case o.POSITION_UNAVAILABLE:n="Location information is unavailable";break;case o.TIMEOUT:n="Location request timed out";break}d(n),t(!1),p({title:"Location capture failed",description:n,variant:"destructive"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})};return a?e.jsxs(v,{className:"w-full",children:[e.jsxs(w,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Location Sharing"]}),e.jsx(C,{children:"Share your location to appear on the team map and receive nearby site visit assignments"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Current Status:"}),l?e.jsxs(G,{variant:"default",className:"bg-green-500",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),"Location Enabled"]}):e.jsxs(G,{variant:"secondary",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Location Not Set"]})]})}),((D=a.location)==null?void 0:D.latitude)&&((E=a.location)==null?void 0:E.longitude)&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Your Location:"}),e.jsxs("p",{className:"font-mono text-sm",children:["Lat: ",a.location.latitude.toFixed(6),", Lng: ",a.location.longitude.toFixed(6)]}),a.location.lastUpdated&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Last updated: ",new Date(a.location.lastUpdated).toLocaleString()]})]}),b&&e.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-destructive",children:b})}),e.jsx(h,{onClick:P,disabled:T,className:"w-full",children:T?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"mr-2 h-4 w-4 animate-spin"}),"Capturing Location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),l?"Update Location":"Enable Location Sharing"]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your location will be visible to supervisors and coordinators for assignment purposes. You can update your location at any time."})]})]}):null},He=()=>{var W,q,H;const{toast:a}=J(),{currentUser:i,updateUser:T}=$(),{userSettings:t,notificationSettings:l,appearanceSettings:m,updateUserSettings:b,updateNotificationSettings:d,updateAppearanceSettings:p,updateDataVisibilitySettings:P,loading:D}=pe(),[E,o]=c.useState(!1),[n,L]=c.useState(""),[x,A]=c.useState(""),[I,V]=c.useState(""),[B,F]=c.useState(!1),[U,O]=c.useState((i==null?void 0:i.name)||""),[R,Y]=c.useState((i==null?void 0:i.email)||"");c.useEffect(()=>{i&&(O(i.name||""),Y(i.email||""))},[i]);const K=s=>{d({...l,enabled:s})},Q=s=>{d({...l,email:s})},X=s=>{d({...l,sound:s})},Z=s=>{p({...m,darkMode:s})},ee=s=>{p({...m,theme:s.target.value})},se=s=>{b({defaultPage:s.target.value})},ae=async()=>{if(i)try{const s=await T({...i,name:U,email:R});a(s?{title:"Profile updated",description:"Your profile information has been saved successfully.",variant:"success"}:{title:"Update failed",description:"There was an error updating your profile.",variant:"destructive"})}catch{a({title:"Update failed",description:"There was an error updating your profile.",variant:"destructive"})}},te=s=>{P({options:{shareLocationWithTeam:s}})},ie=async()=>{if(!n||!x||!I){a({title:"Input required",description:"All fields are required.",variant:"destructive"});return}if(x!==I){a({title:"Passwords do not match",description:"Please confirm your new password.",variant:"destructive"});return}F(!0);try{const{error:s}=await z(async()=>{const{error:u}=await import("./index-PwDgWEVM.js").then(M=>M.aq);return{error:u}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])).then(({supabase:u})=>u.auth.signInWithPassword({email:i==null?void 0:i.email,password:n}));if(s){F(!1),a({title:"Wrong current password",description:"The current password you entered is incorrect.",variant:"destructive"});return}const{error:S}=await z(async()=>{const{error:u}=await import("./index-PwDgWEVM.js").then(M=>M.aq);return{error:u}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])).then(({supabase:u})=>u.auth.updateUser({password:x}));S?(F(!1),a({title:"Password change failed",description:S.message||"Could not change password.",variant:"destructive"})):(a({title:"Password changed",description:"Your password was successfully updated.",variant:"success"}),o(!1),L(""),A(""),V(""))}catch(s){a({title:"Password change failed",description:s.message||"An unexpected error occurred.",variant:"destructive"})}finally{F(!1)}};return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading settings..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings and preferences."})]})}),e.jsxs(ue,{defaultValue:"general",className:"space-y-4",children:[e.jsxs(xe,{children:[e.jsxs(g,{value:"general",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"General"]}),e.jsxs(g,{value:"location",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Location"]}),e.jsxs(g,{value:"notifications",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Notifications"]}),e.jsxs(g,{value:"appearance",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Appearance"]}),e.jsxs(g,{value:"profile",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Profile"]}),e.jsxs(g,{value:"dataVisibility",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Data Visibility"]})]}),e.jsx(j,{value:"general",className:"space-y-4",children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(N,{children:"General Settings"}),e.jsx(C,{children:"Configure general system preferences"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(r,{htmlFor:"default-page",children:"Default Landing Page"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose which page to show after login"})]}),e.jsxs("select",{id:"default-page",className:"px-3 py-2 border rounded-md",value:((W=t==null?void 0:t.settings)==null?void 0:W.defaultPage)||"dashboard",onChange:se,children:[e.jsx("option",{value:"dashboard",children:"Dashboard"}),e.jsx("option",{value:"mmp",children:"MMP Management"}),e.jsx("option",{value:"site-visits",children:"Site Visits"}),e.jsx("option",{value:"reports",children:"Reports"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(h,{onClick:()=>{var s;return b({defaultPage:((s=t==null?void 0:t.settings)==null?void 0:s.defaultPage)||"dashboard"})},children:"Save Changes"})})]})]})}),e.jsx(j,{value:"location",className:"space-y-4",children:e.jsx(Pe,{})}),e.jsx(j,{value:"notifications",className:"space-y-4",children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(N,{children:"Notification Preferences"}),e.jsx(C,{children:"Configure how and when you receive notifications"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{id:"notifications",checked:l.enabled,onCheckedChange:K}),e.jsx(r,{htmlFor:"notifications",children:"Enable notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{id:"email-notifications",checked:l.email,onCheckedChange:Q,disabled:!l.enabled}),e.jsx(r,{htmlFor:"email-notifications",children:"Email notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{id:"sound-alerts",checked:l.sound,onCheckedChange:X,disabled:!l.enabled}),e.jsx(r,{htmlFor:"sound-alerts",children:"Sound alerts"})]}),e.jsx("div",{className:"pt-4",children:e.jsx(h,{onClick:()=>d(l),children:"Save Changes"})})]})]})}),e.jsx(j,{value:"appearance",className:"space-y-4",children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(N,{children:"Appearance Settings"}),e.jsx(C,{children:"Customize the look and feel of the application"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{id:"dark-mode",checked:m.darkMode,onCheckedChange:Z}),e.jsx(r,{htmlFor:"dark-mode",children:"Dark Mode"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{htmlFor:"theme",children:"Theme"}),e.jsxs("select",{id:"theme",className:"w-full px-3 py-2 border rounded-md",value:m.theme,onChange:ee,children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"high-contrast",children:"High Contrast"}),e.jsx("option",{value:"neutral",children:"Neutral"})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(h,{onClick:()=>p(m),children:"Save Changes"})})]})]})}),e.jsx(j,{value:"profile",className:"space-y-4",children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(N,{children:"Profile Settings"}),e.jsx(C,{children:"Manage your personal information"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"name",children:"Name"}),e.jsx(k,{id:"name",value:U,onChange:s=>O(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"email",children:"Email"}),e.jsx(k,{id:"email",type:"email",value:R,onChange:s=>Y(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{children:"Role"}),e.jsx("div",{className:"flex items-center gap-2 pt-1",children:e.jsx(ye,{role:(i==null?void 0:i.role)||"User",size:"md"})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{children:"Classification"}),e.jsx("div",{className:"flex items-center gap-2 pt-1",children:i&&e.jsx(be,{userId:i.id,size:"md",showUnassigned:!0})})]})]}),e.jsxs("div",{className:"pt-4 flex flex-col sm:flex-row gap-2",children:[e.jsx(h,{onClick:ae,children:"Save Changes"}),e.jsx(h,{variant:"outline",onClick:()=>o(!0),children:"Change Password"})]})]})]})}),e.jsx(j,{value:"dataVisibility",className:"space-y-4",children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(N,{children:"Data Visibility Settings"}),e.jsx(C,{children:"Control how your data is shared and displayed"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{id:"location-sharing",checked:!!((q=t==null?void 0:t.settings)!=null&&q.shareLocationWithTeam),onCheckedChange:te}),e.jsx(r,{htmlFor:"location-sharing",children:"Share location with team"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{id:"display-metrics",checked:!!((H=t==null?void 0:t.settings)!=null&&H.displayPersonalMetrics),onCheckedChange:s=>{P({options:{displayPersonalMetrics:s}})}}),e.jsx(r,{htmlFor:"display-metrics",children:"Display personal metrics on team dashboard"})]}),e.jsx("div",{className:"pt-4",children:e.jsx(h,{onClick:()=>{var s,S;P({options:{shareLocationWithTeam:!!((s=t==null?void 0:t.settings)!=null&&s.shareLocationWithTeam),displayPersonalMetrics:!!((S=t==null?void 0:t.settings)!=null&&S.displayPersonalMetrics)}}),a({title:"Settings saved",description:"Your data visibility settings have been updated.",variant:"success"})},children:"Save Changes"})})]})]})})]}),e.jsx(ge,{open:E,onOpenChange:o,children:e.jsxs(je,{children:[e.jsxs(fe,{children:[e.jsx(ve,{children:"Change Password"}),e.jsx(we,{children:"Update your account password below."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"old-password",children:"Current Password"}),e.jsx(k,{id:"old-password",type:"password",value:n,onChange:s=>L(s.target.value),autoComplete:"current-password"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"new-password",children:"New Password"}),e.jsx(k,{id:"new-password",type:"password",value:x,onChange:s=>A(s.target.value),autoComplete:"new-password"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"confirm-password",children:"Confirm New Password"}),e.jsx(k,{id:"confirm-password",type:"password",value:I,onChange:s=>V(s.target.value),autoComplete:"new-password"})]})]}),e.jsxs(Ne,{className:"gap-2 flex-row flex justify-end",children:[e.jsx(Ce,{asChild:!0,children:e.jsx(h,{variant:"ghost",children:"Cancel"})}),e.jsx(h,{onClick:ie,disabled:B,children:B?"Changing...":"Change Password"})]})]})})]})};export{He as default};
