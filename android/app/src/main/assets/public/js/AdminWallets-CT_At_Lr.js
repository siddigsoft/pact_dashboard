import{r as o,j as e,W as N,T as I,o as T,be as A,bO as k,q as C,b9 as P,g as M,t as R,aV as B,i as F,v as G,al as O}from"./react-core-B8kFjp2k.js";import{C as p,f as b,g as j,B as H,b as h,D as U,l as z,m as $,n as L,a8 as V,s as _,I as q,a as X}from"./index-PwDgWEVM.js";import{G as D}from"./gradient-stat-card-CWH4umO5.js";import{P as J}from"./progress-vMwTbqUI.js";import{T as K,a as Q,b as S,c as g,d as Y,e as f}from"./table-CZ8ZB6wW.js";import{o as W}from"./date-utils-YarVESQS.js";import{bo as Z}from"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";const c=(a,t="SDG")=>new Intl.NumberFormat("en-SD",{style:"currency",currency:t,minimumFractionDigits:2}).format(a/100);function ee({wallet:a,currency:t="SDG",onClick:v}){var r;const[x,w]=o.useState(!1),n=(((r=a.balances)==null?void 0:r[t])||0)*100,d=(a.totalEarned||0)*100,m=(a.totalWithdrawn||0)*100,u=(a.pendingPayouts||0)*100,i=d>0?m/d*100:0,y=n>0||d>0,s=()=>{v?v(a.userId):w(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/20 via-purple-500/20 to-cyan-500/20 rounded-xl blur-lg group-hover:blur-xl transition-all"}),e.jsxs(p,{className:"relative cursor-pointer transition-all bg-gradient-to-br from-slate-900/90 via-blue-900/40 to-slate-900/90 backdrop-blur-xl border border-blue-500/30 hover:border-purple-500/50 shadow-[0_0_15px_rgba(59,130,246,0.15)] hover:shadow-[0_0_25px_rgba(168,85,247,0.3)]",onClick:s,"data-testid":`wallet-card-${a.userId}`,children:[e.jsx(b,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-blue-500/30 to-purple-500/30 rounded-lg border border-blue-400/30 shadow-[0_0_10px_rgba(59,130,246,0.2)]",children:e.jsx(N,{className:"w-5 h-5 text-blue-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(j,{className:"text-base line-clamp-1 bg-gradient-to-r from-blue-300 to-purple-300 bg-clip-text text-transparent font-bold",children:a.userName||a.userId}),e.jsx("p",{className:"text-sm text-blue-300/60 truncate",children:a.userEmail||"User Wallet"})]})]}),e.jsx(H,{className:y?"bg-gradient-to-r from-green-500/90 to-emerald-500/90 text-white border-green-400/30 shadow-[0_0_10px_rgba(34,197,94,0.3)]":"bg-gradient-to-r from-slate-700/90 to-slate-600/90 text-slate-300 border-slate-500/30",children:y?"ACTIVE":"INACTIVE"})]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2 p-4 bg-gradient-to-br from-blue-500/10 to-purple-500/10 rounded-lg border border-blue-400/20",children:e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-300/70 uppercase tracking-wider",children:"Current Balance"}),e.jsx("p",{className:"text-3xl font-bold bg-gradient-to-r from-cyan-400 via-blue-400 to-purple-400 bg-clip-text text-transparent",children:c(n,t)})]}),n>0?e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg border border-green-400/30",children:e.jsx(I,{className:"w-5 h-5 text-green-400"})}):e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg border border-blue-400/30",children:e.jsx(T,{className:"w-5 h-5 text-blue-400"})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-3 border-t border-blue-500/20",children:[e.jsxs("div",{className:"space-y-1 p-3 bg-gradient-to-br from-blue-500/5 to-transparent rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-300/60 uppercase",children:[e.jsx(A,{className:"w-3 h-3 text-green-400"}),e.jsx("span",{children:"Earned"})]}),e.jsx("p",{className:"font-bold text-blue-200",children:c(d,t)})]}),e.jsxs("div",{className:"space-y-1 p-3 bg-gradient-to-br from-purple-500/5 to-transparent rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-purple-300/60 uppercase",children:[e.jsx(k,{className:"w-3 h-3 text-purple-400"}),e.jsx("span",{children:"Withdrawn"})]}),e.jsx("p",{className:"font-bold text-purple-200",children:c(m,t)})]})]}),d>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-cyan-300/70 uppercase tracking-wider",children:[e.jsx("span",{children:"Payout Progress"}),e.jsxs("span",{className:"text-cyan-400 font-bold",children:[i.toFixed(0),"%"]})]}),e.jsx("div",{className:"relative h-2 bg-slate-800/50 rounded-full overflow-hidden border border-blue-500/20",children:e.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-blue-500 via-purple-500 to-cyan-500 rounded-full shadow-[0_0_10px_rgba(59,130,246,0.5)]",style:{width:`${i}%`}})})]}),a.updatedAt&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-blue-300/50 pt-2 border-t border-blue-500/10",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsxs("span",{className:"uppercase tracking-wide",children:["Updated ",W(new Date(a.updatedAt),"MMM dd, yyyy")]})]})]})]})]}),e.jsx(U,{open:x,onOpenChange:w,children:e.jsxs(z,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx($,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),"Wallet Details: ",a.userName||a.userId]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"User ID"}),e.jsx("p",{className:"font-mono text-sm",children:a.userId})]}),a.userEmail&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Email"}),e.jsx("p",{className:"text-sm",children:a.userEmail})]})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(p,{children:[e.jsx(b,{className:"pb-3",children:e.jsxs(j,{className:"text-xs font-medium flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"}),"Balance"]})}),e.jsx(h,{children:e.jsx("p",{className:"text-xl font-bold",children:c(n,t)})})]}),e.jsxs(p,{children:[e.jsx(b,{className:"pb-3",children:e.jsxs(j,{className:"text-xs font-medium flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3 text-green-600"}),"Earned"]})}),e.jsx(h,{children:e.jsx("p",{className:"text-xl font-bold",children:c(d,t)})})]}),e.jsxs(p,{children:[e.jsx(b,{className:"pb-3",children:e.jsxs(j,{className:"text-xs font-medium flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3 text-red-600"}),"Paid Out"]})}),e.jsx(h,{children:e.jsx("p",{className:"text-xl font-bold",children:c(m,t)})})]}),e.jsxs(p,{children:[e.jsx(b,{className:"pb-3",children:e.jsxs(j,{className:"text-xs font-medium flex items-center gap-1",children:[e.jsx(C,{className:"w-3 h-3 text-yellow-600"}),"Pending"]})}),e.jsx(h,{children:e.jsx("p",{className:"text-xl font-bold",children:c(u,t)})})]})]}),d>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Payout Utilization"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[i.toFixed(1),"%"]})]}),e.jsx(J,{value:i,className:"h-3"}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"Withdrawn from total earnings"}),e.jsxs("span",{children:[c(d-m,t)," remaining"]})]})]}),a.transactions&&a.transactions.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Recent Transactions"]}),e.jsx("div",{className:"rounded-lg border",children:e.jsxs(K,{children:[e.jsx(Q,{children:e.jsxs(S,{children:[e.jsx(g,{children:"Type"}),e.jsx(g,{children:"Description"}),e.jsx(g,{children:"Amount"}),e.jsx(g,{children:"Date"}),e.jsx(g,{children:"Status"})]})}),e.jsx(Y,{children:a.transactions.slice(0,5).map(l=>e.jsxs(S,{children:[e.jsx(f,{className:"font-medium capitalize",children:l.type.replace(/_/g," ")}),e.jsx(f,{className:"text-sm text-muted-foreground",children:l.description||"-"}),e.jsx(f,{children:e.jsxs("span",{className:l.amount>0?"text-green-600":"text-red-600",children:[l.amount>0?"+":"",c(l.amount*100,t)]})}),e.jsx(f,{className:"text-sm",children:W(new Date(l.createdAt),"MMM dd, yyyy")}),e.jsx(f,{children:l.status==="completed"?e.jsx(R,{className:"w-4 h-4 text-green-600"}):l.status==="pending"?e.jsx(C,{className:"w-4 h-4 text-yellow-600"}):e.jsx(B,{className:"w-4 h-4 text-red-600"})})]},l.id))})]})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground pt-4 border-t",children:[e.jsxs("span",{children:["Wallet ID: ",a.id]}),a.updatedAt&&e.jsxs("span",{children:["Last updated: ",W(new Date(a.updatedAt),"MMM dd, yyyy HH:mm")]})]})]})]})})]})}const E=(a,t)=>new Intl.NumberFormat(void 0,{style:"currency",currency:t||"NGN",currencyDisplay:"narrowSymbol"}).format((a||0)/100),fe=()=>{const{listWallets:a}=V(),[t,v]=o.useState([]),[x,w]=o.useState(""),[n,d]=o.useState("SDG"),m=Z(),u=async()=>{var l;const s=await a();v(s||[]);const r=s&&((l=s[0])!=null&&l.balances)?Object.keys(s[0].balances)[0]:"SDG";d(r)};o.useEffect(()=>{u()},[]),o.useEffect(()=>{const s=setInterval(()=>{u()},6e4);return()=>clearInterval(s)},[]),o.useEffect(()=>{const s=_.channel("admin_wallets").on("postgres_changes",{event:"*",schema:"public",table:"wallets"},()=>u());return s.subscribe(),()=>{try{_.removeChannel(s)}catch{}}},[]);const i=o.useMemo(()=>{if(!x)return t;const s=x.toLowerCase();return t.filter(r=>(r.userId||"").toString().toLowerCase().includes(s))},[t,x]),y=(s,r)=>{var l;return(((l=s.balances)==null?void 0:l[r])||0)*100};return e.jsxs("div",{className:"min-h-screen bg-background p-4 md:p-8 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-purple-500 to-purple-700 flex items-center justify-center",children:e.jsx(N,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Wallets Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Financial Operations Command Center"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(D,{title:"Total Platform Earnings",value:E(i.reduce((s,r)=>s+(Number(r.totalEarned)||0)*100,0),n),subtitle:`${i.length} active wallets`,icon:I,color:"blue","data-testid":"card-stat-total-earnings"}),e.jsx(D,{title:"Total Withdrawals",value:E(i.reduce((s,r)=>s+(Number(r.totalWithdrawn)||0)*100,0),n),subtitle:"Paid to enumerators",icon:F,color:"purple","data-testid":"card-stat-total-withdrawals"}),e.jsx(D,{title:"Current Balances",value:E(i.reduce((s,r)=>s+y(r,n),0),n),subtitle:"Available for withdrawal",icon:N,color:"cyan","data-testid":"card-stat-current-balances"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground z-10"}),e.jsx(q,{placeholder:"Search wallet ID...",value:x,onChange:s=>w(s.target.value),className:"pl-10","data-testid":"input-search-wallets"})]}),e.jsxs(X,{variant:"outline",onClick:u,"data-testid":"button-refresh-wallets",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),i.length===0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-2xl blur-xl"}),e.jsx(p,{className:"relative bg-gradient-to-br from-slate-900/90 to-blue-900/50 backdrop-blur-xl border border-blue-500/30",children:e.jsxs(h,{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-500/20 to-purple-500/20 rounded-2xl mb-6",children:e.jsx(N,{className:"w-16 h-16 text-blue-400"})}),e.jsx("h3",{className:"text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent mb-3",children:"No Wallets Detected"}),e.jsx("p",{className:"text-blue-300/70 text-center max-w-md text-lg",children:x?"Adjust search parameters":"Wallet data will synchronize once enumerators complete site visits"})]})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(s=>{var r;return e.jsx(ee,{wallet:{...s,balances:s.balances||{},pendingPayouts:(Number(s.totalEarned)||0)-(Number(s.totalWithdrawn)||0)-(((r=s.balances)==null?void 0:r[n])||0)},currency:n,onClick:l=>m(`/admin/wallets/${l}`)},s.id)})})]})};export{fe as default};
