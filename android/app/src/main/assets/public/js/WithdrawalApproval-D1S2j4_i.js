import{r as j,j as e,q as p,t as o,aV as m,y as K,l as Q,I as Y}from"./react-core-B8kFjp2k.js";import{a8 as Z,E as _,C as g,b as v,T as ee,i as se,j as T,k as A,f as k,g as D,h as q,D as E,l as H,m as I,n as z,o as B,p as U,a as i,B as x}from"./index-PwDgWEVM.js";import{T as te,a as ae,b as S,c,d as re,e as n}from"./table-CZ8ZB6wW.js";import{L as ne}from"./label-C4lDws8j.js";import{T as de}from"./textarea-BpQMf5eL.js";import{o as le}from"./date-utils-YarVESQS.js";import"./vendor-VlxgVHMv.js";import"./docs-D2Yi4cpO.js";import"./react-dom-BLwj5vIO.js";import"./jspdf-rld7HkB6.js";import"./router-CKy9yO3R.js";import"./query-CJ0Bt4ph.js";import"./supabase-CwPDIVMD.js";import"./xlsx-CBxwqXDA.js";import"./forms-CESK2FDA.js";import"./radix-ui-C2DV4xtt.js";import"./radix-dialogs-CnlmQBMC.js";import"./radix-menus-CPezQVZk.js";function Te(){const{withdrawalRequests:N,approveWithdrawalRequest:$,rejectWithdrawalRequest:L}=Z(),{users:O}=_(),[t,d]=j.useState(null),[r,l]=j.useState(null),[h,u]=j.useState(""),[f,P]=j.useState(!1),b=N.filter(s=>s.status==="pending"),F=N.filter(s=>s.status==="approved"),W=N.filter(s=>s.status==="rejected"),w=s=>{const a=O.find(J=>J.id===s);return(a==null?void 0:a.name)||"Unknown User"},y=(s,a="SDG")=>new Intl.NumberFormat("en-SD",{style:"currency",currency:a,minimumFractionDigits:2}).format(s),R=s=>{try{return le(new Date(s),"MMM dd, yyyy HH:mm")}catch{return"Invalid date"}},V=s=>{d(s),l("approve"),u("")},G=s=>{d(s),l("reject"),u("")},X=async()=>{if(t){P(!0);try{r==="approve"?await $(t.id,h):r==="reject"&&await L(t.id,h),l(null),d(null),u("")}finally{P(!1)}}},M=s=>{switch(s){case"pending":return e.jsxs(x,{variant:"outline",className:"bg-yellow-500/10 text-yellow-700 dark:text-yellow-400 border-yellow-500/20",children:[e.jsx(p,{className:"w-3 h-3 mr-1"}),"Pending"]});case"approved":return e.jsxs(x,{variant:"outline",className:"bg-green-500/10 text-green-700 dark:text-green-400 border-green-500/20",children:[e.jsx(o,{className:"w-3 h-3 mr-1"}),"Approved"]});case"rejected":return e.jsxs(x,{variant:"outline",className:"bg-red-500/10 text-red-700 dark:text-red-400 border-red-500/20",children:[e.jsx(m,{className:"w-3 h-3 mr-1"}),"Rejected"]});default:return e.jsx(x,{variant:"outline",children:s})}},C=({requests:s})=>e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(S,{children:[e.jsx(c,{children:"Enumerator"}),e.jsx(c,{children:"Amount"}),e.jsx(c,{children:"Payment Method"}),e.jsx(c,{children:"Requested"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Actions"})]})}),e.jsx(re,{children:s.length===0?e.jsx(S,{children:e.jsx(n,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No requests found"})}):s.map(a=>e.jsxs(S,{className:"hover-elevate",children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:w(a.userId)})]})}),e.jsx(n,{children:e.jsx("span",{className:"font-semibold tabular-nums",children:y(a.amount,a.currency)})}),e.jsx(n,{children:e.jsx(x,{variant:"secondary",className:"capitalize",children:a.paymentMethod})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(Q,{className:"w-3 h-3"}),R(a.createdAt)]})}),e.jsx(n,{children:M(a.status)}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>V(a),className:"bg-green-500/10 text-green-700 dark:text-green-400 border-green-500/20 hover:bg-green-500/20","data-testid":`button-approve-${a.id}`,children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>G(a),className:"bg-red-500/10 text-red-700 dark:text-red-400 border-red-500/20 hover:bg-red-500/20","data-testid":`button-reject-${a.id}`,children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"Reject"]})]}),a.status!=="pending"&&a.supervisorNotes&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>{d(a),l(null)},"data-testid":`button-view-notes-${a.id}`,children:e.jsx(Y,{className:"w-4 h-4"})})]})})]},a.id))})]});return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Withdrawal Approval"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and approve enumerator withdrawal requests"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(g,{className:"bg-gradient-to-br from-primary/5 to-primary/10",children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(p,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium uppercase tracking-wide text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold tabular-nums",children:b.length})]})]})})})})]}),e.jsxs(ee,{defaultValue:"pending",className:"space-y-4",children:[e.jsxs(se,{children:[e.jsxs(T,{value:"pending","data-testid":"tab-pending",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Pending (",b.length,")"]}),e.jsxs(T,{value:"approved","data-testid":"tab-approved",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"Approved (",F.length,")"]}),e.jsxs(T,{value:"rejected","data-testid":"tab-rejected",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Rejected (",W.length,")"]})]}),e.jsx(A,{value:"pending",children:e.jsxs(g,{children:[e.jsxs(k,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-primary"}),"Pending Requests"]}),e.jsx(q,{children:"Withdrawal requests awaiting your approval"})]}),e.jsx(v,{children:e.jsx(C,{requests:b})})]})}),e.jsx(A,{value:"approved",children:e.jsxs(g,{children:[e.jsxs(k,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5 text-green-600"}),"Approved Requests"]}),e.jsx(q,{children:"Previously approved withdrawal requests"})]}),e.jsx(v,{children:e.jsx(C,{requests:F})})]})}),e.jsx(A,{value:"rejected",children:e.jsxs(g,{children:[e.jsxs(k,{children:[e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-red-600"}),"Rejected Requests"]}),e.jsx(q,{children:"Previously rejected withdrawal requests"})]}),e.jsx(v,{children:e.jsx(C,{requests:W})})]})})]}),e.jsx(E,{open:r!==null,onOpenChange:()=>l(null),children:e.jsxs(H,{children:[e.jsxs(I,{children:[e.jsx(z,{className:"flex items-center gap-2",children:r==="approve"?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-5 h-5 text-green-600"}),"Approve Withdrawal Request"]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-5 h-5 text-red-600"}),"Reject Withdrawal Request"]})}),e.jsx(B,{children:t&&e.jsxs("div",{className:"space-y-2 mt-4 text-foreground",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Enumerator:"}),e.jsx("p",{className:"font-medium",children:w(t.userId)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsx("p",{className:"font-medium tabular-nums",children:y(t.amount,t.currency)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment Method:"}),e.jsx("p",{className:"font-medium capitalize",children:t.paymentMethod})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Requested:"}),e.jsx("p",{className:"font-medium",children:R(t.createdAt)})]})]}),t.requestReason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Reason:"}),e.jsx("p",{className:"text-sm mt-1 p-2 bg-muted rounded-md",children:t.requestReason})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ne,{htmlFor:"notes",children:["Notes ",r==="reject"&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(de,{id:"notes",placeholder:`Add ${r==="approve"?"optional":"required"} notes...`,value:h,onChange:s=>u(s.target.value),rows:4,"data-testid":"input-supervisor-notes"})]}),e.jsxs(U,{children:[e.jsx(i,{variant:"outline",onClick:()=>l(null),disabled:f,children:"Cancel"}),e.jsx(i,{onClick:X,disabled:f||r==="reject"&&!h.trim(),variant:r==="approve"?"default":"destructive","data-testid":"button-confirm-action",children:f?"Processing...":r==="approve"?"Approve":"Reject"})]})]})}),e.jsx(E,{open:t!==null&&r===null,onOpenChange:()=>d(null),children:e.jsxs(H,{children:[e.jsxs(I,{children:[e.jsx(z,{children:"Request Details"}),e.jsx(B,{children:t&&e.jsxs("div",{className:"space-y-3 mt-4 text-foreground",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Enumerator:"}),e.jsx("p",{className:"font-medium",children:w(t.userId)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsx("p",{className:"font-medium tabular-nums",children:y(t.amount,t.currency)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx("div",{className:"mt-1",children:M(t.status)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"}),e.jsx("p",{className:"font-medium",children:R(t.createdAt)})]})]}),t.requestReason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Request Reason:"}),e.jsx("p",{className:"text-sm mt-1 p-2 bg-muted rounded-md",children:t.requestReason})]}),t.supervisorNotes&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Supervisor Notes:"}),e.jsx("p",{className:"text-sm mt-1 p-2 bg-muted rounded-md",children:t.supervisorNotes})]})]})})]}),e.jsx(U,{children:e.jsx(i,{variant:"outline",onClick:()=>d(null),children:"Close"})})]})})]})}export{Te as default};
